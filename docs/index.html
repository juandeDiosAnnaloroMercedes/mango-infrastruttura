<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f16" />
  <title>Mango â€” Infrastruttura di fiducia locale</title>

  <style>
    :root{
      --bg:#070a10;
      --panel:#0b0f16;
      --panel2:#0e1420;
      --text:#e7ecff;
      --muted:#a7b1d3;
      --line:rgba(255,255,255,.08);
      --chip:#121a2a;
      --chipOn:#1d2a45;
      --good:#29c07b;
      --bad:#ff4d4d;
      --warn:#ffb020;
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --radius:18px;
      --radius2:22px;
      --max:980px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 50% -20%, rgba(78,130,255,.20), transparent 60%),
                  radial-gradient(900px 500px at 80% 0%, rgba(255,120,0,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
      line-height:1.35;
    }

    a{color:inherit}
    .wrap{max-width:var(--max); margin:0 auto; padding:18px 14px 60px}
    .top{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      padding:14px 14px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius2);
      box-shadow:var(--shadow);
      position:sticky; top:10px; z-index:10;
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      min-width: 220px;
    }
    .logo{
      width:40px;height:40px;border-radius:12px;
      display:grid;place-items:center;
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border:1px solid var(--line);
      font-size:22px;
    }
    .btxt{display:flex; flex-direction:column}
    .btxt b{font-size:18px; letter-spacing:.2px}
    .btxt span{font-size:13px; color:var(--muted)}
    .langs{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}
    .chip{
      border:1px solid var(--line);
      background:var(--chip);
      color:var(--text);
      padding:8px 10px;
      border-radius:999px;
      font-weight:700;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      transition:transform .05s ease, background .15s ease;
    }
    .chip:active{transform:scale(.98)}
    .chip.on{background:var(--chipOn); border-color:rgba(120,160,255,.35)}
    .grid{display:grid; gap:14px; margin-top:14px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius2);
      box-shadow:var(--shadow);
      padding:16px;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    h2{margin:0 0 8px; font-size:30px}
    .sub{margin:0; color:var(--muted); font-size:15px}
    .note{color:var(--muted); font-size:14px; margin-top:10px}
    .hr{height:1px;background:var(--line); margin:14px 0}
    textarea{
      width:100%;
      min-height:120px;
      resize:vertical;
      padding:14px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.28);
      color:var(--text);
      font-size:16px;
      outline:none;
    }
    textarea:focus{border-color:rgba(120,160,255,.45)}
    .btn{
      border:1px solid var(--line);
      background:rgba(0,0,0,.20);
      color:var(--text);
      padding:12px 14px;
      border-radius:16px;
      font-weight:800;
      font-size:15px;
      cursor:pointer;
      user-select:none;
      transition:transform .05s ease, background .15s ease, opacity .15s ease;
    }
    .btn:active{transform:scale(.99)}
    .btn[disabled]{opacity:.45; cursor:not-allowed}
    .btn.primary{background:rgba(120,160,255,.15); border-color:rgba(120,160,255,.35)}
    .btn.danger{background:rgba(255,77,77,.10); border-color:rgba(255,77,77,.25)}
    .btn.link{background:rgba(0,0,0,.10)}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.20);
      color:var(--muted);
      font-size:13px;
      font-weight:700;
    }
    .muroList{display:grid; gap:10px; margin-top:12px}
    .muroItem{
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      border-radius:18px;
      padding:12px 12px;
      display:flex; justify-content:space-between; align-items:center;
      gap:10px;
    }
    .muroItem b{letter-spacing:.6px; opacity:.9}
    .muroItem .mango{opacity:.9}
    .toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:14px;
      width:min(var(--max), calc(100% - 24px));
      padding:12px 14px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      box-shadow:var(--shadow);
      display:none;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      z-index:9999;
    }
    .toast.show{display:flex}
    .toast.good{border-color:rgba(41,192,123,.45)}
    .toast.bad{border-color:rgba(255,77,77,.45)}
    .toast .msg{font-weight:900}
    .toast .x{cursor:pointer; opacity:.85; font-weight:900}
    .footer{
      margin-top:14px;
      color:var(--muted);
      font-size:13px;
      display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; align-items:center;
    }
    .smallLink{opacity:.9}
    .smallLink:hover{opacity:1}
  </style>
</head>

<body>
  <div class="wrap">
    <header class="top">
      <div class="brand">
        <a class="logo" href="Bianco.html" aria-label="Bianco">ðŸ¥­</a>
        <div class="btxt">
          <b id="tTitle">Mango</b>
          <span id="tSubtitle">Infrastruttura di fiducia locale</span>
        </div>
      </div>

      <div class="langs" id="langBar">
        <button class="chip on" data-lang="it">IT</button>
        <button class="chip" data-lang="en">EN</button>
        <button class="chip" data-lang="es">ES</button>
        <button class="chip" data-lang="fr">FR</button>
        <button class="chip" data-lang="de">DE</button>
        <button class="chip" data-lang="zh">ä¸­æ–‡</button>
      </div>
    </header>

    <main class="grid">
      <!-- FAI MANGO ADESSO -->
      <section class="card" id="secDo">
        <div class="row" style="justify-content:space-between; align-items:flex-start">
          <div>
            <h2 id="sec1Title">Fai Mango adesso</h2>
            <p class="sub" id="sec1Text">Scrivi una sola riga reale. Niente cifre. Niente misure. Niente equivalenze.</p>
          </div>
          <div class="row">
            <a class="btn link" id="btnStampaQR" href="stampa-qr.html">QR</a>
            <a class="btn link" id="btnFAQ" href="faq.html">FAQ</a>
          </div>
        </div>

        <div class="hr"></div>

        <textarea id="riga" placeholder="Scrivi qui una riga (Shift+Invio va a capo)"></textarea>

        <div class="row" style="margin-top:10px">
          <button class="btn primary" id="btnInvia" disabled>Invia riga</button>
          <button class="btn" id="btnPulisci">Pulisci</button>
          <button class="btn" id="btnApriArchivio">Apri archivio</button>
          <button class="btn danger" id="btnSvuotaArchivio">Svuota archivio</button>
          <span class="pill" id="countPill">Righe in archivio: 0</span>
        </div>

        <p class="note" id="sec1Note">Nota: lâ€™archivio Ã¨ locale sul tuo dispositivo (non Ã¨ pubblico).</p>

        <div class="footer">
          <div>
            <span id="emailLabel">Email:</span>
            <a class="smallLink" id="emailLink" href="mailto:info@mangoinfrastruttura.org">info@mangoinfrastruttura.org</a>
          </div>
          <div class="row" style="gap:8px">
            <a class="smallLink" id="btnQRpdf" href="QR_MANGO_UFFICIALE.pdf">PDF QR</a>
            <a class="smallLink" id="btnKitPdf" href="kit-mango.pdf">Kit (PDF)</a>
            <a class="smallLink" id="btnVersPdf" href="versione-permanente.pdf">Versione permanente (PDF)</a>
          </div>
        </div>
      </section>

      <!-- COS'Ãˆ -->
      <section class="card" id="secWhat">
        <h2 id="sec2Title">Cosâ€™Ã¨ Mango</h2>
        <p class="sub" id="sec2Text">
          Mango Ã¨ unâ€™infrastruttura di fiducia locale non monetaria, non appropriabile, progettata per evitare accumulo,
          speculazione e cattura istituzionale. Creato da Juan de Dios Annaloro Mercedes in memoria di Larimar.
        </p>

        <div class="hr"></div>

        <div class="row">
          <a class="btn link" id="btnFondativo" href="#" target="_blank" rel="noopener">Leggi il documento fondativo</a>
          <a class="btn link" id="btnOrigine" href="#" target="_blank" rel="noopener">Origine reale e storia vissuta</a>
          <a class="btn link" id="btnNeutralita" href="neutralita.html">NeutralitÃ </a>
          <a class="btn link" id="btnNonApp" href="non-appropriazione.html">Non appropriazione</a>
          <a class="btn link" id="btnStatuto" href="statuto-permanente.html">Statuto permanente</a>
        </div>

        <p class="note" id="pdfNote">
          Se un pulsante PDF non si apre, Ã¨ quasi sempre perchÃ© il nome del file non coincide: vedi le variabili PDF in alto nel JS.
        </p>
      </section>

      <!-- MURO -->
      <section class="card" id="secWall">
        <h2 id="sec3Title">Muro Mango</h2>
        <p class="sub" id="sec3Text">Sette righe anonime per lingua, scelte a caso a ogni visita. Senza identitÃ , senza date, senza archivio consultabile.</p>

        <div class="muroList" id="muroList"></div>

        <p class="note" id="wallNote">Il muro non mostra il tuo archivio. Ãˆ una selezione anonima locale.</p>
      </section>
    </main>
  </div>

  <div class="toast" id="toast">
    <div class="msg" id="toastMsg"></div>
    <div class="x" id="toastX">âœ•</div>
  </div>

  <script>
    /* ============================================================
      âœ… CONFIG PDF (ANTI-404)
      Incolla QUI i nomi file ESATTI (copiati da GitHub).
      Quelli con "..." su GitHub devono essere scritti completi.
    ============================================================ */
    const PDF = {
      // ESEMPIO: "Mango_Documento_Fondativo_....pdf"
      fondativo: "Mango_Documento_Fondativo.pdf",
      origine:   "MANGO_Origine_Reale_e_Storia_Vissuta.pdf"
    };

    /* ============================================================
      ðŸŒ LINGUE + TESTI
    ============================================================ */
    const STR = {
      it: {
        title: "Mango",
        subtitle: "Infrastruttura di fiducia locale",
        sec1Title: "Fai Mango adesso",
        sec1Text: "Scrivi una sola riga reale. Niente cifre. Niente misure. Niente equivalenze.",
        sec1Note: "Nota: lâ€™archivio Ã¨ locale sul tuo dispositivo (non Ã¨ pubblico).",
        sec2Title: "Cosâ€™Ã¨ Mango",
        sec2Text: "Mango Ã¨ unâ€™infrastruttura di fiducia locale non monetaria, non appropriabile, progettata per evitare accumulo, speculazione e cattura istituzionale. Creato da Juan de Dios Annaloro Mercedes in memoria di Larimar.",
        sec3Title: "Muro Mango",
        sec3Text: "Sette righe anonime per lingua, scelte a caso a ogni visita. Senza identitÃ , senza date, senza archivio consultabile.",
        wallNote: "Il muro non mostra il tuo archivio. Ãˆ una selezione anonima locale.",
        ph: "Scrivi qui una riga (Shift+Invio va a capo)",
        send: "Invia riga",
        clear: "Pulisci",
        openA: "Apri archivio",
        wipeA: "Svuota archivio",
        count: "Righe in archivio:",
        emailLabel: "Email:",
        faq: "FAQ",
        qr: "QR",
        pdfQR: "PDF QR",
        kit: "Kit (PDF)",
        vers: "Versione permanente (PDF)",
        fond: "Leggi il documento fondativo",
        origine: "Origine reale e storia vissuta",
        neutralita: "NeutralitÃ ",
        nonapp: "Non appropriazione",
        statuto: "Statuto permanente",
        ok: "Riga riconosciuta.",
        warnNum: "Rispetta te stesso e gli altri: Mango non si conta.",
        empty: "Scrivi una riga reale prima di inviare.",
        wiped: "Archivio svuotato.",
        cleared: "Campo pulito.",
        confirmWipe: "Vuoi svuotare lâ€™archivio locale? (azione irreversibile)"
      },
      en: {
        title: "Mango",
        subtitle: "Local trust infrastructure",
        sec1Title: "Do Mango now",
        sec1Text: "Write one real line. No numbers. No measures. No equivalences.",
        sec1Note: "Note: the archive is local on your device (not public).",
        sec2Title: "What is Mango",
        sec2Text: "Mango is a non-monetary, non-appropriable local trust infrastructure designed to avoid accumulation, speculation and institutional capture. Created by Juan de Dios Annaloro Mercedes in memory of Larimar.",
        sec3Title: "Mango Wall",
        sec3Text: "Seven anonymous lines per language, randomly chosen on each visit. No identity, no dates, no browsable archive.",
        wallNote: "The wall does not show your archive. It is an anonymous local selection.",
        ph: "Write one line here (Shift+Enter for a new line)",
        send: "Send line",
        clear: "Clear",
        openA: "Open archive",
        wipeA: "Wipe archive",
        count: "Lines in archive:",
        emailLabel: "Email:",
        faq: "FAQ",
        qr: "QR",
        pdfQR: "QR PDF",
        kit: "Kit (PDF)",
        vers: "Permanent version (PDF)",
        fond: "Read the founding document",
        origine: "Real origin and lived story",
        neutralita: "Neutrality",
        nonapp: "Non-appropriation",
        statuto: "Permanent statute",
        ok: "Line recognized.",
        warnNum: "Respect yourself and others: Mango is not counted.",
        empty: "Write a real line before sending.",
        wiped: "Archive wiped.",
        cleared: "Field cleared.",
        confirmWipe: "Wipe the local archive? (irreversible)"
      },
      es: {
        title: "Mango",
        subtitle: "Infraestructura de confianza local",
        sec1Title: "Haz Mango ahora",
        sec1Text: "Escribe una sola lÃ­nea real. Sin nÃºmeros. Sin medidas. Sin equivalencias.",
        sec1Note: "Nota: el archivo es local en tu dispositivo (no es pÃºblico).",
        sec2Title: "QuÃ© es Mango",
        sec2Text: "Mango es una infraestructura local de confianza no monetaria, no apropiable, diseÃ±ada para evitar acumulaciÃ³n, especulaciÃ³n y captura institucional. Creado por Juan de Dios Annaloro Mercedes en memoria de Larimar.",
        sec3Title: "Muro Mango",
        sec3Text: "Siete lÃ­neas anÃ³nimas por idioma, elegidas al azar en cada visita. Sin identidad, sin fechas, sin archivo consultable.",
        wallNote: "El muro no muestra tu archivo. Es una selecciÃ³n anÃ³nima local.",
        ph: "Escribe aquÃ­ una lÃ­nea (Shift+Enter para salto de lÃ­nea)",
        send: "Enviar lÃ­nea",
        clear: "Limpiar",
        openA: "Abrir archivo",
        wipeA: "Vaciar archivo",
        count: "LÃ­neas en archivo:",
        emailLabel: "Email:",
        faq: "FAQ",
        qr: "QR",
        pdfQR: "QR PDF",
        kit: "Kit (PDF)",
        vers: "VersiÃ³n permanente (PDF)",
        fond: "Leer el documento fundacional",
        origine: "Origen real e historia vivida",
        neutralita: "Neutralidad",
        nonapp: "No apropiaciÃ³n",
        statuto: "Estatuto permanente",
        ok: "LÃ­nea reconocida.",
        warnNum: "RespÃ©tate a ti y a los demÃ¡s: Mango no se cuenta.",
        empty: "Escribe una lÃ­nea real antes de enviar.",
        wiped: "Archivo vaciado.",
        cleared: "Campo limpiado.",
        confirmWipe: "Â¿Vaciar el archivo local? (irreversible)"
      },
      fr: {
        title: "Mango",
        subtitle: "Infrastructure de confiance locale",
        sec1Title: "Fais Mango maintenant",
        sec1Text: "Ã‰cris une seule ligne rÃ©elle. Pas de chiffres. Pas de mesures. Pas dâ€™Ã©quivalences.",
        sec1Note: "Note : lâ€™archive est locale sur ton appareil (non publique).",
        sec2Title: "Quâ€™est-ce que Mango",
        sec2Text: "Mango est une infrastructure de confiance locale non monÃ©taire, non appropriable, conÃ§ue pour Ã©viter lâ€™accumulation, la spÃ©culation et la capture institutionnelle. CrÃ©Ã© par Juan de Dios Annaloro Mercedes en mÃ©moire de Larimar.",
        sec3Title: "Mur Mango",
        sec3Text: "Sept lignes anonymes par langue, tirÃ©es au hasard Ã  chaque visite. Sans identitÃ©, sans dates, sans archive consultable.",
        wallNote: "Le mur nâ€™affiche pas ton archive. Câ€™est une sÃ©lection anonyme locale.",
        ph: "Ã‰cris une ligne ici (Maj+EntrÃ©e pour aller Ã  la ligne)",
        send: "Envoyer la ligne",
        clear: "Effacer",
        openA: "Ouvrir lâ€™archive",
        wipeA: "Vider lâ€™archive",
        count: "Lignes dans lâ€™archive :",
        emailLabel: "Email :",
        faq: "FAQ",
        qr: "QR",
        pdfQR: "QR PDF",
        kit: "Kit (PDF)",
        vers: "Version permanente (PDF)",
        fond: "Lire le document fondateur",
        origine: "Origine rÃ©elle et histoire vÃ©cue",
        neutralita: "NeutralitÃ©",
        nonapp: "Non-appropriation",
        statuto: "Statut permanent",
        ok: "Ligne reconnue.",
        warnNum: "Respecte-toi et les autres : Mango ne se compte pas.",
        empty: "Ã‰cris une ligne rÃ©elle avant dâ€™envoyer.",
        wiped: "Archive vidÃ©e.",
        cleared: "Champ effacÃ©.",
        confirmWipe: "Vider lâ€™archive locale ? (irrÃ©versible)"
      },
      de: {
        title: "Mango",
        subtitle: "Lokale Vertrauens-Infrastruktur",
        sec1Title: "Mach Mango jetzt",
        sec1Text: "Schreibe eine echte Zeile. Keine Zahlen. Keine MaÃŸe. Keine Ã„quivalenzen.",
        sec1Note: "Hinweis: Das Archiv ist lokal auf deinem GerÃ¤t (nicht Ã¶ffentlich).",
        sec2Title: "Was ist Mango",
        sec2Text: "Mango ist eine nicht-monetÃ¤re, nicht-aneignbare lokale Vertrauens-Infrastruktur, entworfen um Akkumulation, Spekulation und institutionelle Vereinnahmung zu vermeiden. Erschaffen von Juan de Dios Annaloro Mercedes zum Gedenken an Larimar.",
        sec3Title: "Mango-Mauer",
        sec3Text: "Sieben anonyme Zeilen pro Sprache, bei jedem Besuch zufÃ¤llig gewÃ¤hlt. Keine IdentitÃ¤t, keine Daten, kein durchsuchbares Archiv.",
        wallNote: "Die Mauer zeigt nicht dein Archiv. Es ist eine anonyme lokale Auswahl.",
        ph: "Schreibe hier eine Zeile (Shift+Enter fÃ¼r Zeilenumbruch)",
        send: "Zeile senden",
        clear: "Leeren",
        openA: "Archiv Ã¶ffnen",
        wipeA: "Archiv lÃ¶schen",
        count: "Zeilen im Archiv:",
        emailLabel: "E-Mail:",
        faq: "FAQ",
        qr: "QR",
        pdfQR: "QR PDF",
        kit: "Kit (PDF)",
        vers: "Permanente Version (PDF)",
        fond: "GrÃ¼ndungsdokument lesen",
        origine: "Realer Ursprung & gelebte Geschichte",
        neutralita: "NeutralitÃ¤t",
        nonapp: "Nicht-Aneignung",
        statuto: "Permanentes Statut",
        ok: "Zeile erkannt.",
        warnNum: "Respektiere dich und andere: Mango wird nicht gezÃ¤hlt.",
        empty: "Schreibe zuerst eine echte Zeile.",
        wiped: "Archiv gelÃ¶scht.",
        cleared: "Feld geleert.",
        confirmWipe: "Lokales Archiv lÃ¶schen? (irreversibel)"
      },
      zh: {
        title: "Mango",
        subtitle: "æœ¬åœ°ä¿¡ä»»åŸºç¡€è®¾æ–½",
        sec1Title: "çŽ°åœ¨å¼€å§‹ Mango",
        sec1Text: "å†™ä¸€è¡ŒçœŸå®žå‘ç”Ÿçš„äº‹ã€‚ä¸å†™æ•°å­—ã€‚ä¸å†™åº¦é‡ã€‚ä¸åšç­‰ä»·æ¢ç®—ã€‚",
        sec1Note: "è¯´æ˜Žï¼šå­˜æ¡£åªä¿å­˜åœ¨ä½ çš„è®¾å¤‡ä¸Šï¼ˆä¸å…¬å¼€ï¼‰ã€‚",
        sec2Title: "ä»€ä¹ˆæ˜¯ Mango",
        sec2Text: "Mango æ˜¯ä¸€ç§éžè´§å¸ã€ä¸å¯å æœ‰çš„æœ¬åœ°ä¿¡ä»»åŸºç¡€è®¾æ–½ï¼Œç”¨æ¥é¿å…ç§¯ç´¯ã€æŠ•æœºä¸Žåˆ¶åº¦æ€§æ•èŽ·ã€‚ç”± Juan de Dios Annaloro Mercedes åˆ›å»ºï¼Œä»¥çºªå¿µ Larimarã€‚",
        sec3Title: "Mango å¢™",
        sec3Text: "æ¯ç§è¯­è¨€æ˜¾ç¤º 7 è¡ŒåŒ¿åæ–‡å­—ï¼Œæ¯æ¬¡è®¿é—®éšæœºé€‰æ‹©ã€‚æ— èº«ä»½ã€æ— æ—¥æœŸã€ä¸å¯æµè§ˆå­˜æ¡£ã€‚",
        wallNote: "å¢™ä¸ä¼šæ˜¾ç¤ºä½ çš„ä¸ªäººå­˜æ¡£ï¼Œå®ƒæ˜¯åŒ¿åçš„æœ¬åœ°éšæœºå±•ç¤ºã€‚",
        ph: "åœ¨æ­¤å†™ä¸€è¡Œï¼ˆShift+Enter æ¢è¡Œï¼‰",
        send: "æäº¤",
        clear: "æ¸…ç©º",
        openA: "æ‰“å¼€å­˜æ¡£",
        wipeA: "æ¸…ç©ºå­˜æ¡£",
        count: "å­˜æ¡£è¡Œæ•°ï¼š",
        emailLabel: "é‚®ç®±ï¼š",
        faq: "FAQ",
        qr: "QR",
        pdfQR: "QR PDF",
        kit: "Kitï¼ˆPDFï¼‰",
        vers: "æ°¸ä¹…ç‰ˆæœ¬ï¼ˆPDFï¼‰",
        fond: "é˜…è¯»å¥ åŸºæ–‡ä»¶",
        origine: "çœŸå®žèµ·æºä¸Žäº²åŽ†æ•…äº‹",
        neutralita: "ä¸­ç«‹æ€§",
        nonapp: "ä¸å¯å æœ‰",
        statuto: "æ°¸ä¹…ç« ç¨‹",
        ok: "å·²è¯†åˆ«è¿™ä¸€è¡Œã€‚",
        warnNum: "å°Šé‡è‡ªå·±ä¸Žä»–äººï¼šMango ä¸å¯è¢«è®¡æ•°ã€‚",
        empty: "æäº¤å‰è¯·å…ˆå†™ä¸€è¡ŒçœŸå®žå†…å®¹ã€‚",
        wiped: "å­˜æ¡£å·²æ¸…ç©ºã€‚",
        cleared: "å·²æ¸…ç©ºè¾“å…¥æ¡†ã€‚",
        confirmWipe: "ç¡®å®šæ¸…ç©ºæœ¬åœ°å­˜æ¡£ï¼Ÿï¼ˆä¸å¯æ¢å¤ï¼‰"
      }
    };

    /* ============================================================
      ðŸ§± MURO â€” 7 righe per lingua (solo lingua corrente)
      Puoi cambiarle quando vuoi.
    ============================================================ */
    const MURO = {
      it: [
        "Ho aiutato a portare la spesa e mi hanno insegnato una ricetta.",
        "Ho riparato una sedia e mi hanno prestato un libro.",
        "Ho ascoltato davvero e mi hanno dato un passaggio.",
        "Ho annaffiato le piante e mi hanno offerto un caffÃ¨.",
        "Ho tradotto un testo e mi hanno aiutato con una telefonata.",
        "Ho sistemato un cavo e mi hanno dato un consiglio.",
        "Ho accompagnato qualcuno e mi hanno regalato del tempo."
      ],
      en: [
        "I carried groceries and they taught me a recipe.",
        "I fixed a chair and they lent me a book.",
        "I truly listened and they gave me a ride.",
        "I watered plants and they offered me coffee.",
        "I translated a text and they helped with a call.",
        "I untangled a cable and they gave me advice.",
        "I accompanied someone and they gave me time."
      ],
      es: [
        "AyudÃ© con la compra y me enseÃ±aron una receta.",
        "ArreglÃ© una silla y me prestaron un libro.",
        "EscuchÃ© de verdad y me dieron un aventÃ³n.",
        "ReguÃ© las plantas y me ofrecieron cafÃ©.",
        "Traduje un texto y me ayudaron con una llamada.",
        "ArreglÃ© un cable y me dieron un consejo.",
        "AcompaÃ±Ã© a alguien y me dieron tiempo."
      ],
      fr: [
        "Jâ€™ai portÃ© des courses et on mâ€™a appris une recette.",
        "Jâ€™ai rÃ©parÃ© une chaise et on mâ€™a prÃªtÃ© un livre.",
        "Jâ€™ai vraiment Ã©coutÃ© et on mâ€™a conduit.",
        "Jâ€™ai arrosÃ© des plantes et on mâ€™a offert un cafÃ©.",
        "Jâ€™ai traduit un texte et on mâ€™a aidÃ© pour un appel.",
        "Jâ€™ai arrangÃ© un cÃ¢ble et on mâ€™a donnÃ© un conseil.",
        "Jâ€™ai accompagnÃ© quelquâ€™un et on mâ€™a donnÃ© du temps."
      ],
      de: [
        "Ich trug EinkÃ¤ufe und man zeigte mir ein Rezept.",
        "Ich reparierte einen Stuhl und bekam ein Buch geliehen.",
        "Ich hÃ¶rte wirklich zu und bekam eine Mitfahrt.",
        "Ich goss Pflanzen und bekam einen Kaffee.",
        "Ich Ã¼bersetzte einen Text und bekam Hilfe bei einem Anruf.",
        "Ich ordnete ein Kabel und bekam einen Tipp.",
        "Ich begleitete jemanden und bekam Zeit geschenkt."
      ],
      zh: [
        "æˆ‘å¸®å¿™æèœï¼Œä»–ä»¬æ•™æˆ‘ä¸€é“èœã€‚",
        "æˆ‘ä¿®å¥½æ¤…å­ï¼Œä»–ä»¬å€Ÿæˆ‘ä¸€æœ¬ä¹¦ã€‚",
        "æˆ‘è®¤çœŸå€¾å¬ï¼Œä»–ä»¬é¡ºè·¯è½½æˆ‘ä¸€ç¨‹ã€‚",
        "æˆ‘æµ‡èŠ±ï¼Œä»–ä»¬è¯·æˆ‘å–å’–å•¡ã€‚",
        "æˆ‘å¸®å¿™ç¿»è¯‘ï¼Œä»–ä»¬å¸®æˆ‘æ‰“ç”µè¯ã€‚",
        "æˆ‘æ•´ç†ç”µçº¿ï¼Œä»–ä»¬ç»™æˆ‘ä¸€ä¸ªå»ºè®®ã€‚",
        "æˆ‘é™ªä¼´åŒè¡Œï¼Œä»–ä»¬ç»™æˆ‘ä¸€äº›æ—¶é—´ã€‚"
      ]
    };

    /* ============================================================
      ðŸ—ƒï¸ ARCHIVIO LOCALE (per lingua)
    ============================================================ */
    const STORAGE_KEY = "MANGO_ARCHIVE_UNICO_V2";

    function safeParse(raw){
      try { return JSON.parse(raw); } catch { return null; }
    }
    function getLang(){
      const url = new URL(location.href);
      const q = (url.searchParams.get("lang") || "").toLowerCase();
      if (q && STR[q]) return q;
      const saved = localStorage.getItem("MANGO_LANG");
      if (saved && STR[saved]) return saved;
      return "it";
    }
    function setLang(lang){
      localStorage.setItem("MANGO_LANG", lang);
      const url = new URL(location.href);
      url.searchParams.set("lang", lang);
      history.replaceState({}, "", url.toString());
    }

    function readAll(){
      const raw = localStorage.getItem(STORAGE_KEY);
      const parsed = safeParse(raw);
      if (!parsed || typeof parsed !== "object") return {};
      return parsed;
    }
    function writeAll(obj){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
    }
    function readArchive(lang){
      const all = readAll();
      const arr = Array.isArray(all[lang]) ? all[lang] : [];
      // normalizza: solo stringhe
      return arr.filter(x => typeof x === "string" && x.trim().length);
    }
    function writeArchive(lang, arr){
      const all = readAll();
      all[lang] = arr;
      writeAll(all);
    }

    /* ============================================================
      ðŸš¦ VALIDAZIONE MANGO (blocca numeri/valore/misure)
      - Numeri: 0-9
      - Simboli che spesso indicano conteggio/valore/misura: + = < > % â‚¬ $ Â£ Â¥ # @
    ============================================================ */
    function isCountingLike(text){
      if (/[0-9]/.test(text)) return true;
      if (/[â‚¬$Â£Â¥%+=<>#@]/.test(text)) return true;
      return false;
    }
    function normalizeText(t){
      return (t || "").replace(/\s+/g, " ").trim();
    }

    /* ============================================================
      âœ… TOAST
    ============================================================ */
    let toastTimer = null;
    function showToast(type, msg){
      const t = document.getElementById("toast");
      const m = document.getElementById("toastMsg");
      t.classList.remove("good","bad");
      t.classList.add(type === "bad" ? "bad" : "good");
      m.textContent = msg;
      t.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => t.classList.remove("show"), 2800);
    }

    /* ============================================================
      ðŸ§± MURO: 7 righe casuali per lingua (solo lingua corrente)
    ============================================================ */
    function pick7(lang){
      const src = (MURO[lang] || []).slice();
      // shuffle
      for (let i = src.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [src[i], src[j]] = [src[j], src[i]];
      }
      return src.slice(0, 7);
    }
    function renderMuro(lang){
      const box = document.getElementById("muroList");
      box.innerHTML = "";
      const lines = pick7(lang);
      for (const line of lines){
        const div = document.createElement("div");
        div.className = "muroItem";
        const left = document.createElement("div");
        left.style.flex = "1";
        left.textContent = line;
        const right = document.createElement("div");
        right.className = "mango";
        right.textContent = "ðŸ¥­";
        div.appendChild(left);
        div.appendChild(right);
        box.appendChild(div);
      }
    }

    /* ============================================================
      ðŸ”¤ APPLY LANG UI
    ============================================================ */
    function applyLang(lang){
      document.documentElement.lang = lang;

      // chips
      document.querySelectorAll("#langBar .chip").forEach(b => {
        b.classList.toggle("on", b.dataset.lang === lang);
      });

      const s = STR[lang];

      // header
      document.getElementById("tTitle").textContent = s.title;
      document.getElementById("tSubtitle").textContent = s.subtitle;

      // sections
      document.getElementById("sec1Title").textContent = s.sec1Title;
      document.getElementById("sec1Text").textContent  = s.sec1Text;
      document.getElementById("sec1Note").textContent  = s.sec1Note;

      document.getElementById("sec2Title").textContent = s.sec2Title;
      document.getElementById("sec2Text").textContent  = s.sec2Text;

      document.getElementById("sec3Title").textContent = s.sec3Title;
      document.getElementById("sec3Text").textContent  = s.sec3Text;
      document.getElementById("wallNote").textContent  = s.wallNote;

      // placeholders/buttons
      const ta = document.getElementById("riga");
      ta.placeholder = s.ph;

      document.getElementById("btnInvia").textContent = s.send;
      document.getElementById("btnPulisci").textContent = s.clear;
      document.getElementById("btnApriArchivio").textContent = s.openA;
      document.getElementById("btnSvuotaArchivio").textContent = s.wipeA;

      // links labels
      document.getElementById("btnFAQ").textContent = s.faq;
      document.getElementById("btnStampaQR").textContent = s.qr;

      document.getElementById("emailLabel").textContent = s.emailLabel;
      document.getElementById("btnQRpdf").textContent = s.pdfQR;
      document.getElementById("btnKitPdf").textContent = s.kit;
      document.getElementById("btnVersPdf").textContent = s.vers;

      document.getElementById("btnFondativo").textContent = s.fond;
      document.getElementById("btnOrigine").textContent = s.origine;
      document.getElementById("btnNeutralita").textContent = s.neutralita;
      document.getElementById("btnNonApp").textContent = s.nonapp;
      document.getElementById("btnStatuto").textContent = s.statuto;

      // pdf href (anti 404 via config)
      const aFond = document.getElementById("btnFondativo");
      const aOri  = document.getElementById("btnOrigine");
      aFond.href = PDF.fondativo || "#";
      aOri.href  = PDF.origine || "#";

      // count
      updateCount(lang);

      // muro
      renderMuro(lang);
    }

    function updateCount(lang){
      const c = readArchive(lang).length;
      const s = STR[lang];
      document.getElementById("countPill").textContent = `${s.count} ${c}`;
    }

    /* ============================================================
      ðŸ“© SAVE LINE
    ============================================================ */
    function syncInvia(){
      const lang = currentLang;
      const ta = document.getElementById("riga");
      const btn = document.getElementById("btnInvia");
      const txt = normalizeText(ta.value);
      btn.disabled = !txt.length;
    }

    function saveLine(){
      const lang = currentLang;
      const s = STR[lang];
      const ta = document.getElementById("riga");
      const text = normalizeText(ta.value);

      if (!text){
        showToast("bad", s.empty);
        return;
      }

      // blocco numeri / misure / valore
      if (isCountingLike(text)){
        showToast("bad", s.warnNum);
        return;
      }

      const arr = readArchive(lang);
      arr.push(text);

      // dedup semplice
      const out = [];
      const seen = new Set();
      for (const x of arr){
        const k = x.toLowerCase();
        if (seen.has(k)) continue;
        seen.add(k);
        out.push(x);
      }

      writeArchive(lang, out);

      ta.value = "";
      syncInvia();
      updateCount(lang);
      showToast("good", s.ok);
    }

    function openArchive(){
      const lang = currentLang;
      const s = STR[lang];
      const arr = readArchive(lang);

      if (!arr.length){
        showToast("bad", s.empty);
        return;
      }

      // mostra le prime 60 (solo testo, no numeri di lista per coerenza)
      const slice = arr.slice(-60);
      alert(slice.join("\n\n"));
    }

    function wipeArchive(){
      const lang = currentLang;
      const s = STR[lang];
      if (!confirm(s.confirmWipe)) return;
      writeArchive(lang, []);
      updateCount(lang);
      showToast("good", s.wiped);
    }

    function clearField(){
      const lang = currentLang;
      const s = STR[lang];
      document.getElementById("riga").value = "";
      syncInvia();
      showToast("good", s.cleared);
    }

    /* ============================================================
      ðŸš€ INIT
    ============================================================ */
    let currentLang = getLang();
    setLang(currentLang);
    applyLang(currentLang);

    // close toast
    document.getElementById("toastX").addEventListener("click", () => {
      document.getElementById("toast").classList.remove("show");
    });

    // language clicks
    document.querySelectorAll("#langBar .chip").forEach(b => {
      b.addEventListener("click", () => {
        currentLang = b.dataset.lang;
        setLang(currentLang);
        applyLang(currentLang);
        syncInvia();
      });
    });

    // textarea events
    const ta = document.getElementById("riga");
    ta.addEventListener("input", syncInvia);
    ta.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        saveLine();
      }
    });

    // buttons
    document.getElementById("btnInvia").addEventListener("click", saveLine);
    document.getElementById("btnApriArchivio").addEventListener("click", openArchive);
    document.getElementById("btnSvuotaArchivio").addEventListener("click", wipeArchive);
    document.getElementById("btnPulisci").addEventListener("click", clearField);

    // ensure enabled state on load
    syncInvia();
  </script>
</body>
</html>
