<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f17" />
  <title>Mango â€” infrastruttura di fiducia locale</title>
  <style>
    :root{
      --bg:#0b0f17;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.04);
      --line:rgba(255,255,255,.10);
      --text:#e9eefb;
      --muted:rgba(233,238,251,.70);
      --muted2:rgba(233,238,251,.55);
      --blue:#2f6fff;
      --green:#1fbf73;
      --red:#ff4b4b;
      --shadow:0 20px 60px rgba(0,0,0,.45);
      --radius:26px;
      --radius2:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(47,111,255,.14), transparent 60%),
        radial-gradient(900px 500px at 80% 15%, rgba(255,185,0,.12), transparent 60%),
        radial-gradient(1200px 700px at 50% 100%, rgba(255,75,75,.08), transparent 65%),
        var(--bg);
      color:var(--text);
      padding: 18px 14px 40px;
    }
    a{color:#b9caff}
    .wrap{max-width:840px;margin:0 auto}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.045));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
      margin:14px 0;
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 220px;
    }
    .logoBtn{
      width:54px;height:54px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;
      user-select:none;
    }
    .logoBtn:active{transform:scale(.98)}
    .logoEmoji{font-size:30px; line-height:1}
    .brandTxt .title{
      font-size:28px;
      font-weight:800;
      line-height:1.05;
      margin:0;
    }
    .brandTxt .sub{
      margin:2px 0 0;
      color:var(--muted);
      font-weight:600;
    }
    .langRow{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:flex-end;
    }
    .chip{
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 14px;
      font-weight:800;
      cursor:pointer;
      min-width:64px;
      text-align:center;
      user-select:none;
    }
    .chip.active{
      outline:2px solid rgba(47,111,255,.35);
      background: rgba(47,111,255,.14);
    }
    .h1{
      font-size:52px;
      letter-spacing:-.02em;
      margin:8px 0 6px;
      font-weight:900;
    }
    .lead{
      margin:0 0 14px;
      color:var(--muted);
      font-size:22px;
      font-weight:650;
      line-height:1.35;
    }
    .btnRow{display:flex;gap:14px;flex-wrap:wrap;margin:10px 0 12px}
    .btn{
      border-radius:22px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:14px 18px;
      font-weight:900;
      font-size:18px;
      cursor:pointer;
      min-width:120px;
      text-align:center;
      user-select:none;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    .btn.primary{background:rgba(47,111,255,.18); border-color:rgba(47,111,255,.35)}
    .btn.danger{background:rgba(255,75,75,.14); border-color:rgba(255,75,75,.30)}
    .btn:active{transform:scale(.99)}
    .btn[disabled]{
      opacity:.45;
      cursor:not-allowed;
    }
    .divider{height:1px;background:var(--line); margin:12px 0}
    textarea{
      width:100%;
      min-height:120px;
      border-radius:22px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      color:var(--text);
      padding:16px 16px;
      font-size:18px;
      line-height:1.35;
      outline:none;
      resize:vertical;
    }
    .status{
      margin:12px 0 0;
      padding:12px 14px;
      border-radius:18px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-weight:800;
      display:none;
    }
    .status.good{display:block;border-color:rgba(31,191,115,.35);background:rgba(31,191,115,.10);color:#c9ffe6}
    .status.warn{display:block;border-color:rgba(255,75,75,.35);background:rgba(255,75,75,.10);color:#ffd0d0}
    .small{
      color:var(--muted2);
      font-weight:650;
      margin:10px 0 0;
      font-size:16px;
      line-height:1.35;
    }
    .countPill{
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      padding:12px 14px;
      font-weight:900;
      color:var(--muted);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:180px;
    }
    h2{
      margin:4px 0 8px;
      font-size:48px;
      font-weight:900;
      letter-spacing:-.02em;
    }
    .aboutTxt{
      margin:0 0 12px;
      color:var(--muted);
      font-size:22px;
      font-weight:650;
      line-height:1.35;
    }
    .linkRow{display:flex;gap:12px;flex-wrap:wrap}
    .linkRow a{font-weight:900}
    .muroList{
      margin:10px 0 0;
      padding-left:22px;
      color:var(--text);
      font-size:20px;
      line-height:1.45;
      font-weight:750;
    }
    .muroHdr{
      display:flex;align-items:center;justify-content:space-between;
      gap:10px;
    }
    .muroBadge{
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      padding:10px 14px;
      font-weight:900;
      color:var(--muted);
      display:inline-flex;
      align-items:center;
      gap:10px;
      user-select:none;
    }
    footer{
      margin-top:18px;
      text-align:center;
      color:rgba(233,238,251,.55);
      font-weight:800;
      letter-spacing:.02em;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- HEADER -->
    <div class="card">
      <div class="top">
        <div class="brand">
          <div class="logoBtn" id="mangoBtn" title="Bianco">
            <div class="logoEmoji" aria-hidden="true">ðŸ¥­</div>
          </div>
          <div class="brandTxt">
            <p class="title" id="brandTitle">Mango</p>
            <p class="sub" id="brandSub">Infrastruttura di fiducia locale</p>
          </div>
        </div>

        <div class="langRow" aria-label="Language">
          <div class="chip" data-lang="it">IT</div>
          <div class="chip" data-lang="en">EN</div>
          <div class="chip" data-lang="es">ES</div>
          <div class="chip" data-lang="fr">FR</div>
          <div class="chip" data-lang="de">DE</div>
          <div class="chip" data-lang="zh">ä¸­æ–‡</div>
        </div>
      </div>
    </div>

    <!-- FAI MANGO -->
    <div class="card">
      <div class="h1" id="heroTitle">Fai Mango adesso</div>
      <p class="lead" id="heroLead">Scrivi una sola riga reale. Niente cifre. Niente misure. Niente equivalenze.</p>

      <div class="btnRow">
        <a class="btn" id="btnQR" href="QR_MANGO_UFFICIALE.pdf" target="_blank">QR</a>
        <a class="btn" id="btnFAQ" href="faq.html">FAQ</a>
      </div>

      <div class="divider"></div>

      <textarea id="riga" placeholder="Scrivi qui una riga (Shift+Invio va a capo)"></textarea>

      <div class="btnRow" style="margin-top:14px">
        <button class="btn primary" id="btnInvia">Invia riga</button>
        <button class="btn" id="btnPulisci">Pulisci</button>
        <button class="btn" id="btnApri">Apri archivio</button>
        <button class="btn danger" id="btnSvuota">Svuota archivio</button>
        <div class="countPill" id="count">Righe in archivio: 0</div>
      </div>

      <div id="status" class="status"></div>

      <p class="small" id="noteLocal">Nota: lâ€™archivio Ã¨ locale sul tuo dispositivo (non Ã¨ pubblico).</p>

      <div style="margin-top:10px">
        <strong id="emailLabel">Email:</strong>
        <a id="emailLink" href="mailto:info@mangoinfrastruttura.org">info@mangoinfrastruttura.org</a>
      </div>

      <div class="linkRow" style="margin-top:12px">
        <a href="QR_MANGO_UFFICIALE.pdf" id="lnkPdfQr">PDF QR</a>
        <a href="kit-mango.pdf" id="lnkKit">Kit (PDF)</a>
        <a href="versione-permanente.pdf" id="lnkVer">Versione permanente (PDF)</a>
        <a href="MANGO_Origine_Reale_e_Storia_Vissuta.pdf" id="lnkOrig">Origine reale (PDF)</a>
      </div>

      <div class="linkRow" style="margin-top:10px">
        <a href="neutralita.html" id="lnkNeut">NeutralitÃ </a>
        <a href="non-appropriazione.html" id="lnkNonApp">Non appropriazione</a>
        <a href="statuto-permanente.html" id="lnkStat">Statuto permanente</a>
        <a href="primo-scambio.html" id="lnkPrimo">Primo scambio</a>
        <a href="licenza.html" id="lnkLic">Licenza</a>
      </div>
    </div>

    <!-- COS'E -->
    <div class="card">
      <h2 id="aboutTitle">Cosâ€™Ã¨ Mango</h2>
      <p class="aboutTxt" id="aboutText">
        Mango Ã¨ unâ€™infrastruttura di fiducia locale non monetaria, non appropriabile, progettata per evitare accumulo, speculazione e cattura istituzionale.
        Creato da Juan de Dios Annaloro Mercedes in memoria di Larimar.
      </p>
      <div class="btnRow">
        <a class="btn" id="btnLic" href="licenza.html">Licenza</a>
        <a class="btn" id="btnStampaQr" href="stampa-qr.html">Stampa QR</a>
      </div>
    </div>

    <!-- MURO -->
    <div class="card">
      <div class="muroHdr">
        <div>
          <h2 id="muroTitle" style="margin:0 0 6px">Muro Mango</h2>
          <p class="aboutTxt" id="muroLead" style="margin:0">
            Sette righe anonime per lingua, scelte a caso a ogni visita. Senza identitÃ , senza date, senza archivio consultabile.
          </p>
        </div>
        <div class="muroBadge" id="muroLangBadge">IT ðŸ¥­</div>
      </div>
      <ul class="muroList" id="muroList"></ul>
    </div>

    <footer id="foot">Mango â€” nato il 02 febbraio 2026</footer>
  </div>

<script>
/* =========================
   Lingue (6)
========================= */
const STR = {
  it: {
    brandSub: "Infrastruttura di fiducia locale",
    heroTitle: "Fai Mango adesso",
    heroLead: "Scrivi una sola riga reale. Niente cifre. Niente misure. Niente equivalenze.",
    taPh: "Scrivi qui una riga (Shift+Invio va a capo)",
    btnInvia: "Invia riga",
    btnPulisci: "Pulisci",
    btnApri: "Apri archivio",
    btnSvuota: "Svuota archivio",
    count: n => `Righe in archivio: ${n}`,
    noteLocal: "Nota: lâ€™archivio Ã¨ locale sul tuo dispositivo (non Ã¨ pubblico).",
    aboutTitle: "Cosâ€™Ã¨ Mango",
    aboutText: "Mango Ã¨ unâ€™infrastruttura di fiducia locale non monetaria, non appropriabile, progettata per evitare accumulo, speculazione e cattura istituzionale. Creato da Juan de Dios Annaloro Mercedes in memoria di Larimar.",
    muroTitle: "Muro Mango",
    muroLead: "Sette righe anonime per lingua, scelte a caso a ogni visita. Senza identitÃ , senza date, senza archivio consultabile.",
    lnk: {
      pdfqr:"PDF QR", kit:"Kit (PDF)", ver:"Versione permanente (PDF)", orig:"Origine reale (PDF)",
      neut:"NeutralitÃ ", nonapp:"Non appropriazione", stat:"Statuto permanente", primo:"Primo scambio", lic:"Licenza",
      qr:"QR", faq:"FAQ", stampaQr:"Stampa QR"
    },
    ok: "Riga riconosciuta.",
    warnNum: "Rispetta te stesso e gli altri. Mango non si conta.",
    savedEmpty: "Scrivi una riga reale prima di inviare.",
    archiveEmpty: "Archivio vuoto.",
    confirmWipe: "Svuotare lâ€™archivio locale?",
    wiped: "Archivio svuotato."
  },
  en: {
    brandSub: "Local trust infrastructure",
    heroTitle: "Do Mango now",
    heroLead: "Write one real line. No numbers. No measures. No equivalences.",
    taPh: "Write one line here (Shift+Enter = new line)",
    btnInvia: "Send line",
    btnPulisci: "Clear",
    btnApri: "Open archive",
    btnSvuota: "Wipe archive",
    count: n => `Lines in archive: ${n}`,
    noteLocal: "Note: the archive is local on your device (not public).",
    aboutTitle: "What is Mango",
    aboutText: "Mango is a non-monetary, non-appropriable local trust infrastructure, designed to avoid accumulation, speculation, and institutional capture. Created by Juan de Dios Annaloro Mercedes in memory of Larimar.",
    muroTitle: "Mango Wall",
    muroLead: "Seven anonymous lines per language, randomly chosen on each visit. No identity, no dates, no browsable archive.",
    lnk: {
      pdfqr:"QR PDF", kit:"Kit (PDF)", ver:"Permanent version (PDF)", orig:"Real origin (PDF)",
      neut:"Neutrality", nonapp:"Non-appropriation", stat:"Permanent statute", primo:"First exchange", lic:"License",
      qr:"QR", faq:"FAQ", stampaQr:"Print QR"
    },
    ok: "Line recognized.",
    warnNum: "Respect yourself and others. Mango is not counted.",
    savedEmpty: "Write a real line before sending.",
    archiveEmpty: "Archive is empty.",
    confirmWipe: "Wipe the local archive?",
    wiped: "Archive wiped."
  },
  es: {
    brandSub: "Infraestructura de confianza local",
    heroTitle: "Haz Mango ahora",
    heroLead: "Escribe una sola lÃ­nea real. Sin nÃºmeros. Sin medidas. Sin equivalencias.",
    taPh: "Escribe una lÃ­nea aquÃ­ (Shift+Enter = salto de lÃ­nea)",
    btnInvia: "Enviar lÃ­nea",
    btnPulisci: "Borrar",
    btnApri: "Abrir archivo",
    btnSvuota: "Vaciar archivo",
    count: n => `LÃ­neas en archivo: ${n}`,
    noteLocal: "Nota: el archivo es local en tu dispositivo (no es pÃºblico).",
    aboutTitle: "QuÃ© es Mango",
    aboutText: "Mango es una infraestructura de confianza local no monetaria, no apropiable, diseÃ±ada para evitar acumulaciÃ³n, especulaciÃ³n y captura institucional. Creado por Juan de Dios Annaloro Mercedes en memoria de Larimar.",
    muroTitle: "Muro Mango",
    muroLead: "Siete lÃ­neas anÃ³nimas por idioma, elegidas al azar en cada visita. Sin identidad, sin fechas, sin archivo consultable.",
    lnk: {
      pdfqr:"PDF QR", kit:"Kit (PDF)", ver:"VersiÃ³n permanente (PDF)", orig:"Origen real (PDF)",
      neut:"Neutralidad", nonapp:"No apropiaciÃ³n", stat:"Estatuto permanente", primo:"Primer intercambio", lic:"Licencia",
      qr:"QR", faq:"FAQ", stampaQr:"Imprimir QR"
    },
    ok: "LÃ­nea reconocida.",
    warnNum: "RespÃ©tate a ti y a los demÃ¡s. Mango no se cuenta.",
    savedEmpty: "Escribe una lÃ­nea real antes de enviar.",
    archiveEmpty: "Archivo vacÃ­o.",
    confirmWipe: "Â¿Vaciar el archivo local?",
    wiped: "Archivo vaciado."
  },
  fr: {
    brandSub: "Infrastructure de confiance locale",
    heroTitle: "Fais Mango maintenant",
    heroLead: "Ã‰cris une seule ligne rÃ©elle. Pas de chiffres. Pas de mesures. Pas dâ€™Ã©quivalences.",
    taPh: "Ã‰cris une ligne ici (Shift+EntrÃ©e = retour Ã  la ligne)",
    btnInvia: "Envoyer la ligne",
    btnPulisci: "Effacer",
    btnApri: "Ouvrir lâ€™archive",
    btnSvuota: "Vider lâ€™archive",
    count: n => `Lignes dans lâ€™archive : ${n}`,
    noteLocal: "Note : lâ€™archive est locale sur ton appareil (pas publique).",
    aboutTitle: "Quâ€™est-ce que Mango",
    aboutText: "Mango est une infrastructure de confiance locale non monÃ©taire, non appropriable, conÃ§ue pour Ã©viter lâ€™accumulation, la spÃ©culation et la capture institutionnelle. CrÃ©Ã© par Juan de Dios Annaloro Mercedes en mÃ©moire de Larimar.",
    muroTitle: "Mur Mango",
    muroLead: "Sept lignes anonymes par langue, choisies au hasard Ã  chaque visite. Sans identitÃ©, sans dates, sans archive consultable.",
    lnk: {
      pdfqr:"PDF QR", kit:"Kit (PDF)", ver:"Version permanente (PDF)", orig:"Origine rÃ©elle (PDF)",
      neut:"NeutralitÃ©", nonapp:"Non-appropriation", stat:"Statut permanent", primo:"Premier Ã©change", lic:"Licence",
      qr:"QR", faq:"FAQ", stampaQr:"Imprimer QR"
    },
    ok: "Ligne reconnue.",
    warnNum: "Respecte-toi et respecte les autres. Mango ne se compte pas.",
    savedEmpty: "Ã‰cris une ligne rÃ©elle avant dâ€™envoyer.",
    archiveEmpty: "Archive vide.",
    confirmWipe: "Vider lâ€™archive locale ?",
    wiped: "Archive vidÃ©e."
  },
  de: {
    brandSub: "Lokale Vertrauens-Infrastruktur",
    heroTitle: "Mach Mango jetzt",
    heroLead: "Schreibe eine echte Zeile. Keine Zahlen. Keine MaÃŸe. Keine Ã„quivalenzen.",
    taPh: "Schreibe hier eine Zeile (Shift+Enter = neue Zeile)",
    btnInvia: "Zeile senden",
    btnPulisci: "Leeren",
    btnApri: "Archiv Ã¶ffnen",
    btnSvuota: "Archiv lÃ¶schen",
    count: n => `Zeilen im Archiv: ${n}`,
    noteLocal: "Hinweis: Das Archiv ist lokal auf deinem GerÃ¤t (nicht Ã¶ffentlich).",
    aboutTitle: "Was ist Mango",
    aboutText: "Mango ist eine nicht-monetÃ¤re, nicht-aneignbare lokale Vertrauens-Infrastruktur, entwickelt um Akkumulation, Spekulation und institutionelle Vereinnahmung zu vermeiden. Erschaffen von Juan de Dios Annaloro Mercedes in Erinnerung an Larimar.",
    muroTitle: "Mango-Mauer",
    muroLead: "Sieben anonyme Zeilen pro Sprache, bei jedem Besuch zufÃ¤llig gewÃ¤hlt. Keine IdentitÃ¤t, keine Daten, kein durchsuchbares Archiv.",
    lnk: {
      pdfqr:"QR-PDF", kit:"Kit (PDF)", ver:"Permanente Version (PDF)", orig:"Ursprung (PDF)",
      neut:"NeutralitÃ¤t", nonapp:"Nicht-Aneignung", stat:"Permanente Satzung", primo:"Erster Austausch", lic:"Lizenz",
      qr:"QR", faq:"FAQ", stampaQr:"QR drucken"
    },
    ok: "Zeile erkannt.",
    warnNum: "Respektiere dich und die anderen. Mango wird nicht gezÃ¤hlt.",
    savedEmpty: "Schreibe eine echte Zeile, bevor du sendest.",
    archiveEmpty: "Archiv ist leer.",
    confirmWipe: "Lokales Archiv lÃ¶schen?",
    wiped: "Archiv gelÃ¶scht."
  },
  zh: {
    brandSub: "åœ¨åœ°ä¿¡ä»»åŸºç¤Žè¨­æ–½",
    heroTitle: "ç¾åœ¨åš Mango",
    heroLead: "å¯«ä¸‹ä¸€å¥çœŸå¯¦çš„äº‹ã€‚ä¸è¦æ•¸å­—ã€‚ä¸è¦åº¦é‡ã€‚ä¸è¦ç­‰åƒ¹ã€‚",
    taPh: "åœ¨é€™è£¡å¯«ä¸€å¥ï¼ˆShift+Enter æ›è¡Œï¼‰",
    btnInvia: "é€å‡º",
    btnPulisci: "æ¸…é™¤",
    btnApri: "æ‰“é–‹å­˜æª”",
    btnSvuota: "æ¸…ç©ºå­˜æª”",
    count: n => `å­˜æª”è¡Œæ•¸ï¼š${n}`,
    noteLocal: "å‚™è¨»ï¼šå­˜æª”åªåœ¨ä½ çš„è£ç½®ä¸Šï¼ˆä¸å…¬é–‹ï¼‰ã€‚",
    aboutTitle: "ä»€éº¼æ˜¯ Mango",
    aboutText: "Mango æ˜¯ä¸€ç¨®éžè²¨å¹£ã€ä¸å¯å æœ‰çš„åœ¨åœ°ä¿¡ä»»åŸºç¤Žè¨­æ–½ï¼Œç”¨ä¾†é¿å…ç´¯ç©ã€æŠ•æ©Ÿèˆ‡åˆ¶åº¦æ€§æ”«å–ã€‚ç”± Juan de Dios Annaloro Mercedes å‰µç«‹ï¼Œä»¥ç´€å¿µ Larimarã€‚",
    muroTitle: "Mango ç‰†",
    muroLead: "æ¯ç¨®èªžè¨€ 7 è¡ŒåŒ¿åå¥å­ï¼Œæ¯æ¬¡é€ è¨ªéš¨æ©Ÿé¡¯ç¤ºã€‚ç„¡èº«ä»½ã€ç„¡æ—¥æœŸã€ä¸å¯ç€è¦½å­˜æª”ã€‚",
    lnk: {
      pdfqr:"QR PDF", kit:"å¥—ä»¶ï¼ˆPDFï¼‰", ver:"æ°¸ä¹…ç‰ˆï¼ˆPDFï¼‰", orig:"çœŸå¯¦èµ·æºï¼ˆPDFï¼‰",
      neut:"ä¸­ç«‹", nonapp:"ä¸å¯å æœ‰", stat:"æ°¸ä¹…ç« ç¨‹", primo:"ç¬¬ä¸€æ¬¡äº¤æ›", lic:"æŽˆæ¬Š",
      qr:"QR", faq:"FAQ", stampaQr:"åˆ—å° QR"
    },
    ok: "å·²ç¢ºèªã€‚",
    warnNum: "å°Šé‡è‡ªå·±ä¹Ÿå°Šé‡ä»–äººã€‚Mango ä¸èƒ½è¢«è¨ˆæ•¸ã€‚",
    savedEmpty: "è«‹å…ˆå¯«ä¸€å¥çœŸå¯¦çš„äº‹å†é€å‡ºã€‚",
    archiveEmpty: "å­˜æª”æ˜¯ç©ºçš„ã€‚",
    confirmWipe: "è¦æ¸…ç©ºæœ¬æ©Ÿå­˜æª”å—Žï¼Ÿ",
    wiped: "å·²æ¸…ç©ºã€‚"
  }
};

/* =========================
   Muro: frasi base (per lingua)
   (ne scegliamo 7 random)
========================= */
const MURO_POOL = {
  it: [
    "Qualcuno ha aiutato qualcuno.",
    "Qualcuno ha ascoltato qualcuno.",
    "Qualcuno ha insegnato qualcosa di difficile a qualcuno.",
    "Qualcuno ha accompagnato qualcuno a un appuntamento.",
    "Qualcuno ha riparato qualcosa per qualcuno.",
    "Qualcuno ha cucinato per qualcuno.",
    "Qualcuno ha tradotto un documento per qualcuno.",
    "Qualcuno ha portato qualcosa a qualcuno che non poteva uscire.",
    "Qualcuno ha fatto compagnia a qualcuno.",
    "Qualcuno ha fatto una telefonata importante per qualcuno."
  ],
  en: [
    "Someone helped someone.",
    "Someone listened to someone.",
    "Someone taught something difficult to someone.",
    "Someone accompanied someone to an appointment.",
    "Someone fixed something for someone.",
    "Someone cooked for someone.",
    "Someone translated a document for someone.",
    "Someone brought something to someone who couldnâ€™t go out.",
    "Someone kept someone company.",
    "Someone made an important phone call for someone."
  ],
  es: [
    "Alguien ayudÃ³ a alguien.",
    "Alguien escuchÃ³ a alguien.",
    "Alguien enseÃ±Ã³ algo difÃ­cil a alguien.",
    "Alguien acompaÃ±Ã³ a alguien a una cita.",
    "Alguien reparÃ³ algo para alguien.",
    "Alguien cocinÃ³ para alguien.",
    "Alguien tradujo un documento para alguien.",
    "Alguien llevÃ³ algo a alguien que no podÃ­a salir.",
    "Alguien hizo compaÃ±Ã­a a alguien.",
    "Alguien hizo una llamada importante por alguien."
  ],
  fr: [
    "Quelquâ€™un a aidÃ© quelquâ€™un.",
    "Quelquâ€™un a Ã©coutÃ© quelquâ€™un.",
    "Quelquâ€™un a enseignÃ© quelque chose de difficile Ã  quelquâ€™un.",
    "Quelquâ€™un a accompagnÃ© quelquâ€™un Ã  un rendez-vous.",
    "Quelquâ€™un a rÃ©parÃ© quelque chose pour quelquâ€™un.",
    "Quelquâ€™un a cuisinÃ© pour quelquâ€™un.",
    "Quelquâ€™un a traduit un document pour quelquâ€™un.",
    "Quelquâ€™un a apportÃ© quelque chose Ã  quelquâ€™un qui ne pouvait pas sortir.",
    "Quelquâ€™un a tenu compagnie Ã  quelquâ€™un.",
    "Quelquâ€™un a passÃ© un appel important pour quelquâ€™un."
  ],
  de: [
    "Jemand hat jemandem geholfen.",
    "Jemand hat jemandem zugehÃ¶rt.",
    "Jemand hat jemandem etwas Schwieriges beigebracht.",
    "Jemand hat jemanden zu einem Termin begleitet.",
    "Jemand hat etwas fÃ¼r jemanden repariert.",
    "Jemand hat fÃ¼r jemanden gekocht.",
    "Jemand hat ein Dokument fÃ¼r jemanden Ã¼bersetzt.",
    "Jemand hat jemandem etwas gebracht, der nicht raus konnte.",
    "Jemand hat jemandem Gesellschaft geleistet.",
    "Jemand hat einen wichtigen Anruf fÃ¼r jemanden gemacht."
  ],
  zh: [
    "æœ‰äººå¹«åŠ©äº†æŸäººã€‚",
    "æœ‰äººå‚¾è½äº†æŸäººã€‚",
    "æœ‰äººæ•™æœƒæŸäººä¸€ä»¶å›°é›£çš„äº‹ã€‚",
    "æœ‰äººé™ªæŸäººåŽ»èµ´ç´„ã€‚",
    "æœ‰äººæ›¿æŸäººä¿®å¥½äº†æ±è¥¿ã€‚",
    "æœ‰äººæ›¿æŸäººç…®äº†ä¸€é¤ã€‚",
    "æœ‰äººæ›¿æŸäººç¿»è­¯äº†ä¸€ä»½æ–‡ä»¶ã€‚",
    "æœ‰äººæŠŠæ±è¥¿é€çµ¦ç„¡æ³•å¤–å‡ºçš„æŸäººã€‚",
    "æœ‰äººé™ªä¼´äº†æŸäººã€‚",
    "æœ‰äººæ›¿æŸäººæ‰“äº†ä¸€é€šé‡è¦é›»è©±ã€‚"
  ]
};

/* =========================
   Registro locale
========================= */
const STORAGE_KEY = "MANGO_REGISTRO_UNICO_V2";

function safeParse(raw){
  try { return JSON.parse(raw); } catch(e){ return null; }
}
function normalizeText(t){
  return (t || "")
    .replace(/\s+/g," ")
    .replace(/\u00A0/g," ")
    .trim();
}
function readArchive(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return [];
  const parsed = safeParse(raw);
  if(!Array.isArray(parsed)) return [];
  // array di oggetti {text, ts}
  return parsed
    .map(x => (x && typeof x.text === "string") ? ({text: normalizeText(x.text), ts: Number(x.ts)||0}) : null)
    .filter(Boolean)
    .filter(x => x.text.length>0);
}
function writeArchive(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}
function dedup(arr){
  const seen = new Set();
  const out = [];
  for(const r of arr){
    const key = r.text.toLowerCase();
    if(seen.has(key)) continue;
    seen.add(key);
    out.push(r);
  }
  return out;
}

/* =========================
   Blocchi anti-numeri/misure
========================= */
function containsForbidden(text){
  // numeri ovunque (0-9), percentuali, valuta, segni di misura/contabilitÃ  frequenti
  if(/[0-9]/.test(text)) return true;
  if(/[%â‚¬$Â£Â¥â‚¿]/.test(text)) return true;
  // parole tipiche di misure/conti (minimo, ma utile)
  if(/\b(kg|g|gr|km|m|cm|mm|litri|l|ml|h|ore|min|sec|â‚¬uro|dollari|percento|per cento|totale|saldo|credito|debito)\b/i.test(text)) return true;
  // formule tipo 2+2, 3/4, 10x, ecc.
  if(/[\+\-\*\/=]/.test(text) && /[0-9]/.test(text)) return true;
  return false;
}

/* =========================
   UI + Lingua
========================= */
function getLang(){
  const url = new URL(window.location.href);
  const q = (url.searchParams.get("lang") || "").toLowerCase();
  if(STR[q]) return q;
  return "it";
}
function setLang(lang){
  const url = new URL(window.location.href);
  url.searchParams.set("lang", lang);
  history.replaceState({}, "", url.toString());
  applyLang(lang);
  renderMuro(lang);
  updateCount(lang);
}
function applyLang(lang){
  const s = STR[lang] || STR.it;
  document.documentElement.lang = (lang==="zh" ? "zh-Hant" : lang);

  // chips
  document.querySelectorAll(".chip").forEach(ch=>{
    ch.classList.toggle("active", ch.dataset.lang === lang);
  });

  // texts
  document.getElementById("brandSub").textContent = s.brandSub;
  document.getElementById("heroTitle").textContent = s.heroTitle;
  document.getElementById("heroLead").textContent = s.heroLead;
  document.getElementById("riga").placeholder = s.taPh;

  document.getElementById("btnInvia").textContent = s.btnInvia;
  document.getElementById("btnPulisci").textContent = s.btnPulisci;
  document.getElementById("btnApri").textContent = s.btnApri;
  document.getElementById("btnSvuota").textContent = s.btnSvuota;

  document.getElementById("noteLocal").textContent = s.noteLocal;
  document.getElementById("aboutTitle").textContent = s.aboutTitle;
  document.getElementById("aboutText").textContent = s.aboutText;
  document.getElementById("muroTitle").textContent = s.muroTitle;
  document.getElementById("muroLead").textContent = s.muroLead;

  // links label
  document.getElementById("btnQR").textContent = s.lnk.qr;
  document.getElementById("btnFAQ").textContent = s.lnk.faq;
  document.getElementById("btnLic").textContent = s.lnk.lic;
  document.getElementById("btnStampaQr").textContent = s.lnk.stampaQr;

  document.getElementById("lnkPdfQr").textContent = s.lnk.pdfqr;
  document.getElementById("lnkKit").textContent = s.lnk.kit;
  document.getElementById("lnkVer").textContent = s.lnk.ver;
  document.getElementById("lnkOrig").textContent = s.lnk.orig;
  document.getElementById("lnkNeut").textContent = s.lnk.neut;
  document.getElementById("lnkNonApp").textContent = s.lnk.nonapp;
  document.getElementById("lnkStat").textContent = s.lnk.stat;
  document.getElementById("lnkPrimo").textContent = s.lnk.primo;
  document.getElementById("lnkLic").textContent = s.lnk.lic;

  // badge muro
  const badgeLabel = (lang==="zh" ? "ä¸­æ–‡ ðŸ¥­" : lang.toUpperCase()+" ðŸ¥­");
  document.getElementById("muroLangBadge").textContent = badgeLabel;
}

function showStatus(kind, text){
  const el = document.getElementById("status");
  el.classList.remove("good","warn");
  el.textContent = text;
  if(kind==="good") el.classList.add("good");
  if(kind==="warn") el.classList.add("warn");
}

/* =========================
   Muro (7 righe lingua corrente)
========================= */
function pick7(arr){
  const copy = arr.slice();
  // shuffle
  for(let i=copy.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [copy[i], copy[j]] = [copy[j], copy[i]];
  }
  return copy.slice(0,7);
}
function renderMuro(lang){
  const pool = MURO_POOL[lang] || MURO_POOL.it;
  const chosen = pick7(pool);
  const ul = document.getElementById("muroList");
  ul.innerHTML = "";
  for(const line of chosen){
    const li = document.createElement("li");
    li.textContent = line;
    ul.appendChild(li);
  }
}

/* =========================
   Archivio actions
========================= */
function updateCount(lang){
  const s = STR[lang] || STR.it;
  const n = readArchive().length;
  document.getElementById("count").textContent = s.count(n);

  // abilitazione bottone invia (solo se câ€™Ã¨ testo)
  const ta = document.getElementById("riga");
  document.getElementById("btnInvia").disabled = (normalizeText(ta.value).length === 0);
}

function saveLine(lang){
  const s = STR[lang] || STR.it;
  const ta = document.getElementById("riga");
  const text = normalizeText(ta.value);

  if(!text){
    showStatus("warn", s.savedEmpty);
    return;
  }

  if(containsForbidden(text)){
    showStatus("warn", s.warnNum);
    return;
  }

  const arr = readArchive();
  const merged = dedup([{text, ts: Date.now()}, ...arr]);
  writeArchive(merged);

  ta.value = "";
  showStatus("good", s.ok);
  updateCount(lang);
}

function openArchive(lang){
  const s = STR[lang] || STR.it;
  const arr = readArchive();
  if(!arr.length){
    alert(s.archiveEmpty);
    return;
  }
  const lines = arr.slice(0,30).map(x => `â€¢ ${x.text}`).join("\n\n");
  alert(lines + (arr.length>30 ? `\n\nâ€¦ (${arr.length-30})` : ""));
}

function wipeArchive(lang){
  const s = STR[lang] || STR.it;
  if(!confirm(s.confirmWipe)) return;
  writeArchive([]);
  showStatus("good", s.wiped);
  updateCount(lang);
}

/* =========================
   Init
========================= */
(function init(){
  const lang = getLang();
  applyLang(lang);
  renderMuro(lang);
  updateCount(lang);

  // mango -> Bianco.html
  document.getElementById("mangoBtn").addEventListener("click", ()=>{
    window.location.href = "Bianco.html";
  });

  // language chips
  document.querySelectorAll(".chip").forEach(ch=>{
    ch.addEventListener("click", ()=> setLang(ch.dataset.lang));
  });

  // textarea listeners
  const ta = document.getElementById("riga");
  ta.addEventListener("input", ()=> updateCount(getLang()));
  ta.addEventListener("keydown", (e)=>{
    // Enter invia, Shift+Enter va a capo
    if(e.key === "Enter" && !e.shiftKey){
      e.preventDefault();
      saveLine(getLang());
    }
  });

  // buttons
  document.getElementById("btnInvia").addEventListener("click", ()=> saveLine(getLang()));
  document.getElementById("btnPulisci").addEventListener("click", ()=>{
    ta.value = "";
    document.getElementById("status").classList.remove("good","warn");
    document.getElementById("status").textContent = "";
    document.getElementById("status").style.display = "none";
    // ripristina display via class quando serve
    updateCount(getLang());
  });
  document.getElementById("btnApri").addEventListener("click", ()=> openArchive(getLang()));
  document.getElementById("btnSvuota").addEventListener("click", ()=> wipeArchive(getLang()));

  // status display logic: se non ha class, nascondi
  const statusEl = document.getElementById("status");
  const obs = new MutationObserver(()=>{
    const has = statusEl.classList.contains("good") || statusEl.classList.contains("warn");
    statusEl.style.display = has ? "block" : "none";
  });
  obs.observe(statusEl, {attributes:true, attributeFilter:["class"]});
})();
</script>
</body>
</html>
