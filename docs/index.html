<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Mango â€” infrastruttura di fiducia locale</title>
  <meta name="description" content="Mango â€” infrastruttura di fiducia locale non monetaria, non appropriabile, anti-accumulo e anti-cattura." />
  <meta name="theme-color" content="#0b0f16" />
  <style>
    :root{
      --bg:#0b0f16; --panel:#0f1622; --panel2:#0e141f;
      --text:#e8edf7; --muted:#a8b3c7;
      --line:#1d2a3f; --accent:#4aa3ff; --good:#2dd4bf; --warn:#ff6b6b;
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background: radial-gradient(1200px 500px at 20% -10%, rgba(74,163,255,.12), transparent 60%),
                  radial-gradient(900px 400px at 90% 0%, rgba(45,212,191,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
      padding:18px 14px 40px;
    }
    a{color:var(--text)}
    .wrap{max-width:780px;margin:0 auto}
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:14px 14px; border:1px solid var(--line); background:rgba(15,22,34,.72);
      border-radius: var(--radius);
      backdrop-filter: blur(10px);
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:46px;height:46px;border-radius:14px;display:grid;place-items:center;
      border:1px solid rgba(255,255,255,.08);
      background: linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      font-size:26px;
    }
    .brand h1{margin:0;font-size:18px;line-height:1.1}
    .brand .sub{margin:0;color:var(--muted);font-size:13px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;justify-content:flex-end}
    .chip{
      border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.04);
      padding:8px 10px;border-radius:999px;font-size:13px;color:var(--text);
      cursor:pointer; user-select:none;
    }
    .chip.active{border-color:rgba(74,163,255,.65); box-shadow:0 0 0 3px rgba(74,163,255,.14) inset}
    .card{
      margin-top:14px; padding:16px 14px; border-radius: var(--radius);
      border:1px solid var(--line); background:rgba(15,22,34,.65);
      backdrop-filter: blur(10px);
    }
    .card h2{margin:0 0 8px;font-size:22px}
    .card p{margin:8px 0;color:var(--muted);line-height:1.45}
    .btnrow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:12px 14px; border-radius:14px; border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.05); color:var(--text); text-decoration:none;
      font-weight:700;
      cursor:pointer;
    }
    .btn.primary{
      border-color:rgba(74,163,255,.45);
      background: linear-gradient(180deg, rgba(74,163,255,.20), rgba(74,163,255,.08));
    }
    .btn.warn{
      border-color:rgba(255,107,107,.35);
      background: linear-gradient(180deg, rgba(255,107,107,.18), rgba(255,107,107,.06));
      color:var(--text);
    }
    .btn:disabled{
      opacity:.45; cursor:not-allowed;
    }
    .grid{display:grid;gap:12px}
    textarea{
      width:100%; min-height:86px; resize:vertical;
      border-radius:16px; border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.20);
      color:var(--text);
      padding:12px 12px;
      font-size:16px; line-height:1.35;
      outline:none;
    }
    .small{font-size:13px;color:var(--muted)}
    .count{margin-top:10px;color:var(--muted);font-weight:700}
    .divider{height:1px;background:var(--line);margin:14px 0}
    .toast{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:18px; z-index:9999;
      background:rgba(15,22,34,.92);
      border:1px solid rgba(255,255,255,.12);
      padding:12px 14px; border-radius:16px;
      color:var(--text);
      max-width:min(720px, calc(100vw - 28px));
      display:none;
      backdrop-filter: blur(10px);
      box-shadow:0 10px 30px rgba(0,0,0,.40);
      font-weight:800;
    }
    .toast.show{display:block}
    .toast.good{border-color:rgba(45,212,191,.35)}
    .toast.warn{border-color:rgba(255,107,107,.35)}
    .muro-wrap{margin-top:10px}
    .muro-box{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.03);
      border-radius:16px;
      padding:12px 12px;
      margin-top:10px;
      display:flex; align-items:center; justify-content:space-between;
      cursor:pointer;
    }
    .muro-box .tag{font-weight:900; letter-spacing:.04em}
    .muro-box .mango{opacity:.85}
    .muro-list{
      margin:10px 0 0 0;
      padding: 0 0 0 18px;
      color:var(--text);
    }
    .muro-list li{margin:6px 0; color:var(--muted); line-height:1.35}
    footer{
      margin-top:18px;
      text-align:center;
      color:var(--muted);
      font-size:13px;
      padding:12px 0;
    }
    .hidden{display:none!important}
  </style>
</head>

<body>
  <div class="wrap">

    <div class="top">
      <div class="brand">
        <div class="logo" aria-hidden="true">ðŸ¥­</div>
        <div>
          <h1 id="titleTxt">Mango</h1>
          <p class="sub" id="subTxt">Infrastruttura di fiducia locale</p>
        </div>
      </div>

      <div class="chips" aria-label="Language">
        <div class="chip active" data-lang="it">IT</div>
        <div class="chip" data-lang="en">EN</div>
        <div class="chip" data-lang="es">ES</div>
        <div class="chip" data-lang="fr">FR</div>
        <div class="chip" data-lang="de">DE</div>
        <div class="chip" data-lang="zh-hant">ä¸­æ–‡</div>
      </div>
    </div>

    <!-- Fai Mango adesso -->
    <section class="card" id="sec1">
      <h2 id="sec1Title">Fai Mango adesso</h2>
      <p id="sec1Text">Mango Ã¨ unâ€™infrastruttura di fiducia locale: fai qualcosa di reale per qualcuno, poi scrivi una riga.</p>
      <div class="btnrow">
        <a class="btn primary" id="btnQR" href="#sec2">Stampa & QR</a>
        <a class="btn" id="btnDoc" href="documento-fondativo.html">Leggi il documento fondativo</a>
        <a class="btn" id="btnFAQ" href="faq.html">FAQ</a>
      </div>
    </section>

    <!-- Scrivi una riga -->
    <section class="card" id="sec2">
      <h2 id="sec2Title">Scrivi una riga</h2>

      <p class="small" id="sec2Note">
        Nota: lâ€™archivio Ã¨ locale sul tuo dispositivo (non Ã¨ pubblico).
      </p>

      <div class="grid">
        <textarea id="riga" placeholder="Scrivi una riga (senza numeri). Shift+Invio per andare a capo."></textarea>

        <div class="btnrow">
          <button class="btn primary" id="btnInvia" disabled>Invia riga</button>
          <button class="btn" id="btnPulisci">Pulisci</button>
          <button class="btn" id="btnApriArchivio">Apri archivio</button>
          <button class="btn warn" id="btnSvuotaArchivio">Svuota archivio</button>
        </div>

        <div class="count" id="countTxt">Righe in archivio: 0</div>

        <p class="small" id="rulesTxt">
          Regole rapide: scrivi solo ciÃ² che Ã¨ accaduto davvero. Niente cifre. Se vuoi andare a capo, usa Shift+Invio.
        </p>

        <p class="small" id="qrNoteTxt">
          Se vuoi, stampa il QR: chiunque potrÃ  iniziare dal telefono.
        </p>
      </div>
    </section>

    <!-- Cos'Ã¨ Mango -->
    <section class="card" id="sec3">
      <h2 id="sec3Title">Cosâ€™Ã¨ Mango</h2>
      <p id="sec3Text">
        Mango Ã¨ unâ€™infrastruttura di fiducia locale non monetaria, non appropriabile, progettata per evitare accumulo, speculazione e cattura istituzionale.
        Creato da Juan de Dios Annaloro Mercedes in memoria di Larimar.
      </p>
      <div class="btnrow">
        <a class="btn primary" id="btnPDF" href="documento-fondativo.html">Leggi il documento fondativo</a>
        <a class="btn" id="btnFAQ2" href="faq.html">FAQ</a>
      </div>
    </section>

    <!-- Muro Mango -->
    <section class="card" id="muro">
      <h2 id="muroTitle">Muro Mango</h2>
      <p id="muroDesc">Sette righe anonime per lingua, scelte a caso a ogni visita. Senza identitÃ , senza date, senza archivio consultabile.</p>

      <div class="muro-wrap" id="muroWrap">
        <!-- boxes injected -->
      </div>
    </section>

    <footer id="footerTxt">Mango â€” nato il 02 febbraio 2026</footer>
  </div>

  <div class="toast" id="toast"></div>

<script>
/* =========================================================
   Mango â€” Single-file index (multilingua + invio + muro 7)
   ========================================================= */

/* ---------- Strings (6 lingue) ---------- */
const STR = {
  it: {
    title:"Mango",
    sub:"Infrastruttura di fiducia locale",
    sec1Title:"Fai Mango adesso",
    sec1Text:"Mango Ã¨ unâ€™infrastruttura di fiducia locale: fai qualcosa di reale per qualcuno, poi scrivi una riga.",
    btnQR:"Stampa & QR",
    btnDoc:"Leggi il documento fondativo",
    btnFAQ:"FAQ",
    sec2Title:"Scrivi una riga",
    sec2Note:"Nota: lâ€™archivio Ã¨ locale sul tuo dispositivo (non Ã¨ pubblico).",
    rigaPh:"Scrivi una riga (senza numeri). Shift+Invio per andare a capo.",
    btnInvia:"Invia riga",
    btnPulisci:"Pulisci",
    btnApri:"Apri archivio",
    btnSvuota:"Svuota archivio",
    count:"Righe in archivio: ",
    rules:"Regole rapide: scrivi solo ciÃ² che Ã¨ accaduto davvero. Niente cifre. Se vuoi andare a capo, usa Shift+Invio.",
    qrNote:"Se vuoi, stampa il QR: chiunque potrÃ  iniziare dal telefono.",
    sec3Title:"Cosâ€™Ã¨ Mango",
    sec3Text:"Mango Ã¨ unâ€™infrastruttura di fiducia locale non monetaria, non appropriabile, progettata per evitare accumulo, speculazione e cattura istituzionale. Creato da Juan de Dios Annaloro Mercedes in memoria di Larimar.",
    btnPDF:"Leggi il documento fondativo",
    muroTitle:"Muro Mango",
    muroDesc:"Sette righe anonime per lingua, scelte a caso a ogni visita. Senza identitÃ , senza date, senza archivio consultabile.",
    savedOk:"Riga salvata.",
    savedEmpty:"Scrivi qualcosa prima di inviare.",
    warnNumbers:"Numeri non ammessi in Mango.",
    cleared:"Pulito.",
    archiveEmpty:"Archivio vuoto.",
    confirmWipe:"Vuoi davvero svuotare lâ€™archivio locale?",
    wiped:"Archivio svuotato.",
    openTitle:"Righe (prime 30)",
  },
  en: {
    title:"Mango",
    sub:"Local trust infrastructure",
    sec1Title:"Do Mango now",
    sec1Text:"Mango is local trust infrastructure: do something real for someone, then write one line.",
    btnQR:"Print & QR",
    btnDoc:"Read the founding document",
    btnFAQ:"FAQ",
    sec2Title:"Write one line",
    sec2Note:"Note: the archive is local on your device (not public).",
    rigaPh:"Write one line (no numbers). Shift+Enter for a new line.",
    btnInvia:"Send line",
    btnPulisci:"Clear",
    btnApri:"Open archive",
    btnSvuota:"Wipe archive",
    count:"Lines in archive: ",
    rules:"Quick rules: write only what truly happened. No numbers. Use Shift+Enter for a new line.",
    qrNote:"If you want, print the QR: anyone can start from their phone.",
    sec3Title:"What is Mango",
    sec3Text:"Mango is a non-monetary, non-appropriable local trust infrastructure, designed to prevent accumulation, speculation, and institutional capture. Created by Juan de Dios Annaloro Mercedes in memory of Larimar.",
    btnPDF:"Read the founding document",
    muroTitle:"Mango Wall",
    muroDesc:"Seven anonymous lines per language, randomly selected on each visit. No identities, no dates, no browsable archive.",
    savedOk:"Line saved.",
    savedEmpty:"Write something before sending.",
    warnNumbers:"Numbers are not allowed in Mango.",
    cleared:"Cleared.",
    archiveEmpty:"Archive is empty.",
    confirmWipe:"Do you really want to wipe the local archive?",
    wiped:"Archive wiped.",
    openTitle:"Lines (first 30)",
  },
  es: {
    title:"Mango",
    sub:"Infraestructura de confianza local",
    sec1Title:"Haz Mango ahora",
    sec1Text:"Mango es una infraestructura de confianza local: haz algo real por alguien y luego escribe una lÃ­nea.",
    btnQR:"Imprimir & QR",
    btnDoc:"Leer el documento fundacional",
    btnFAQ:"FAQ",
    sec2Title:"Escribe una lÃ­nea",
    sec2Note:"Nota: el archivo es local en tu dispositivo (no es pÃºblico).",
    rigaPh:"Escribe una lÃ­nea (sin nÃºmeros). Shift+Enter para salto de lÃ­nea.",
    btnInvia:"Enviar lÃ­nea",
    btnPulisci:"Limpiar",
    btnApri:"Abrir archivo",
    btnSvuota:"Vaciar archivo",
    count:"LÃ­neas en archivo: ",
    rules:"Reglas rÃ¡pidas: escribe solo lo que pasÃ³ de verdad. Sin cifras. Shift+Enter para salto de lÃ­nea.",
    qrNote:"Si quieres, imprime el QR: cualquiera puede empezar desde el telÃ©fono.",
    sec3Title:"QuÃ© es Mango",
    sec3Text:"Mango es una infraestructura de confianza local no monetaria, no apropiable, diseÃ±ada para evitar acumulaciÃ³n, especulaciÃ³n y captura institucional. Creado por Juan de Dios Annaloro Mercedes en memoria de Larimar.",
    btnPDF:"Leer el documento fundacional",
    muroTitle:"Muro Mango",
    muroDesc:"Siete lÃ­neas anÃ³nimas por idioma, elegidas al azar en cada visita. Sin identidades, sin fechas, sin archivo consultable.",
    savedOk:"LÃ­nea guardada.",
    savedEmpty:"Escribe algo antes de enviar.",
    warnNumbers:"Los nÃºmeros no estÃ¡n permitidos en Mango.",
    cleared:"Limpio.",
    archiveEmpty:"Archivo vacÃ­o.",
    confirmWipe:"Â¿Seguro que quieres vaciar el archivo local?",
    wiped:"Archivo vaciado.",
    openTitle:"LÃ­neas (primeras 30)",
  },
  fr: {
    title:"Mango",
    sub:"Infrastructure de confiance locale",
    sec1Title:"Fais Mango maintenant",
    sec1Text:"Mango est une infrastructure de confiance locale : fais quelque chose de rÃ©el pour quelquâ€™un, puis Ã©cris une ligne.",
    btnQR:"Imprimer & QR",
    btnDoc:"Lire le document fondateur",
    btnFAQ:"FAQ",
    sec2Title:"Ã‰cris une ligne",
    sec2Note:"Note : lâ€™archive est locale sur ton appareil (non publique).",
    rigaPh:"Ã‰cris une ligne (sans nombres). Maj+EntrÃ©e pour aller Ã  la ligne.",
    btnInvia:"Envoyer",
    btnPulisci:"Effacer",
    btnApri:"Ouvrir lâ€™archive",
    btnSvuota:"Vider lâ€™archive",
    count:"Lignes dans lâ€™archive : ",
    rules:"RÃ¨gles rapides : Ã©cris seulement ce qui sâ€™est vraiment passÃ©. Pas de chiffres. Maj+EntrÃ©e pour aller Ã  la ligne.",
    qrNote:"Si tu veux, imprime le QR : nâ€™importe qui pourra commencer depuis le tÃ©lÃ©phone.",
    sec3Title:"Quâ€™est-ce que Mango",
    sec3Text:"Mango est une infrastructure de confiance locale non monÃ©taire, non appropriable, conÃ§ue pour Ã©viter lâ€™accumulation, la spÃ©culation et la capture institutionnelle. CrÃ©Ã© par Juan de Dios Annaloro Mercedes en mÃ©moire de Larimar.",
    btnPDF:"Lire le document fondateur",
    muroTitle:"Mur Mango",
    muroDesc:"Sept lignes anonymes par langue, tirÃ©es au hasard Ã  chaque visite. Sans identitÃ©s, sans dates, sans archive consultable.",
    savedOk:"Ligne enregistrÃ©e.",
    savedEmpty:"Ã‰cris quelque chose avant dâ€™envoyer.",
    warnNumbers:"Les nombres ne sont pas autorisÃ©s dans Mango.",
    cleared:"EffacÃ©.",
    archiveEmpty:"Archive vide.",
    confirmWipe:"Veux-tu vraiment vider lâ€™archive locale ?",
    wiped:"Archive vidÃ©e.",
    openTitle:"Lignes (30 premiÃ¨res)",
  },
  de: {
    title:"Mango",
    sub:"Lokale Vertrauens-Infrastruktur",
    sec1Title:"Mach Mango jetzt",
    sec1Text:"Mango ist lokale Vertrauens-Infrastruktur: Tu etwas Reales fÃ¼r jemanden und schreibe dann eine Zeile.",
    btnQR:"Druck & QR",
    btnDoc:"GrÃ¼ndungsdokument lesen",
    btnFAQ:"FAQ",
    sec2Title:"Schreibe eine Zeile",
    sec2Note:"Hinweis: Das Archiv ist lokal auf deinem GerÃ¤t (nicht Ã¶ffentlich).",
    rigaPh:"Schreibe eine Zeile (keine Zahlen). Shift+Enter fÃ¼r Zeilenumbruch.",
    btnInvia:"Senden",
    btnPulisci:"Leeren",
    btnApri:"Archiv Ã¶ffnen",
    btnSvuota:"Archiv lÃ¶schen",
    count:"Zeilen im Archiv: ",
    rules:"Kurzregeln: Schreib nur, was wirklich passiert ist. Keine Zahlen. Shift+Enter fÃ¼r Zeilenumbruch.",
    qrNote:"Wenn du willst, druck den QR: Jeder kann am Telefon starten.",
    sec3Title:"Was ist Mango",
    sec3Text:"Mango ist eine nicht-monetÃ¤re, nicht aneignbare lokale Vertrauens-Infrastruktur, entwickelt um Akkumulation, Spekulation und institutionelle Vereinnahmung zu vermeiden. Geschaffen von Juan de Dios Annaloro Mercedes im Gedenken an Larimar.",
    btnPDF:"GrÃ¼ndungsdokument lesen",
    muroTitle:"Mango-Mauer",
    muroDesc:"Sieben anonyme Zeilen pro Sprache, bei jedem Besuch zufÃ¤llig gewÃ¤hlt. Keine IdentitÃ¤ten, keine Daten, kein durchsuchbares Archiv.",
    savedOk:"Zeile gespeichert.",
    savedEmpty:"Schreibe etwas vor dem Senden.",
    warnNumbers:"Zahlen sind in Mango nicht erlaubt.",
    cleared:"Geleert.",
    archiveEmpty:"Archiv ist leer.",
    confirmWipe:"MÃ¶chtest du das lokale Archiv wirklich lÃ¶schen?",
    wiped:"Archiv gelÃ¶scht.",
    openTitle:"Zeilen (erste 30)",
  },
  "zh-hant": {
    title:"Mango",
    sub:"åœ¨åœ°ä¿¡ä»»åŸºç¤Žè¨­æ–½",
    sec1Title:"ç¾åœ¨å°±åš Mango",
    sec1Text:"Mango æ˜¯åœ¨åœ°ä¿¡ä»»åŸºç¤Žè¨­æ–½ï¼šå…ˆç‚ºæŸäººåšä¸€ä»¶çœŸå¯¦çš„äº‹ï¼Œç„¶å¾Œå¯«ä¸‹ä¸€è¡Œã€‚",
    btnQR:"åˆ—å°èˆ‡ QR",
    btnDoc:"é–±è®€å‰µå§‹æ–‡ä»¶",
    btnFAQ:"FAQ",
    sec2Title:"å¯«ä¸‹ä¸€è¡Œ",
    sec2Note:"æ³¨æ„ï¼šæ­¤å­˜æª”åªåœ¨ä½ çš„è£ç½®ä¸Šï¼ˆä¸å…¬é–‹ï¼‰ã€‚",
    rigaPh:"å¯«ä¸‹ä¸€è¡Œï¼ˆä¸å¯å«æ•¸å­—ï¼‰ã€‚Shift+Enter å¯æ›è¡Œã€‚",
    btnInvia:"é€å‡º",
    btnPulisci:"æ¸…é™¤",
    btnApri:"é–‹å•Ÿå­˜æª”",
    btnSvuota:"æ¸…ç©ºå­˜æª”",
    count:"å­˜æª”è¡Œæ•¸ï¼š",
    rules:"å¿«é€Ÿè¦å‰‡ï¼šåªå¯«çœŸå¯¦ç™¼ç”Ÿçš„äº‹ã€‚ä¸å¯æœ‰æ•¸å­—ã€‚Shift+Enter å¯æ›è¡Œã€‚",
    qrNote:"è‹¥ä½ é¡˜æ„ï¼Œå¯ä»¥åˆ—å° QRï¼šä»»ä½•äººéƒ½èƒ½ç”¨æ‰‹æ©Ÿé–‹å§‹ã€‚",
    sec3Title:"ä»€éº¼æ˜¯ Mango",
    sec3Text:"Mango æ˜¯éžè²¨å¹£ã€ä¸å¯è¢«å æœ‰çš„åœ¨åœ°ä¿¡ä»»åŸºç¤Žè¨­æ–½ï¼Œç”¨ä¾†é¿å…ç´¯ç©ã€æŠ•æ©Ÿèˆ‡åˆ¶åº¦æ€§æ”«å–ã€‚ç”± Juan de Dios Annaloro Mercedes å‰µå»ºï¼Œä»¥ç´€å¿µ Larimarã€‚",
    btnPDF:"é–±è®€å‰µå§‹æ–‡ä»¶",
    muroTitle:"Mango ç‰†",
    muroDesc:"æ¯ç¨®èªžè¨€ 7 è¡ŒåŒ¿åæ–‡å­—ï¼Œæ¯æ¬¡é€ è¨ªéš¨æ©Ÿé¡¯ç¤ºã€‚ç„¡èº«åˆ†ã€ç„¡æ—¥æœŸã€ä¸å¯æŸ¥è©¢å­˜æª”ã€‚",
    savedOk:"å·²å„²å­˜ã€‚",
    savedEmpty:"è«‹å…ˆå¯«é»žå…§å®¹å†é€å‡ºã€‚",
    warnNumbers:"Mango ä¸å…è¨±æ•¸å­—ã€‚",
    cleared:"å·²æ¸…é™¤ã€‚",
    archiveEmpty:"å­˜æª”ç‚ºç©ºã€‚",
    confirmWipe:"ç¢ºå®šè¦æ¸…ç©ºæœ¬æ©Ÿå­˜æª”å—Žï¼Ÿ",
    wiped:"å·²æ¸…ç©ºå­˜æª”ã€‚",
    openTitle:"æ–‡å­—ï¼ˆå‰ 30 è¡Œï¼‰",
  }
};

/* ---------- Muro Mango (7 righe per lingua, sempre visibili) ---------- */
const MURO_LINES = {
  it: [
    "Qualcuno ha prestato ascolto a qualcuno.",
    "Qualcuno ha fatto compagnia a qualcuno.",
    "Qualcuno ha portato qualcosa a qualcuno che non poteva uscire.",
    "Qualcuno ha aiutato qualcuno a fare ordine.",
    "Qualcuno ha riparato qualcosa per qualcuno.",
    "Qualcuno ha tradotto un documento per qualcuno.",
    "Qualcuno ha fatto una telefonata importante per qualcuno.",
    "Qualcuno ha insegnato qualcosa di difficile a qualcuno.",
    "Qualcuno ha cucinato per qualcuno.",
    "Qualcuno ha accompagnato qualcuno a un appuntamento.",
    "Qualcuno ha dato un passaggio a qualcuno."
  ],
  en: [
    "Someone listened to someone.",
    "Someone kept someone company.",
    "Someone brought something to someone who couldn't go out.",
    "Someone helped someone get organized.",
    "Someone fixed something for someone.",
    "Someone translated a document for someone.",
    "Someone made an important phone call for someone.",
    "Someone taught something difficult to someone.",
    "Someone cooked for someone.",
    "Someone accompanied someone to an appointment.",
    "Someone gave someone a ride."
  ],
  es: [
    "Alguien escuchÃ³ a alguien.",
    "Alguien acompaÃ±Ã³ a alguien con su presencia.",
    "Alguien llevÃ³ algo a alguien que no podÃ­a salir.",
    "Alguien ayudÃ³ a alguien con un trÃ¡mite.",
    "Alguien arreglÃ³ algo para alguien.",
    "Alguien tradujo un documento para alguien.",
    "Alguien hizo una llamada importante por alguien.",
    "Alguien enseÃ±Ã³ algo difÃ­cil a alguien.",
    "Alguien cocinÃ³ para alguien.",
    "Alguien acompaÃ±Ã³ a alguien a una cita.",
    "Alguien dio un aventÃ³n a alguien."
  ],
  fr: [
    "Quelquâ€™un a Ã©coutÃ© quelquâ€™un.",
    "Quelquâ€™un a tenu compagnie Ã  quelquâ€™un.",
    "Quelquâ€™un a apportÃ© quelque chose Ã  quelquâ€™un qui ne pouvait pas sortir.",
    "Quelquâ€™un a aidÃ© quelquâ€™un Ã  sâ€™organiser.",
    "Quelquâ€™un a rÃ©parÃ© quelque chose pour quelquâ€™un.",
    "Quelquâ€™un a traduit un document pour quelquâ€™un.",
    "Quelquâ€™un a passÃ© un appel important pour quelquâ€™un.",
    "Quelquâ€™un a enseignÃ© quelque chose de difficile Ã  quelquâ€™un.",
    "Quelquâ€™un a cuisinÃ© pour quelquâ€™un.",
    "Quelquâ€™un a accompagnÃ© quelquâ€™un Ã  un rendez-vous.",
    "Quelquâ€™un a donnÃ© un trajet Ã  quelquâ€™un."
  ],
  de: [
    "Jemand hat jemandem zugehÃ¶rt.",
    "Jemand hat jemandem Gesellschaft geleistet.",
    "Jemand hat jemandem etwas gebracht, der nicht raus konnte.",
    "Jemand hat jemandem beim Ordnen geholfen.",
    "Jemand hat etwas fÃ¼r jemanden repariert.",
    "Jemand hat ein Dokument fÃ¼r jemanden Ã¼bersetzt.",
    "Jemand hat fÃ¼r jemanden einen wichtigen Anruf erledigt.",
    "Jemand hat jemandem etwas Schwieriges erklÃ¤rt.",
    "Jemand hat fÃ¼r jemanden gekocht.",
    "Jemand hat jemanden zu einem Termin begleitet.",
    "Jemand hat jemanden gefahren."
  ],
  "zh-hant": [
    "æœ‰äººå‚¾è½äº†æŸäººã€‚",
    "æœ‰äººé™ªä¼´äº†æŸäººã€‚",
    "æœ‰äººæŠŠæ±è¥¿é€çµ¦ç„¡æ³•å¤–å‡ºçš„æŸäººã€‚",
    "æœ‰äººå¹«æŸäººæ•´ç†äº‹æƒ…ã€‚",
    "æœ‰äººæ›¿æŸäººä¿®å¥½äº†æ±è¥¿ã€‚",
    "æœ‰äººæ›¿æŸäººç¿»è­¯äº†ä¸€ä»½æ–‡ä»¶ã€‚",
    "æœ‰äººæ›¿æŸäººæ‰“äº†ä¸€é€šé‡è¦é›»è©±ã€‚",
    "æœ‰äººæ•™æœƒæŸäººä¸€ä»¶å›°é›£çš„äº‹ã€‚",
    "æœ‰äººæ›¿æŸäººç…®äº†ä¸€é¤ã€‚",
    "æœ‰äººé™ªæŸäººåŽ»èµ´ç´„ã€‚",
    "æœ‰äººè¼‰äº†æŸäººä¸€ç¨‹ã€‚"
  ]
};

/* ---------- Storage (registro unico) ---------- */
const STORAGE_KEY = "MANGO_REGISTRO_UNICO_V2";
const OLD_KEYS = [
  "mango_righe_v1","MANGO_RIGHE_V1","mangoRighe","righeMango","MANGO_RIGHE","registroMango","MANGO_REGISTRO","MANGO_RIGHE_HOME","MANGO_RIGHE_PRIMO"
];

function safeParse(raw){
  try{ return JSON.parse(raw); }catch{ return null; }
}
function normalizeText(t){
  return (t||"").replace(/\s+/g," ").trim();
}
function asRow(x){
  if(typeof x === "string"){
    const text = normalizeText(x);
    return text ? { text, ts: Date.now() } : null;
  }
  if(x && typeof x === "object"){
    const text = normalizeText(x.text || "");
    if(!text) return null;
    const ts = typeof x.ts === "number" ? x.ts : Date.now();
    return { text, ts };
  }
  return null;
}
function dedup(arr){
  const seen = new Set();
  const out = [];
  for(const r of arr){
    const k = (r.text||"").toLowerCase();
    if(!k || seen.has(k)) continue;
    seen.add(k);
    out.push(r);
  }
  return out;
}
function readKey(key){
  const raw = localStorage.getItem(key);
  if(!raw) return [];
  const parsed = safeParse(raw);
  if(!parsed || !Array.isArray(parsed)) return [];
  return parsed.map(asRow).filter(Boolean);
}
function writeKey(key, arr){
  localStorage.setItem(key, JSON.stringify(arr));
}
function migrateOnce(){
  // se giÃ  migrato, basta
  if(localStorage.getItem(STORAGE_KEY)) return;

  let merged = [];
  for(const k of OLD_KEYS){
    merged = merged.concat(readKey(k));
  }
  merged = dedup(merged).sort((a,b)=>a.ts-b.ts);
  writeKey(STORAGE_KEY, merged);

  // non cancelliamo i vecchi key (sicurezza), ma non li useremo piÃ¹
}
function readArchive(){
  migrateOnce();
  return readKey(STORAGE_KEY);
}
function writeArchive(arr){
  writeKey(STORAGE_KEY, arr);
}

/* ---------- Lang ---------- */
const SUPPORTED = ["it","en","es","fr","de","zh-hant"];
function getLang(){
  const u = new URL(location.href);
  const q = (u.searchParams.get("lang") || "").toLowerCase();
  if(SUPPORTED.includes(q)) return q;
  return "it";
}
function setLang(lang){
  const u = new URL(location.href);
  u.searchParams.set("lang", lang);
  history.replaceState({}, "", u.toString());
  applyLang(lang);
  renderMuro(lang);
  updateCount(lang);
}

/* ---------- UI apply language ---------- */
function applyLang(lang){
  const s = STR[lang] || STR.it;
  document.documentElement.lang = lang === "zh-hant" ? "zh-Hant" : lang;

  document.getElementById("titleTxt").textContent = s.title;
  document.getElementById("subTxt").textContent = s.sub;

  document.getElementById("sec1Title").textContent = s.sec1Title;
  document.getElementById("sec1Text").textContent = s.sec1Text;
  document.getElementById("btnQR").textContent = s.btnQR;
  document.getElementById("btnDoc").textContent = s.btnDoc;
  document.getElementById("btnFAQ").textContent = s.btnFAQ;

  document.getElementById("sec2Title").textContent = s.sec2Title;
  document.getElementById("sec2Note").textContent = s.sec2Note;
  const ta = document.getElementById("riga");
  if(ta) ta.placeholder = s.rigaPh;

  document.getElementById("btnInvia").textContent = s.btnInvia;
  document.getElementById("btnPulisci").textContent = s.btnPulisci;
  document.getElementById("btnApriArchivio").textContent = s.btnApri;
  document.getElementById("btnSvuotaArchivio").textContent = s.btnSvuota;

  document.getElementById("rulesTxt").textContent = s.rules;
  document.getElementById("qrNoteTxt").textContent = s.qrNote;

  document.getElementById("sec3Title").textContent = s.sec3Title;
  document.getElementById("sec3Text").textContent = s.sec3Text;
  document.getElementById("btnPDF").textContent = s.btnPDF;
  document.getElementById("btnFAQ2").textContent = s.btnFAQ;

  document.getElementById("muroTitle").textContent = s.muroTitle;
  document.getElementById("muroDesc").textContent = s.muroDesc;

  // chips
  document.querySelectorAll(".chip").forEach(ch=>{
    ch.classList.toggle("active", ch.dataset.lang === lang);
  });

  // sync invia state
  syncInvia();
}

/* ---------- Toast ---------- */
let toastTimer = null;
function showToast(type, lang, textOverride){
  const t = document.getElementById("toast");
  if(!t) return;
  const s = STR[lang] || STR.it;

  t.classList.remove("good","warn","show");
  t.classList.add(type === "warn" ? "warn" : "good");
  t.textContent = textOverride || (type === "warn" ? s.warnNumbers : s.savedOk);
  t.classList.add("show");

  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>{ t.classList.remove("show"); }, 2200);
}

/* ---------- Invia button enabling ---------- */
function syncInvia(){
  const ta = document.getElementById("riga");
  const btn = document.getElementById("btnInvia");
  if(!ta || !btn) return;
  btn.disabled = normalizeText(ta.value).length === 0;
}

/* ---------- Save line (with number block) ---------- */
function saveLine(lang){
  const ta = document.getElementById("riga");
  if(!ta) return;
  const s = STR[lang] || STR.it;

  const text = normalizeText(ta.value);
  if(!text){
    showToast("warn", lang, s.savedEmpty);
    return;
  }

  // BLOCCO NUMERI: qualsiasi cifra 0-9
  if (/[0-9]/.test(text)){
    showToast("warn", lang, s.warnNumbers);
    return; // non salva
  }

  const arr = readArchive();
  const merged = dedup(arr.concat([{ text, ts: Date.now() }])).sort((a,b)=>a.ts-b.ts);
  writeArchive(merged);

  ta.value = "";
  syncInvia();
  updateCount(lang);

  showToast("ok", lang, s.savedOk);
}

/* ---------- Archive UI ---------- */
function updateCount(lang){
  const s = STR[lang] || STR.it;
  const n = readArchive().length;
  document.getElementById("countTxt").textContent = s.count + n;
}
function openArchive(lang){
  const s = STR[lang] || STR.it;
  const arr = readArchive();
  if(!arr.length){
    showToast("warn", lang, s.archiveEmpty);
    return;
  }
  const lines = arr.slice(-30).map((x,i)=>`${i+1}. ${x.text}`).join("\n\n");
  alert(s.openTitle + "\n\n" + lines);
}
function wipeArchive(lang){
  const s = STR[lang] || STR.it;
  if(!confirm(s.confirmWipe)) return;
  writeArchive([]);
  updateCount(lang);
  showToast("ok", lang, s.wiped);
}

/* ---------- Muro Mango render: 7 righe per lingua ---------- */
function pick7(arr){
  // shuffle copy
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a.slice(0,7);
}
function renderMuro(lang){
  const wrap = document.getElementById("muroWrap");
  if(!wrap) return;

  wrap.innerHTML = ""; // rebuild always

  // mostriamo SEMPRE tutte le lingue (come prima), ma l'utente sceglie con chip sopra.
  const order = ["it","en","es","fr","de","zh-hant"];
  for(const L of order){
    const box = document.createElement("div");
    box.className = "muro-box";
    box.innerHTML = `<div class="tag">${L === "zh-hant" ? "ä¸­æ–‡" : L.toUpperCase()}</div><div class="mango">ðŸ¥­</div>`;
    wrap.appendChild(box);

    const ul = document.createElement("ul");
    ul.className = "muro-list";
    const source = MURO_LINES[L] || [];
    const chosen = pick7(source.length ? source : ["â€¦"]);
    for(const line of chosen){
      const li = document.createElement("li");
      li.textContent = line;
      ul.appendChild(li);
    }
    wrap.appendChild(ul);
  }
}

/* ---------- Init ---------- */
(function init(){
  const lang = getLang();
  applyLang(lang);
  renderMuro(lang);
  updateCount(lang);

  // chips
  document.querySelectorAll(".chip").forEach(ch=>{
    ch.addEventListener("click", ()=> setLang(ch.dataset.lang));
  });

  // invia enable on input
  const ta = document.getElementById("riga");
  if(ta){
    ta.addEventListener("input", syncInvia);

    // invio da tastiera: Enter invia, Shift+Enter va a capo
    ta.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        saveLine(getLang());
      }
    });
  }

  // buttons
  document.getElementById("btnInvia")?.addEventListener("click", ()=>{
    saveLine(getLang());
  });
  document.getElementById("btnPulisci")?.addEventListener("click", ()=>{
    const l = getLang(); const s = STR[l] || STR.it;
    const ta = document.getElementById("riga");
    if(ta) ta.value = "";
    syncInvia();
    showToast("ok", l, s.cleared);
  });
  document.getElementById("btnApriArchivio")?.addEventListener("click", ()=>{
    openArchive(getLang());
  });
  document.getElementById("btnSvuotaArchivio")?.addEventListener("click", ()=>{
    wipeArchive(getLang());
  });

  // ensure initial state
  syncInvia();
})();
</script>
</body>
</html>
