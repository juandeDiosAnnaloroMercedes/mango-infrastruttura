<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mango</title>
  <link rel="stylesheet" href="./style.css" />
  <script defer src="./lang-nav.js"></script>
  <script defer src="./lang.js"></script>
</head>

<body>

  <!-- NAV LINGUE (usa ?lang=it|en|es|fr|de|zh) -->
  <nav class="lang-nav" aria-label="Lingua">
    <a href="./index.html?lang=it" data-lang="it">IT</a>
    <a href="./index.html?lang=en" data-lang="en">EN</a>
    <a href="./index.html?lang=es" data-lang="es">ES</a>
    <a href="./index.html?lang=fr" data-lang="fr">FR</a>
    <a href="./index.html?lang=de" data-lang="de">DE</a>
    <a href="./index.html?lang=zh" data-lang="zh">中文</a>
  </nav>

  <main class="wrap">
    <h1>Mango</h1>

    <p data-i18n="intro_1">Mango riconosce uno scambio reale tra persone.</p>
    <p data-i18n="intro_2"><strong>Non è una moneta.</strong> Non misura valore. Non accumula.</p>

    <hr>

    <section id="come">
      <h2 data-i18n="how_title">Come si fa Mango</h2>
      <ol>
        <li data-i18n="how_1">Avviene uno scambio reale tra persone.</li>
        <li data-i18n="how_2">Si scrive una riga che riconosce che lo scambio è avvenuto.</li>
        <li data-i18n="how_3">La riga non indica quantità, non crea credito o debito, non si accumula.</li>
      </ol>
      <p data-i18n="how_4"><strong>Una riga è un Mango.</strong></p>

      <!-- QR -->
      <div class="qr-container" aria-label="QR Mango">
        <a class="qr-link" href="./primo-scambio.html">
          <img
            class="qr-img"
            src="./mango-home-qr.jpg?v=1"
            alt="QR Mango"
            width="320"
            height="320"
            loading="eager"
            decoding="async"
          />
        </a>

        <p class="qr-text" data-i18n="qr_text">
          <strong>È successo qualcosa tra due persone.</strong><br>
          Qui puoi capirlo.
        </p>
      </div>
    </section>

    <hr>

    <!-- REGISTRO (come prima: download + upload + copia + cancella) -->
    <section id="registro">
      <h2 data-i18n="reg_title">Scrivi una riga</h2>

      <p data-i18n="reg_help">
        Scrivi una riga che riconosce uno scambio reale.<br>
        Nessuna quantità. Nessun numero. Nessuna equivalenza.
      </p>

      <label class="field">
        <span class="label" data-i18n="reg_label">Riga</span>
        <textarea id="lineInput" rows="3" placeholder='Esempio: "Io ho aiutato X con ... / X ha aiutato me con ..."' ></textarea>
      </label>

      <div class="actions">
        <button id="downloadBtn" type="button" data-i18n="btn_download">Scarica riga (.txt)</button>
        <button id="copyBtn" type="button" data-i18n="btn_copy">Copia</button>
        <button id="clearBtn" type="button" data-i18n="btn_clear">Cancella</button>

        <label class="file">
          <span data-i18n="btn_upload">Carica un file (opzionale)</span>
          <input id="fileInput" type="file" accept=".txt" />
        </label>
      </div>

      <p class="note" data-i18n="reg_note">
        Mango non salva online. Il registro è tuo: puoi scaricare un file e tenerlo dove vuoi.
      </p>

      <!-- Link rapido alla pagina dedicata (se esiste) -->
      <p class="mini-links">
        <a href="./scrivi-una-riga.html" data-i18n="reg_open_page">Apri la pagina “Scrivi una riga”</a>
      </p>
    </section>

    <hr>

    <section id="cos">
      <h2 data-i18n="what_title">Cos’è Mango</h2>
      <p data-i18n="what_1">
        Mango è un’infrastruttura di fiducia locale: riconosce scambi reali senza denaro, senza numeri, senza accumulo.
      </p>
      <p class="mini-links">
        <a href="./statuto-permanente.html" data-i18n="what_statute">Statuto permanente</a>
        <span> · </span>
        <a href="./licenza.html" data-i18n="what_license">Licenza</a>
        <span> · </span>
        <a href="./non-appropriazione.html" data-i18n="what_nonapp">Non-appropriazione</a>
      </p>
    </section>

  </main>

  <script>
    // REGISTRO — locale (nessun server)
    const lineInput = document.getElementById("lineInput");
    const downloadBtn = document.getElementById("downloadBtn");
    const copyBtn = document.getElementById("copyBtn");
    const clearBtn = document.getElementById("clearBtn");
    const fileInput = document.getElementById("fileInput");

    downloadBtn.addEventListener("click", () => {
      const txt = (lineInput.value || "").trim();
      if (!txt) return;
      const blob = new Blob([txt + "\n"], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "mango-riga.txt";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    copyBtn.addEventListener("click", async () => {
      const txt = (lineInput.value || "").trim();
      if (!txt) return;
      try {
        await navigator.clipboard.writeText(txt);
      } catch (e) {
        // fallback iOS
        lineInput.focus();
        lineInput.select();
        document.execCommand("copy");
        lineInput.setSelectionRange(0, 0);
      }
    });

    clearBtn.addEventListener("click", () => {
      lineInput.value = "";
      lineInput.focus();
    });

    fileInput.addEventListener("change", async (ev) => {
      const file = ev.target.files && ev.target.files[0];
      if (!file) return;
      try {
        const text = await file.text();
        lineInput.value = (text || "").trim();
        lineInput.focus();
      } catch (e) {
        // ignora
      }
      fileInput.value = "";
    });
  </script>

</body>
</html>
