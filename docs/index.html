<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f17" />
  <title>Mango ‚Äî Infrastruttura di fiducia locale</title>

  <!-- Usa il tuo stile esistente -->
  <link rel="stylesheet" href="style.css" />

  <!-- Fallback minimale per garantire pagina nera ‚Äúbella‚Äù anche se style.css cambia -->
  <style>
    :root{
      --bg:#0b0f17;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.04);
      --line:rgba(255,255,255,.08);
      --txt:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --muted2:rgba(255,255,255,.48);
      --good:#25d366;
      --warn:#ff3b30;
      --shadow: 0 12px 40px rgba(0,0,0,.35);
      --r:22px;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,system-ui,sans-serif;
      background:radial-gradient(1100px 600px at 30% 0%, rgba(255,255,255,.08), transparent 55%),
                 radial-gradient(900px 700px at 90% 10%, rgba(255,200,50,.10), transparent 55%),
                 var(--bg);
      color:var(--txt);
    }
    a{color:inherit}
    .wrap{max-width:860px;margin:0 auto;padding:18px 16px 60px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.045));
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:18px;
      margin:14px 0;
    }
    .top{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
    }
    .brand{display:flex; gap:14px; align-items:center; min-width:260px}
    .logo{
      width:58px;height:58px;border-radius:18px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:center;
      box-shadow:inset 0 0 0 1px rgba(0,0,0,.25);
      text-decoration:none;
    }
    .logo img{width:34px;height:34px;display:block}
    .title{line-height:1.1}
    .title .h{font-size:30px;font-weight:800;letter-spacing:.2px}
    .title .s{font-size:18px;color:var(--muted);margin-top:4px}
    .langs{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}
    .chip{
      padding:10px 14px;border-radius:999px;
      border:1px solid rgba(120,160,255,.25);
      background:rgba(0,0,0,.18);
      color:rgba(255,255,255,.88);
      font-weight:700;
      text-decoration:none;
      -webkit-tap-highlight-color: transparent;
    }
    .chip.active{
      border-color:rgba(120,160,255,.55);
      background:rgba(120,160,255,.18);
      box-shadow:inset 0 0 0 1px rgba(120,160,255,.18);
    }

    h1{font-size:52px;letter-spacing:-.8px;margin:10px 0 6px}
    .lead{font-size:20px;color:var(--muted);line-height:1.45;margin:0 0 14px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;
      padding:14px 18px;border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22);
      text-decoration:none;
      font-weight:800;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }
    .btn:active{transform:translateY(1px)}
    .btnPrimary{
      background:rgba(120,160,255,.22);
      border-color:rgba(120,160,255,.35);
    }
    .btnDanger{
      background:rgba(255,59,48,.14);
      border-color:rgba(255,59,48,.28);
    }
    .btnWide{min-width:150px}
    .sep{height:1px;background:rgba(255,255,255,.08);margin:16px 0}

    textarea{
      width:100%;
      min-height:98px;
      border-radius:20px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      color:rgba(255,255,255,.92);
      padding:18px 16px;
      font-size:20px;
      outline:none;
      resize:vertical;
      box-shadow:inset 0 0 0 1px rgba(0,0,0,.18);
    }
    textarea::placeholder{color:rgba(255,255,255,.40)}

    .meta{color:var(--muted);font-size:16px;line-height:1.5}
    .meta a{color:rgba(200,220,255,.95)}
    .pill{
      display:inline-flex;align-items:center;gap:10px;
      padding:10px 14px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.18);
      color:rgba(255,255,255,.86);
      font-weight:800;
      -webkit-tap-highlight-color: transparent;
    }

    /* Toast */
    #toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:18px;
      z-index:9999;
      max-width:min(680px, calc(100% - 26px));
      padding:14px 16px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.55);
      color:rgba(255,255,255,.92);
      backdrop-filter: blur(12px);
      display:none;
      box-shadow:var(--shadow);
    }
    #toast.show{display:block}
    #toast.good{border-color:rgba(37,211,102,.35)}
    #toast.warn{border-color:rgba(255,59,48,.38)}

    /* QR link sempre cliccabile */
    #btnQR{pointer-events:auto !important;}

    /* Muro */
    .muroBox{
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.035));
      border:1px solid rgba(255,255,255,.10);
      border-radius:20px;
      padding:14px;
    }
    .muroHead{
      display:flex;align-items:center;justify-content:space-between;
      padding:10px 12px;border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.16);
      margin-bottom:12px;
      font-weight:900;
      letter-spacing:.6px;
    }
    .muroList{margin:0;padding-left:20px;color:rgba(255,255,255,.86);font-size:18px;line-height:1.6}
    .foot{margin-top:24px;color:rgba(255,255,255,.45);text-align:center}
  </style>
</head>

<body>
  <div class="wrap">

    <!-- HEADER -->
    <div class="card">
      <div class="top">
        <div class="brand">
          <a class="logo" href="bianco.html" aria-label="Vai a Bianco">
            <img src="assets/mango.png" alt="Mango" onerror="this.style.display='none'; this.parentElement.textContent='ü•≠'; this.parentElement.style.fontSize='26px';" />
          </a>
          <div class="title">
            <div class="h">Mango</div>
            <div class="s" id="subTitle">Infrastruttura di fiducia locale</div>
          </div>
        </div>

        <div class="langs" aria-label="Lingua">
          <a class="chip" data-lang="it" href="./?lang=it">IT</a>
          <a class="chip" data-lang="en" href="./?lang=en">EN</a>
          <a class="chip" data-lang="es" href="./?lang=es">ES</a>
          <a class="chip" data-lang="fr" href="./?lang=fr">FR</a>
          <a class="chip" data-lang="de" href="./?lang=de">DE</a>
          <a class="chip" data-lang="zh" href="./?lang=zh">‰∏≠Êñá</a>
        </div>
      </div>
    </div>

    <!-- FAI MANGO ADESSO -->
    <div class="card" id="secDoNow">
      <h1 id="hDoNow">Fai Mango adesso</h1>
      <p class="lead" id="pDoNow">Scrivi una sola riga reale. Niente cifre. Niente misure. Niente equivalenze.</p>

      <div class="row">
        <!-- QR: LINK VERO (sempre funziona) -->
        <a id="btnQR" class="btn btnWide" href="stampa-qr.html" role="button">QR</a>
        <a id="btnFAQ" class="btn btnWide" href="faq.html" role="button">FAQ</a>
        <!-- facoltativo: torna alla home (sei gi√† in home, ma lo volevi in alcune pagine) -->
      </div>

      <div class="sep"></div>

      <textarea id="riga" placeholder="Scrivi qui una riga (Shift+Invio va a capo)"></textarea>

      <div class="row" style="margin-top:12px">
        <button id="btnInvia" class="btn btnPrimary btnWide" type="button" disabled>Invia riga</button>
        <button id="btnPulisci" class="btn btnWide" type="button">Pulisci</button>
        <button id="btnApri" class="btn btnWide" type="button">Apri archivio</button>
      </div>

      <div class="row" style="margin-top:10px">
        <button id="btnSvuota" class="btn btnDanger btnWide" type="button">Svuota archivio</button>
        <div class="pill" id="countPill">Righe in archivio: 0</div>
      </div>

      <p class="meta" style="margin-top:12px" id="pNote">
        Nota: l‚Äôarchivio √® locale sul tuo dispositivo (non √® pubblico).
      </p>

      <p class="meta" style="margin-top:10px">
        Email: <a href="mailto:info@mangoinfrastruttura.org">info@mangoinfrastruttura.org</a>
      </p>

      <p class="meta" style="margin-top:8px">
        <a href="QR_MANGO_UFFICIALE.pdf">PDF QR</a> &nbsp; <a href="kit-mango.pdf">Kit (PDF)</a> &nbsp; <a href="versione-permanente.pdf">Versione permanente (PDF)</a> &nbsp; <a href="MANGO_Origine_Reale_e_Storia_Vissuta.pdf">Origine reale (PDF)</a>
      </p>

      <p class="meta" style="margin-top:6px">
        <a href="neutralita.html">Neutralit√†</a> &nbsp; <a href="non-appropriazione.html">Non appropriazione</a> &nbsp; <a href="statuto-permanente.html">Statuto permanente</a> &nbsp; <a href="primo-scambio.html">Primo scambio</a>
      </p>
    </div>

    <!-- COS'√à MANGO (senza documento fondativo) -->
    <div class="card" id="secWhat">
      <h2 style="margin:0 0 8px;font-size:42px;letter-spacing:-.6px" id="hWhat">Cos‚Äô√® Mango</h2>
      <p class="lead" id="pWhat">
        Mango √® un‚Äôinfrastruttura di fiducia locale non monetaria, non appropriabile, progettata per evitare accumulo, speculazione e cattura istituzionale.
        Creato da Juan de Dios Annaloro Mercedes in memoria di Larimar.
      </p>
      <div class="row">
        <a class="btn btnWide" href="licenza.html" id="btnLicenza">Licenza</a>
        <a class="btn btnWide" href="stampa-qr.html" id="btnStampa">Stampa QR</a>
      </div>
    </div>

    <!-- MURO MANGO (solo lingua attiva: 7 righe) -->
    <div class="card" id="secMuro">
      <h2 style="margin:0 0 8px;font-size:42px;letter-spacing:-.6px" id="hMuro">Muro Mango</h2>
      <p class="lead" id="pMuro">
        Sette righe anonime per lingua, scelte a caso a ogni visita. Senza identit√†, senza date, senza archivio consultabile.
      </p>

      <div class="muroBox">
        <div class="muroHead">
          <span id="muroLangLabel">IT</span>
          <span>ü•≠</span>
        </div>
        <ul class="muroList" id="muroList"></ul>
      </div>
    </div>

    <div class="foot" id="footBirth">Mango ‚Äî nato il 02 febbraio 2026</div>
  </div>

  <!-- Toast -->
  <div id="toast"></div>

  <script>
    // ---------------------------
    // Lingue
    // ---------------------------
    const STR = {
      it:{
        sub:"Infrastruttura di fiducia locale",
        doNowH:"Fai Mango adesso",
        doNowP:"Scrivi una sola riga reale. Niente cifre. Niente misure. Niente equivalenze.",
        ph:"Scrivi qui una riga (Shift+Invio va a capo)",
        invia:"Invia riga",
        pulisci:"Pulisci",
        apri:"Apri archivio",
        svuota:"Svuota archivio",
        count:(n)=>`Righe in archivio: ${n}`,
        note:"Nota: l‚Äôarchivio √® locale sul tuo dispositivo (non √® pubblico).",
        ok:"Riga riconosciuta.",
        warn:"Rispetta te stesso e gli altri: Mango non si conta.",
        empty:"Scrivi una riga reale prima di inviare.",
        confirmWipe:"Vuoi davvero svuotare l‚Äôarchivio locale?",
        wiped:"Archivio svuotato.",
        whatH:"Cos‚Äô√® Mango",
        whatP:"Mango √® un‚Äôinfrastruttura di fiducia locale non monetaria, non appropriabile, progettata per evitare accumulo, speculazione e cattura istituzionale. Creato da Juan de Dios Annaloro Mercedes in memoria di Larimar.",
        muroH:"Muro Mango",
        muroP:"Sette righe anonime per lingua, scelte a caso a ogni visita. Senza identit√†, senza date, senza archivio consultabile.",
        lic:"Licenza",
        stampa:"Stampa QR",
        born:"Mango ‚Äî nato il 02 febbraio 2026"
      },
      en:{
        sub:"Local trust infrastructure",
        doNowH:"Do Mango now",
        doNowP:"Write one real line. No numbers. No measures. No equivalences.",
        ph:"Write one line here (Shift+Enter for a new line)",
        invia:"Send line",
        pulisci:"Clear",
        apri:"Open archive",
        svuota:"Wipe archive",
        count:(n)=>`Lines in archive: ${n}`,
        note:"Note: the archive is local on your device (not public).",
        ok:"Line recognized.",
        warn:"Respect yourself and others: Mango is not counted.",
        empty:"Write a real line before sending.",
        confirmWipe:"Do you really want to wipe the local archive?",
        wiped:"Archive wiped.",
        whatH:"What is Mango",
        whatP:"Mango is a non-monetary, non-appropriable local trust infrastructure designed to prevent accumulation, speculation, and institutional capture. Created by Juan de Dios Annaloro Mercedes in memory of Larimar.",
        muroH:"Mango Wall",
        muroP:"Seven anonymous lines per language, chosen randomly on each visit. No identities, no dates, no browsable archive.",
        lic:"License",
        stampa:"Print QR",
        born:"Mango ‚Äî born on 02 February 2026"
      },
      es:{
        sub:"Infraestructura de confianza local",
        doNowH:"Haz Mango ahora",
        doNowP:"Escribe una sola l√≠nea real. Sin cifras. Sin medidas. Sin equivalencias.",
        ph:"Escribe aqu√≠ una l√≠nea (Shift+Enter para saltar de l√≠nea)",
        invia:"Enviar l√≠nea",
        pulisci:"Limpiar",
        apri:"Abrir archivo",
        svuota:"Vaciar archivo",
        count:(n)=>`L√≠neas en archivo: ${n}`,
        note:"Nota: el archivo es local en tu dispositivo (no es p√∫blico).",
        ok:"L√≠nea reconocida.",
        warn:"Resp√©tate a ti y a los dem√°s: Mango no se cuenta.",
        empty:"Escribe una l√≠nea real antes de enviar.",
        confirmWipe:"¬øSeguro que quieres vaciar el archivo local?",
        wiped:"Archivo vaciado.",
        whatH:"Qu√© es Mango",
        whatP:"Mango es una infraestructura local de confianza no monetaria, no apropiable, dise√±ada para evitar acumulaci√≥n, especulaci√≥n y captura institucional. Creado por Juan de Dios Annaloro Mercedes en memoria de Larimar.",
        muroH:"Muro Mango",
        muroP:"Siete l√≠neas an√≥nimas por idioma, elegidas al azar en cada visita. Sin identidades, sin fechas, sin archivo consultable.",
        lic:"Licencia",
        stampa:"Imprimir QR",
        born:"Mango ‚Äî nacido el 02 de febrero de 2026"
      },
      fr:{
        sub:"Infrastructure de confiance locale",
        doNowH:"Fais Mango maintenant",
        doNowP:"√âcris une seule ligne r√©elle. Pas de chiffres. Pas de mesures. Pas d‚Äô√©quivalences.",
        ph:"√âcris ici une ligne (Shift+Entr√©e pour aller √† la ligne)",
        invia:"Envoyer la ligne",
        pulisci:"Effacer",
        apri:"Ouvrir l‚Äôarchive",
        svuota:"Vider l‚Äôarchive",
        count:(n)=>`Lignes en archive : ${n}`,
        note:"Note : l‚Äôarchive est locale sur ton appareil (non publique).",
        ok:"Ligne reconnue.",
        warn:"Respecte-toi et respecte les autres : Mango ne se compte pas.",
        empty:"√âcris une ligne r√©elle avant d‚Äôenvoyer.",
        confirmWipe:"Veux-tu vraiment vider l‚Äôarchive locale ?",
        wiped:"Archive vid√©e.",
        whatH:"Qu‚Äôest-ce que Mango",
        whatP:"Mango est une infrastructure de confiance locale non mon√©taire, non appropriable, con√ßue pour √©viter l‚Äôaccumulation, la sp√©culation et la capture institutionnelle. Cr√©√© par Juan de Dios Annaloro Mercedes en m√©moire de Larimar.",
        muroH:"Mur Mango",
        muroP:"Sept lignes anonymes par langue, choisies au hasard √† chaque visite. Sans identit√©s, sans dates, sans archive consultable.",
        lic:"Licence",
        stampa:"Imprimer QR",
        born:"Mango ‚Äî n√© le 02 f√©vrier 2026"
      },
      de:{
        sub:"Lokale Vertrauens-Infrastruktur",
        doNowH:"Mach Mango jetzt",
        doNowP:"Schreibe eine echte Zeile. Keine Zahlen. Keine Ma√üe. Keine √Ñquivalenzen.",
        ph:"Schreibe hier eine Zeile (Shift+Enter f√ºr Zeilenumbruch)",
        invia:"Zeile senden",
        pulisci:"Leeren",
        apri:"Archiv √∂ffnen",
        svuota:"Archiv l√∂schen",
        count:(n)=>`Zeilen im Archiv: ${n}`,
        note:"Hinweis: Das Archiv ist lokal auf deinem Ger√§t (nicht √∂ffentlich).",
        ok:"Zeile erkannt.",
        warn:"Respektiere dich und andere: Mango wird nicht gez√§hlt.",
        empty:"Schreibe eine echte Zeile, bevor du sendest.",
        confirmWipe:"Willst du das lokale Archiv wirklich l√∂schen?",
        wiped:"Archiv gel√∂scht.",
        whatH:"Was ist Mango",
        whatP:"Mango ist eine nicht-monet√§re, nicht-aneignbare lokale Vertrauens-Infrastruktur, die Akkumulation, Spekulation und institutionelle Vereinnahmung verhindert. Erschaffen von Juan de Dios Annaloro Mercedes im Gedenken an Larimar.",
        muroH:"Mango-Mauer",
        muroP:"Sieben anonyme Zeilen pro Sprache, bei jedem Besuch zuf√§llig ausgew√§hlt. Keine Identit√§ten, keine Daten, kein durchsuchbares Archiv.",
        lic:"Lizenz",
        stampa:"QR drucken",
        born:"Mango ‚Äî geboren am 02. Februar 2026"
      },
      zh:{
        sub:"Êú¨Âú∞‰ø°‰ªªÂü∫Á°ÄËÆæÊñΩ",
        doNowH:"Áé∞Âú®Â∞±ÂÅö Mango",
        doNowP:"ÂÜô‰∏ÄÊù°ÁúüÂÆûÁöÑ‰∏ÄË°å„ÄÇ‰∏çË¶ÅÊï∞Â≠ó„ÄÇ‰∏çË¶ÅÂ∫¶Èáè„ÄÇ‰∏çË¶ÅÁ≠â‰ª∑Êç¢ÁÆó„ÄÇ",
        ph:"Âú®ËøôÈáåÂÜô‰∏ÄË°åÔºàShift+Enter Êç¢Ë°åÔºâ",
        invia:"Êèê‰∫§",
        pulisci:"Ê∏ÖÁ©∫ËæìÂÖ•",
        apri:"ÊâìÂºÄÂ≠òÊ°£",
        svuota:"Ê∏ÖÁ©∫Â≠òÊ°£",
        count:(n)=>`Â≠òÊ°£Ë°åÊï∞Ôºö${n}`,
        note:"ËØ¥ÊòéÔºöÂ≠òÊ°£Âè™‰øùÂ≠òÂú®‰Ω†ÁöÑËÆæÂ§á‰∏äÔºà‰∏çÂÖ¨ÂºÄÔºâ„ÄÇ",
        ok:"Â∑≤ËØÜÂà´‰∏∫‰∏ÄË°å„ÄÇ",
        warn:"Â∞äÈáçËá™Â∑±Âíå‰ªñ‰∫∫ÔºöMango ‰∏çËÉΩË¢´ËÆ°Êï∞„ÄÇ",
        empty:"Êèê‰∫§ÂâçËØ∑ÂÖàÂÜô‰∏ÄÊù°ÁúüÂÆûÁöÑ‰∏ÄË°å„ÄÇ",
        confirmWipe:"Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫Êú¨Âú∞Â≠òÊ°£ÂêóÔºü",
        wiped:"Â≠òÊ°£Â∑≤Ê∏ÖÁ©∫„ÄÇ",
        whatH:"‰ªÄ‰πàÊòØ Mango",
        whatP:"Mango ÊòØ‰∏ÄÁßçÈùûË¥ßÂ∏Å„ÄÅ‰∏çÂèØÂç†ÊúâÁöÑÊú¨Âú∞‰ø°‰ªªÂü∫Á°ÄËÆæÊñΩÔºåÁî®Êù•ÈÅøÂÖçÁßØÁ¥Ø„ÄÅÊäïÊú∫‰∏éÂà∂Â∫¶ÊÄßÊçïËé∑„ÄÇÁî± Juan de Dios Annaloro Mercedes ÂàõÂª∫Ôºå‰ª•Á∫™Âøµ Larimar„ÄÇ",
        muroH:"Mango Â¢ô",
        muroP:"ÊØèÁßçËØ≠Ë®ÄÂ±ïÁ§∫ 7 Êù°ÂåøÂêçÂè•Â≠êÔºåÊØèÊ¨°ËÆøÈóÆÈöèÊú∫Âá∫Áé∞„ÄÇ‰∏çÂê´Ë∫´‰ªΩ„ÄÅ‰∏çÂê´Êó•Êúü„ÄÅ‰∏çÂèØÊµèËßàÂ≠òÊ°£„ÄÇ",
        lic:"ËÆ∏ÂèØ",
        stampa:"ÊâìÂç∞‰∫åÁª¥Á†Å",
        born:"Mango ‚Äî ËØûÁîü‰∫é 2026Âπ¥2Êúà2Êó•"
      }
    };

    const MURO = {
      it:[
        "Qualcuno ha portato qualcosa a qualcuno che non poteva uscire.",
        "Qualcuno ha insegnato qualcosa di difficile a qualcuno.",
        "Qualcuno ha aiutato qualcuno a fare ordine.",
        "Qualcuno ha prestato ascolto a qualcuno.",
        "Qualcuno ha fatto compagnia a qualcuno.",
        "Qualcuno ha tradotto un documento per qualcuno.",
        "Qualcuno ha fatto una telefonata importante per qualcuno.",
        "Qualcuno ha accompagnato qualcuno a una visita.",
        "Qualcuno ha riparato qualcosa per qualcuno."
      ],
      en:[
        "Someone made an important phone call for someone.",
        "Someone cooked for someone.",
        "Someone translated a document for someone.",
        "Someone brought something to someone who couldn't go out.",
        "Someone taught something difficult to someone.",
        "Someone kept someone company.",
        "Someone accompanied someone to an appointment.",
        "Someone listened to someone.",
        "Someone helped someone get organized."
      ],
      es:[
        "Alguien acompa√±√≥ a alguien a una cita.",
        "Alguien cocin√≥ para alguien.",
        "Alguien tradujo un documento para alguien.",
        "Alguien escuch√≥ a alguien.",
        "Alguien acompa√±√≥ a alguien con su presencia.",
        "Alguien hizo una llamada importante por alguien.",
        "Alguien llev√≥ algo a alguien que no pod√≠a salir.",
        "Alguien ense√±√≥ algo dif√≠cil a alguien.",
        "Alguien ayud√≥ a alguien a ordenar."
      ],
      fr:[
        "Quelqu‚Äôun a enseign√© quelque chose de difficile √† quelqu‚Äôun.",
        "Quelqu‚Äôun a pass√© un appel important pour quelqu‚Äôun.",
        "Quelqu‚Äôun a tenu compagnie √† quelqu‚Äôun.",
        "Quelqu‚Äôun a donn√© un trajet √† quelqu‚Äôun.",
        "Quelqu‚Äôun a aid√© quelqu‚Äôun √† s‚Äôorganiser.",
        "Quelqu‚Äôun a cuisin√© pour quelqu‚Äôun.",
        "Quelqu‚Äôun a accompagn√© quelqu‚Äôun √† un rendez-vous.",
        "Quelqu‚Äôun a √©cout√© quelqu‚Äôun.",
        "Quelqu‚Äôun a traduit un document pour quelqu‚Äôun."
      ],
      de:[
        "Jemand hat jemanden gefahren.",
        "Jemand hat jemandem zugeh√∂rt.",
        "Jemand hat etwas f√ºr jemanden repariert.",
        "Jemand hat jemandem etwas gebracht, der nicht raus konnte.",
        "Jemand hat f√ºr jemanden gekocht.",
        "Jemand hat ein Dokument f√ºr jemanden √ºbersetzt.",
        "Jemand hat jemanden zu einem Termin begleitet.",
        "Jemand hat einen wichtigen Anruf f√ºr jemanden gemacht.",
        "Jemand hat jemandem geholfen, Ordnung zu schaffen."
      ],
      zh:[
        "Êúâ‰∫∫ÊõøÊüê‰∫∫Êâì‰∫Ü‰∏Ä‰∏™ÈáçË¶ÅÁîµËØù„ÄÇ",
        "Êúâ‰∫∫‰∏∫Êüê‰∫∫ÂÅö‰∫Ü‰∏ÄÈ°øÈ•≠„ÄÇ",
        "Êúâ‰∫∫ÊõøÊüê‰∫∫ÁøªËØë‰∫Ü‰∏Ä‰ªΩÊñá‰ª∂„ÄÇ",
        "Êúâ‰∫∫Êää‰∏úË•øÈÄÅÁªôÊó†Ê≥ïÂ§ñÂá∫ÁöÑÊüê‰∫∫„ÄÇ",
        "Êúâ‰∫∫Êïô‰ºöÊüê‰∫∫‰∏Ä‰ª∂Âõ∞ÈöæÁöÑ‰∫ã„ÄÇ",
        "Êúâ‰∫∫Èô™‰º¥‰∫ÜÊüê‰∫∫„ÄÇ",
        "Êúâ‰∫∫Èô™Êüê‰∫∫Âéª‰∫Ü‰∏ÄÊ¨°Á∫¶ËØä„ÄÇ",
        "Êúâ‰∫∫ÂÄæÂê¨‰∫ÜÊüê‰∫∫„ÄÇ",
        "Êúâ‰∫∫Â∏ÆÊüê‰∫∫Êï¥ÁêÜ‰∫Ü‰∏úË•ø„ÄÇ"
      ]
    };

    function getLang(){
      const u = new URL(location.href);
      const q = (u.searchParams.get("lang") || "").toLowerCase();
      if (STR[q]) return q;
      return "it";
    }

    function applyLang(lang){
      document.documentElement.lang = lang === "zh" ? "zh-Hant" : lang;
      const s = STR[lang];

      // attiva chip
      document.querySelectorAll(".chip").forEach(a=>{
        a.classList.toggle("active", a.dataset.lang === lang);
      });

      // testi UI
      document.getElementById("subTitle").textContent = s.sub;
      document.getElementById("hDoNow").textContent = s.doNowH;
      document.getElementById("pDoNow").textContent = s.doNowP;
      document.getElementById("riga").placeholder = s.ph;

      document.getElementById("btnInvia").textContent = s.invia;
      document.getElementById("btnPulisci").textContent = s.pulisci;
      document.getElementById("btnApri").textContent = s.apri;
      document.getElementById("btnSvuota").textContent = s.svuota;
      document.getElementById("pNote").textContent = s.note;

      document.getElementById("hWhat").textContent = s.whatH;
      document.getElementById("pWhat").textContent = s.whatP;
      document.getElementById("hMuro").textContent = s.muroH;
      document.getElementById("pMuro").textContent = s.muroP;

      document.getElementById("btnLicenza").textContent = s.lic;
      document.getElementById("btnStampa").textContent = s.stampa;

      document.getElementById("footBirth").textContent = s.born;

      // muro
      renderMuro(lang);

      // conteggio
      updateCount(lang);
    }

    function shuffle(arr){
      const a = arr.slice();
      for (let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    function renderMuro(lang){
      const label = (lang==="zh") ? "‰∏≠Êñá" : lang.toUpperCase();
      document.getElementById("muroLangLabel").textContent = label;

      const list = document.getElementById("muroList");
      list.innerHTML = "";

      const pool = MURO[lang] || MURO.it;
      const picks = shuffle(pool).slice(0,7);
      picks.forEach(t=>{
        const li = document.createElement("li");
        li.textContent = t;
        list.appendChild(li);
      });
    }

    // ---------------------------
    // Registro locale (unico)
    // ---------------------------
    const STORAGE_KEY = "MANGO_REGISTRO_UNICO_V2";

    function safeParse(raw){
      try { return JSON.parse(raw); } catch { return null; }
    }
    function normalizeText(t){
      if (!t) return "";
      return String(t).trim().replace(/\s+/g," ");
    }
    function readArchive(){
      const raw = localStorage.getItem(STORAGE_KEY);
      const parsed = safeParse(raw);
      if (!Array.isArray(parsed)) return [];
      // array di stringhe
      return parsed.map(x=>normalizeText(x)).filter(Boolean);
    }
    function writeArchive(arr){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
    }
    function dedup(arr){
      const seen = new Set();
      const out = [];
      for (const t of arr){
        const k = t.toLowerCase();
        if (seen.has(k)) continue;
        seen.add(k);
        out.push(t);
      }
      return out;
    }

    function showToast(type, lang, msg){
      const t = document.getElementById("toast");
      t.className = "";
      t.classList.add("show");
      t.classList.add(type === "warn" ? "warn" : "good");
      t.textContent = msg;
      clearTimeout(window.__toastT);
      window.__toastT = setTimeout(()=>t.classList.remove("show"), 2600);
    }

    // Blocca numeri + segni tipici da conteggio/misura
    function violatesNoCount(text){
      // cifre
      if (/[0-9]/.test(text)) return true;
      // simboli ‚Äúda calcolo / equivalenza / misura‚Äù
      if (/[=<>¬±√∑√ó%‚Ç¨$¬£¬•]/.test(text)) return true;
      // pattern ‚Äútipo codice‚Äù (molti simboli)
      if (/[{}[\]@#^*_~|\\]/.test(text)) return true;
      return false;
    }

    function updateCount(lang){
      const s = STR[lang];
      const n = readArchive().length;
      document.getElementById("countPill").textContent = s.count(n);
    }

    function syncInvia(){
      const ta = document.getElementById("riga");
      const btn = document.getElementById("btnInvia");
      if (!ta || !btn) return;
      btn.disabled = !normalizeText(ta.value);
    }

    function saveLine(lang){
      const s = STR[lang];
      const ta = document.getElementById("riga");
      if (!ta) return;

      const text = normalizeText(ta.value);
      if (!text){
        showToast("warn", lang, s.empty);
        return;
      }

      if (violatesNoCount(text)){
        showToast("warn", lang, s.warn);
        return;
      }

      const arr = readArchive();
      const merged = dedup([text, ...arr]).slice(0, 200); // limite locale ragionevole
      writeArchive(merged);

      ta.value = "";
      syncInvia();
      updateCount(lang);

      showToast("ok", lang, s.ok);
    }

    function openArchive(lang){
      const arr = readArchive();
      if (!arr.length){
        showToast("warn", lang, STR[lang].empty);
        return;
      }
      // mostra max 30
      const lines = arr.slice(0,30).map((t,i)=>`${i+1}. ${t}`).join("\n\n");
      alert(lines + (arr.length>30 ? `\n\n‚Ä¶ (+${arr.length-30})` : ""));
    }

    function wipeArchive(lang){
      const s = STR[lang];
      if (!confirm(s.confirmWipe)) return;
      writeArchive([]);
      updateCount(lang);
      showToast("ok", lang, s.wiped);
    }

    // ---------------------------
    // Init
    // ---------------------------
    (function init(){
      const lang = getLang();
      applyLang(lang);

      const ta = document.getElementById("riga");
      const btnInvia = document.getElementById("btnInvia");

      if (ta){
        ta.addEventListener("input", syncInvia);

        // Enter = invia, Shift+Enter = a capo
        ta.addEventListener("keydown", (e)=>{
          if (e.key === "Enter" && !e.shiftKey){
            e.preventDefault();
            saveLine(getLang());
          }
        });
      }

      if (btnInvia){
        btnInvia.addEventListener("click", ()=>saveLine(getLang()));
      }

      document.getElementById("btnPulisci")?.addEventListener("click", ()=>{
        const ta = document.getElementById("riga");
        if (ta) ta.value = "";
        syncInvia();
      });

      document.getElementById("btnApri")?.addEventListener("click", ()=>openArchive(getLang()));
      document.getElementById("btnSvuota")?.addEventListener("click", ()=>wipeArchive(getLang()));

      // sicurezza: QR deve restare cliccabile anche se qualcosa ‚Äúcopre‚Äù
      document.getElementById("btnQR")?.addEventListener("click", ()=>{
        // se per qualche motivo non naviga, forziamo
        // (ma normalmente l'href basta)
        // location.href = "stampa-qr.html";
      });

      // stato iniziale
      syncInvia();
    })();
  </script>
</body>
</html>
