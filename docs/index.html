<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mango</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!--
    MANGO — HOME DEFINITIVA (V1)
    - 6 lingue via ?lang=it|en|es|fr|de|zh (con normalizzazione zh)
    - Registro: una riga = un Mango (solo testo, nessun numero/valore)
    - Pulsanti: Salva / Copia / Esporta TXT / Importa TXT / Cancella
    - QR unico definitivo (link stabile home)
    - Footer: autore, memoria Larimar, data nascita 02 febbraio 2026
  -->

  <main class="content">

    <!-- LINGUE -->
    <nav aria-label="Lingua" style="margin-bottom:2rem;display:flex;gap:1rem;flex-wrap:wrap;">
      <a href="?lang=it">IT</a>
      <a href="?lang=en">EN</a>
      <a href="?lang=es">ES</a>
      <a href="?lang=fr">FR</a>
      <a href="?lang=de">DE</a>
      <a href="?lang=zh">中文</a>
    </nav>

    <!-- TESTO -->
    <section>
      <h1 data-i18n="title">Mango</h1>
      <p data-i18n="intro1">Mango riconosce uno scambio reale tra persone.</p>
      <p data-i18n="intro2">Non è una moneta. Non misura valore. Non accumula.</p>
    </section>

    <!-- COME SI FA -->
    <section>
      <h2 data-i18n="how_title">Come si fa Mango</h2>
      <p data-i18n="step1">1. Avviene uno scambio reale tra persone.</p>
      <p data-i18n="step2">2. Si scrive una riga che riconosce che lo scambio è avvenuto.</p>
      <p data-i18n="step3">3. La riga non indica quantità, non crea credito o debito, non si accumula.</p>
      <p data-i18n="step4">Una riga è un Mango.</p>
    </section>

    <!-- REGISTRO -->
    <section>
      <h2 data-i18n="reg_title">Scrivi una riga</h2>
      <p data-i18n="reg_help">Scrivi una riga semplice che riconosce lo scambio. Nessun numero, nessun valore.</p>

      <textarea id="lineInput" rows="3"
        style="width:100%;max-width:760px;box-sizing:border-box;padding:0.9rem;border:1px solid #ddd;border-radius:10px;"
        placeholder=""></textarea>

      <div style="margin-top:0.9rem;display:flex;gap:0.7rem;flex-wrap:wrap;">
        <button id="btnSave" type="button" style="padding:0.6rem 0.9rem;border:1px solid #ddd;border-radius:10px;background:#fff;cursor:pointer;"></button>
        <button id="btnCopy" type="button" style="padding:0.6rem 0.9rem;border:1px solid #ddd;border-radius:10px;background:#fff;cursor:pointer;"></button>
        <button id="btnExport" type="button" style="padding:0.6rem 0.9rem;border:1px solid #ddd;border-radius:10px;background:#fff;cursor:pointer;"></button>
        <button id="btnImport" type="button" style="padding:0.6rem 0.9rem;border:1px solid #ddd;border-radius:10px;background:#fff;cursor:pointer;"></button>
        <button id="btnClear" type="button" style="padding:0.6rem 0.9rem;border:1px solid #ddd;border-radius:10px;background:#fff;cursor:pointer;"></button>
      </div>

      <input type="file" id="fileInput" accept=".txt" style="display:none;" />

      <div style="margin-top:1.2rem;">
        <p data-i18n="reg_list_title" style="margin-bottom:0.6rem;">Registro (solo testo)</p>
        <pre id="registry"
          style="white-space:pre-wrap;word-break:break-word;width:100%;max-width:760px;box-sizing:border-box;padding:1rem;border:1px solid #eee;border-radius:12px;background:#fafafa;min-height:160px;"></pre>
      </div>
    </section>

    <!-- QR UFFICIALE -->
    <section>
      <h2 data-i18n="qr_title">QR ufficiale</h2>
      <p data-i18n="qr_help">Questo è il QR unico definitivo della home Mango (link stabile).</p>

      <!-- ANTI-TREMOLIO: width/height fissano lo spazio prima del caricamento -->
      <img
        id="qrHome"
        src="qr-home.png"
        width="240"
        height="240"
        alt="QR Mango Home"
        style="max-width:240px;width:100%;height:auto;border:1px solid #eee;border-radius:12px;padding:0.75rem;background:#fff;display:block;"
        onerror="this.style.display='none';"
      />

      <p style="margin-top:0.9rem;">
        <a href="https://juandediosannaloromercedes.github.io/mango-infrastruttura/" rel="noopener">
          https://juandediosannaloromercedes.github.io/mango-infrastruttura/
        </a>
      </p>

      <p data-i18n="qr_phrase" style="margin-top:0.9rem;">
        Mango non accumula. Non misura. Non obbliga.
      </p>
    </section>

    <!-- FOOTER IDENTITÀ -->
    <section style="margin-top:4rem;font-size:0.95rem;opacity:0.75;">
      <p data-i18n="creator">Creato da Juan de Dios Annaloro Mercedes.</p>
      <p data-i18n="memory">In memoria di Larimar.</p>
      <p data-i18n="born">Nato il 02 febbraio 2026.</p>
    </section>

  </main>

  <script>
    const SUPPORTED_LANGS = ["it","en","es","fr","de","zh"];
    const DEFAULT_LANG = "it";
    const STORAGE_KEY = "mango_registry_lines_v1"; // stabile

    const translations = {
      it: {
        title: "Mango",
        intro1: "Mango riconosce uno scambio reale tra persone.",
        intro2: "Non è una moneta. Non misura valore. Non accumula.",

        how_title: "Come si fa Mango",
        step1: "1. Avviene uno scambio reale tra persone.",
        step2: "2. Si scrive una riga che riconosce che lo scambio è avvenuto.",
        step3: "3. La riga non indica quantità, non crea credito o debito, non si accumula.",
        step4: "Una riga è un Mango.",

        reg_title: "Scrivi una riga",
        reg_help: "Scrivi una riga semplice che riconosce lo scambio. Nessun numero, nessun valore.",
        reg_list_title: "Registro (solo testo)",
        placeholder: "Esempio: “Io ho aiutato X con … / X ha aiutato me con …”",
        btn_save: "Salva riga",
        btn_copy: "Copia registro",
        btn_export: "Esporta .txt",
        btn_import: "Importa .txt",
        btn_clear: "Cancella tutto",

        qr_title: "QR ufficiale",
        qr_help: "Questo è il QR unico definitivo della home Mango (link stabile).",
        qr_phrase: "Mango non accumula. Non misura. Non obbliga.",

        creator: "Creato da Juan de Dios Annaloro Mercedes.",
        memory: "In memoria di Larimar.",
        born: "Nato il 02 febbraio 2026."
      },

      en: {
        title: "Mango",
        intro1: "Mango recognizes a real exchange between people.",
        intro2: "It is not a currency. It does not measure value. It does not accumulate.",

        how_title: "How to do Mango",
        step1: "1. A real exchange happens between people.",
        step2: "2. One line is written to acknowledge that the exchange happened.",
        step3: "3. The line does not indicate quantities, creates no credit or debt, and does not accumulate.",
        step4: "One line is one Mango.",

        reg_title: "Write one line",
        reg_help: "Write a simple line acknowledging the exchange. No numbers, no value.",
        reg_list_title: "Registry (text only)",
        placeholder: "Example: “I helped X with … / X helped me with …”",
        btn_save: "Save line",
        btn_copy: "Copy registry",
        btn_export: "Export .txt",
        btn_import: "Import .txt",
        btn_clear: "Clear all",

        qr_title: "Official QR",
        qr_help: "This is the one definitive QR for the Mango home (stable link).",
        qr_phrase: "Mango does not accumulate. It does not measure. It does not oblige.",

        creator: "Created by Juan de Dios Annaloro Mercedes.",
        memory: "In memory of Larimar.",
        born: "Born on 02 February 2026."
      },

      es: {
        title: "Mango",
        intro1: "Mango reconoce un intercambio real entre personas.",
        intro2: "No es una moneda. No mide el valor. No se acumula.",

        how_title: "Cómo hacer Mango",
        step1: "1. Ocurre un intercambio real entre personas.",
        step2: "2. Se escribe una línea para reconocer que ocurrió.",
        step3: "3. La línea no indica cantidades, no crea crédito ni deuda, y no se acumula.",
        step4: "Una línea es un Mango.",

        reg_title: "Escribe una línea",
        reg_help: "Escribe una línea simple que reconozca el intercambio. Sin números, sin valor.",
        reg_list_title: "Registro (solo texto)",
        placeholder: "Ejemplo: “Ayudé a X con … / X me ayudó con …”",
        btn_save: "Guardar línea",
        btn_copy: "Copiar registro",
        btn_export: "Exportar .txt",
        btn_import: "Importar .txt",
        btn_clear: "Borrar todo",

        qr_title: "QR oficial",
        qr_help: "Este es el único QR definitivo de la home de Mango (enlace estable).",
        qr_phrase: "Mango no se acumula. No mide. No obliga.",

        creator: "Creado por Juan de Dios Annaloro Mercedes.",
        memory: "En memoria de Larimar.",
        born: "Nacido el 02 de febrero de 2026."
      },

      fr: {
        title: "Mango",
        intro1: "Mango reconnaît un échange réel entre personnes.",
        intro2: "Ce n’est pas une monnaie. Il ne mesure pas la valeur. Il ne s’accumule pas.",

        how_title: "Comment faire Mango",
        step1: "1. Un échange réel a lieu entre personnes.",
        step2: "2. Une ligne est écrite pour reconnaître que l’échange a eu lieu.",
        step3: "3. La ligne n’indique aucune quantité, ne crée ni crédit ni dette et ne s’accumule pas.",
        step4: "Une ligne est un Mango.",

        reg_title: "Écris une ligne",
        reg_help: "Écris une ligne simple qui reconnaît l’échange. Pas de chiffres, pas de valeur.",
        reg_list_title: "Registre (texte seulement)",
        placeholder: "Exemple : « J’ai aidé X à … / X m’a aidé à … »",
        btn_save: "Enregistrer",
        btn_copy: "Copier le registre",
        btn_export: "Exporter .txt",
        btn_import: "Importer .txt",
        btn_clear: "Tout effacer",

        qr_title: "QR officiel",
        qr_help: "Voici le QR unique définitif de la page d’accueil Mango (lien stable).",
        qr_phrase: "Mango ne s’accumule pas. Il ne mesure pas. Il n’oblige pas.",

        creator: "Créé par Juan de Dios Annaloro Mercedes.",
        memory: "En mémoire de Larimar.",
        born: "Né le 02 février 2026."
      },

      de: {
        title: "Mango",
        intro1: "Mango erkennt einen realen Austausch zwischen Menschen an.",
        intro2: "Es ist keine Währung. Es misst keinen Wert. Es sammelt sich nicht an.",

        how_title: "Wie man Mango macht",
        step1: "1. Ein realer Austausch findet zwischen Menschen statt.",
        step2: "2. Eine Zeile wird geschrieben, um anzuerkennen, dass es stattgefunden hat.",
        step3: "3. Die Zeile enthält keine Mengenangaben, schafft weder Kredit noch Schuld und sammelt sich nicht an.",
        step4: "Eine Zeile ist ein Mango.",

        reg_title: "Schreibe eine Zeile",
        reg_help: "Schreibe eine einfache Zeile, die den Austausch anerkennt. Keine Zahlen, kein Wert.",
        reg_list_title: "Register (nur Text)",
        placeholder: "Beispiel: „Ich habe X geholfen bei … / X hat mir geholfen bei …“",
        btn_save: "Zeile speichern",
        btn_copy: "Register kopieren",
        btn_export: "Als .txt exportieren",
        btn_import: ".txt importieren",
        btn_clear: "Alles löschen",

        qr_title: "Offizieller QR",
        qr_help: "Dies ist der einzige definitive QR der Mango-Startseite (stabiler Link).",
        qr_phrase: "Mango sammelt nicht an. Es misst nicht. Es verpflichtet nicht.",

        creator: "Erstellt von Juan de Dios Annaloro Mercedes.",
        memory: "Im Gedenken an Larimar.",
        born: "Geboren am 02. Februar 2026."
      },

      zh: {
        title: "Mango",
        intro1: "Mango 用來承認人與人之間真實發生的交換。",
        intro2: "它不是貨幣。它不衡量價值。它不可累積。",

        how_title: "如何進行 Mango",
        step1: "1. 人與人之間發生真實的交換。",
        step2: "2. 寫下一行來承認這個交換已經發生。",
        step3: "3. 這一行不表示數量、不產生信用或債務、也不可累積。",
        step4: "一行就是一個 Mango。",

        reg_title: "寫下一行",
        reg_help: "寫下一行簡單文字來承認交換。不要數字，不要價值。",
        reg_list_title: "紀錄（僅文字）",
        placeholder: "例：『我幫助了 X … / X 幫助了我 …』",
        btn_save: "儲存這一行",
        btn_copy: "複製紀錄",
        btn_export: "匯出 .txt",
        btn_import: "匯入 .txt",
        btn_clear: "全部清除",

        qr_title: "官方 QR",
        qr_help: "這是 Mango 首頁唯一且最終的 QR（穩定連結）。",
        qr_phrase: "Mango 不可累積。不衡量。不造成義務。",

        creator: "由 Juan de Dios Annaloro Mercedes 創建。",
        memory: "為紀念 Larimar。",
        born: "誕生於 2026 年 2 月 2 日。"
      }
    };

    function getLang() {
      const params = new URLSearchParams(window.location.search);
      const raw = (params.get("lang") || "").toLowerCase().trim();
      const normalized = raw
        .replace("-", "_")
        .replace("zh_hant", "zh")
        .replace("zh_tw", "zh")
        .replace("zh_cn", "zh");
      return SUPPORTED_LANGS.includes(normalized) ? normalized : DEFAULT_LANG;
    }

    function t(key, lang) {
      return (translations[lang] && translations[lang][key]) ?? translations.it[key] ?? "";
    }

    function loadRegistry() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        const arr = raw ? JSON.parse(raw) : [];
        return Array.isArray(arr) ? arr : [];
      } catch {
        return [];
      }
    }

    function saveRegistry(arr) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
    }

    function renderRegistry(arr) {
      document.getElementById("registry").textContent = arr.join("\n");
    }

    async function copyText(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch {
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        const ok = document.execCommand("copy");
        document.body.removeChild(ta);
        return ok;
      }
    }

    function exportTxt(text) {
      const date = new Date().toISOString().slice(0, 10);
      const filename = `mango_registro_${date}.txt`;
      const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);

      URL.revokeObjectURL(url);
    }

    function applyTranslations() {
      const lang = getLang();
      document.documentElement.setAttribute("lang", lang === "zh" ? "zh-Hant" : lang);

      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        el.textContent = t(key, lang);
      });

      const input = document.getElementById("lineInput");
      input.placeholder = t("placeholder", lang);

      document.getElementById("btnSave").textContent = t("btn_save", lang);
      document.getElementById("btnCopy").textContent = t("btn_copy", lang);
      document.getElementById("btnExport").textContent = t("btn_export", lang);
      document.getElementById("btnImport").textContent = t("btn_import", lang);
      document.getElementById("btnClear").textContent = t("btn_clear", lang);
    }

    document.addEventListener("DOMContentLoaded", () => {
      applyTranslations();

      let registry = loadRegistry();
      renderRegistry(registry);

      document.getElementById("btnSave").addEventListener("click", () => {
        const input = document.getElementById("lineInput");
        const line = (input.value || "").trim();
        if (!line) return;

        registry.push(line);
        saveRegistry(registry);
        renderRegistry(registry);
        input.value = "";
      });

      document.getElementById("btnCopy").addEventListener("click", async () => {
        const text = registry.join("\n");
        if (!text) return;
        await copyText(text);
      });

      document.getElementById("btnExport").addEventListener("click", () => {
        const text = registry.join("\n");
        if (!text) return;
        exportTxt(text);
      });

      document.getElementById("btnImport").addEventListener("click", () => {
        document.getElementById("fileInput").click();
      });

      document.getElementById("fileInput").addEventListener("change", (e) => {
        const file = e.target.files && e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = () => {
          const text = String(reader.result || "");
          const lines = text
            .split(/\r?\n/)
            .map(s => s.trim())
            .filter(s => s.length > 0);

          registry = lines;
          saveRegistry(registry);
          renderRegistry(registry);
        };
        reader.readAsText(file);
        e.target.value = "";
      });

      document.getElementById("btnClear").addEventListener("click", () => {
        registry = [];
        saveRegistry(registry);
        renderRegistry(registry);
      });
    });
  </script>
</body>
</html>
