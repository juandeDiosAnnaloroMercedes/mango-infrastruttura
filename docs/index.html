<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <meta name="theme-color" content="#0b0d12" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Mango â€” Infrastruttura di fiducia locale</title>

  <style>
    :root{
      --bg:#070910;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.04);
      --stroke:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --muted2:rgba(255,255,255,.52);
      --ok:rgba(80, 220, 140, .20);
      --ok2:rgba(80, 220, 140, .85);
      --warn:rgba(255, 90, 90, .20);
      --warn2:rgba(255, 90, 90, .90);
      --btn:rgba(255,255,255,.07);
      --btn2:rgba(255,255,255,.12);
      --shadow:0 14px 60px rgba(0,0,0,.45);
      --radius:26px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(1000px 700px at 30% -10%, rgba(120,140,255,.15), transparent 60%),
        radial-gradient(900px 650px at 85% 10%, rgba(255,160,80,.10), transparent 55%),
        radial-gradient(1000px 800px at 50% 120%, rgba(80,220,140,.10), transparent 60%),
        var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }

    a{ color:inherit; text-decoration:underline; text-underline-offset:4px; }
    .wrap{ max-width:980px; margin:0 auto; padding:18px 14px 60px; }

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 16px;
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      gap:14px;
    }
    .brand{ display:flex; align-items:center; gap:12px; min-width:240px; }
    .logo{
      width:54px; height:54px; border-radius:16px;
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
      display:grid; place-items:center;
      overflow:hidden;
    }
    .logo a{
      width:100%; height:100%;
      display:grid; place-items:center;
      text-decoration:none;
    }
    .logo img{ width:34px; height:34px; display:block; }
    .brand h1{ margin:0; font-size:28px; letter-spacing:.2px; }
    .brand p{ margin:2px 0 0; color:var(--muted); font-size:14px; }

    .chips{ display:flex; flex-wrap:wrap; gap:8px; justify-content:flex-end; }
    .chip{
      border:1px solid var(--stroke);
      background:rgba(10,12,18,.35);
      padding:10px 14px;
      border-radius:999px;
      font-weight:700;
      letter-spacing:.4px;
      text-decoration:none;
      user-select:none;
      cursor:pointer;
      min-width:62px;
      text-align:center;
    }
    .chip.active{
      outline:2px solid rgba(110,140,255,.35);
      background:rgba(110,140,255,.12);
    }

    .section{
      margin-top:18px;
      padding:18px 16px;
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.025));
      box-shadow:var(--shadow);
    }
    .section h2{
      margin:0 0 8px;
      font-size:54px;
      line-height:1.02;
      letter-spacing:-.8px;
    }
    .section h3{
      margin:0 0 10px;
      font-size:44px;
      line-height:1.05;
      letter-spacing:-.6px;
    }
    .lead{
      margin:0 0 14px;
      color:var(--muted);
      font-size:20px;
      line-height:1.35;
    }

    .actions{ display:flex; gap:12px; flex-wrap:wrap; margin:10px 0 16px; }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:16px 20px;
      border-radius:20px;
      border:1px solid var(--stroke);
      background:var(--btn);
      box-shadow:0 10px 30px rgba(0,0,0,.25);
      text-decoration:none;
      font-weight:800;
      min-width:132px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:hover{ background:var(--btn2); }
    .btn.primary{ background:rgba(110,140,255,.18); border-color:rgba(110,140,255,.35); }
    .btn.danger{ background:rgba(255,90,90,.16); border-color:rgba(255,90,90,.30); }
    .btn.small{ padding:12px 16px; min-width:unset; }

    textarea{
      width:100%;
      min-height:170px;
      resize:vertical;
      border-radius:24px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.22);
      color:var(--text);
      padding:18px 18px;
      font-size:22px;
      line-height:1.4;
      outline:none;
    }
    textarea::placeholder{ color:rgba(255,255,255,.40); }

    .row{
      display:flex; gap:12px; flex-wrap:wrap;
      margin-top:14px;
      align-items:center;
    }
    .meta{
      display:flex; gap:12px; flex-wrap:wrap;
      margin-top:14px;
      align-items:center;
      color:var(--muted);
      font-size:16px;
    }
    .pill{
      border:1px solid var(--stroke);
      padding:12px 14px;
      border-radius:999px;
      background:rgba(0,0,0,.18);
      font-weight:750;
    }

    .status{
      margin-top:12px;
      border-radius:18px;
      padding:12px 14px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.18);
      color:var(--muted);
      font-weight:800;
    }
    .status.good{ background:var(--ok); border-color:rgba(80,220,140,.30); color:rgba(210,255,230,.95); }
    .status.warn{ background:var(--warn); border-color:rgba(255,90,90,.30); color:rgba(255,220,220,.95); }

    .note{ margin-top:10px; color:var(--muted2); font-size:15px; line-height:1.35; }

    .links{ margin-top:12px; color:rgba(220,235,255,.90); font-size:17px; line-height:1.45; }
    .links a{ margin-right:14px; white-space:nowrap; }

    .divider{ height:1px; background:rgba(255,255,255,.10); margin:14px 0; }

    .muro-head{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; margin-top:10px; margin-bottom:10px;
      padding:12px 14px;
      border-radius:18px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.18);
    }
    .muro-lang{
      font-weight:900;
      letter-spacing:.6px;
      opacity:.95;
    }
    .muro-icon{
      width:26px; height:26px;
      opacity:.95;
    }
    .muro-list{
      margin:0;
      padding-left:20px;
      color:rgba(240,245,255,.92);
      font-size:19px;
      line-height:1.45;
    }
    .muro-list li{ margin:8px 0; color:rgba(230,238,255,.88); }

    footer{
      margin-top:18px;
      text-align:center;
      color:rgba(255,255,255,.55);
      font-weight:700;
      letter-spacing:.2px;
    }

    @media (max-width:760px){
      .section h2{ font-size:44px; }
      .section h3{ font-size:38px; }
      textarea{ font-size:20px; }
      .brand h1{ font-size:24px; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- TOP BAR -->
    <div class="topbar">
      <div class="brand">
        <div class="logo">
          <a id="logoLink" href="Bianco.html" aria-label="Mango">
            <img src="assets/mango.png" alt="Mango" onerror="this.style.display='none';this.parentElement.textContent='ðŸ¥­';this.parentElement.style.fontSize='26px';"/>
          </a>
        </div>
        <div>
          <h1>Mango</h1>
          <p id="subtitle">Infrastruttura di fiducia locale</p>
        </div>
      </div>

      <div class="chips" id="langChips">
        <button class="chip" data-lang="it" type="button">IT</button>
        <button class="chip" data-lang="en" type="button">EN</button>
        <button class="chip" data-lang="es" type="button">ES</button>
        <button class="chip" data-lang="fr" type="button">FR</button>
        <button class="chip" data-lang="de" type="button">DE</button>
        <button class="chip" data-lang="zh" type="button">ä¸­æ–‡</button>
      </div>
    </div>

    <!-- FAI MANGO ADESSO -->
    <section class="section" id="do">
      <h2 id="hDo">Fai Mango adesso</h2>
      <p class="lead" id="pDo">Scrivi una sola riga reale. Niente cifre. Niente misure. Niente equivalenze.</p>

      <div class="actions">
        <a id="btnQRTop" class="btn" href="stampa-qr.html">QR</a>
        <a id="btnFAQTop" class="btn" href="faq.html">FAQ</a>
      </div>

      <textarea id="riga" placeholder="Scrivi qui una riga (Shift+Invio va a capo)"></textarea>

      <div class="row">
        <button class="btn primary" id="btnInvia" type="button">Invia riga</button>
        <button class="btn" id="btnPulisci" type="button">Pulisci</button>
        <button class="btn" id="btnApri" type="button">Apri archivio</button>
        <button class="btn danger" id="btnSvuota" type="button">Svuota archivio</button>
      </div>

      <div class="meta">
        <span class="pill" id="countPill">Righe in archivio: 0</span>
      </div>

      <div class="status" id="statusBox" aria-live="polite"></div>
      <div class="note" id="noteLocal">Nota: lâ€™archivio Ã¨ locale sul tuo dispositivo (non Ã¨ pubblico).</div>

      <div class="links" id="linksBox">
        <div style="margin-top:10px;">
          <span id="emailLabel">Email:</span>
          <a href="mailto:info@mangoinfrastruttura.org">info@mangoinfrastruttura.org</a>
        </div>

        <div style="margin-top:10px;">
          <a id="lnkPdfQr" href="QR_MANGO_UFFICIALE.pdf">PDF QR</a>
          <a id="lnkKit" href="kit-mango.pdf">Kit (PDF)</a>
          <a id="lnkStatutoPdf" href="versione-permanente.pdf">Versione permanente (PDF)</a>
          <a id="lnkOriginePdf" href="MANGO_Origine_Reale_e_Storia_Vissuta.pdf">Origine reale (PDF)</a>
        </div>

        <div style="margin-top:10px;">
          <a id="lnkNeutralita" href="neutralita.html">NeutralitÃ </a>
          <a id="lnkNonApp" href="non-appropriazione.html">Non appropriazione</a>
          <a id="lnkStatuto" href="statuto-permanente.html">Statuto permanente</a>
          <a id="lnkPrimo" href="primo-scambio.html">Primo scambio</a>
        </div>
      </div>
    </section>

    <!-- COS'Ãˆ -->
    <section class="section" id="about">
      <h3 id="hAbout">Cosâ€™Ã¨ Mango</h3>
      <p class="lead" id="pAbout">
        Mango Ã¨ unâ€™infrastruttura di fiducia locale non monetaria, non appropriabile, progettata per evitare accumulo, speculazione e cattura istituzionale.
        Creato da Juan de Dios Annaloro Mercedes in memoria di Larimar.
      </p>

      <div class="actions">
        <a id="btnLicenza" class="btn" href="licenza.html">Licenza</a>
        <a id="btnStampaQR" class="btn" href="stampa-qr.html">Stampa QR</a>
      </div>
    </section>

    <!-- MURO -->
    <section class="section" id="muro">
      <h3 id="hMuro">Muro Mango</h3>
      <p class="lead" id="pMuro">
        Sette righe anonime per lingua, scelte a caso a ogni visita. Senza identitÃ , senza date, senza archivio consultabile.
      </p>

      <div class="muro-head">
        <div class="muro-lang" id="muroLangLabel">IT</div>
        <img class="muro-icon" src="assets/mango.png" alt="ðŸ¥­"
             onerror="this.style.display='none'"/>
      </div>

      <ul class="muro-list" id="muroList"></ul>
    </section>

    <footer id="footerBirth">Mango â€” nato il 02 febbraio 2026</footer>
  </div>

<script>
/* =========================
   TESTI MULTILINGUA
========================= */
const STR = {
  it: {
    subtitle: "Infrastruttura di fiducia locale",
    hDo: "Fai Mango adesso",
    pDo: "Scrivi una sola riga reale. Niente cifre. Niente misure. Niente equivalenze.",
    qr: "QR", faq:"FAQ",
    ph: "Scrivi qui una riga (Shift+Invio va a capo)",
    send:"Invia riga", clear:"Pulisci", open:"Apri archivio", wipe:"Svuota archivio",
    count: (n)=>`Righe in archivio: ${n}`,
    localNote:"Nota: lâ€™archivio Ã¨ locale sul tuo dispositivo (non Ã¨ pubblico).",
    ok:"Riga riconosciuta.",
    empty:"Scrivi una riga reale prima di inviare.",
    warn:"Rispetta te stesso e gli altri: Mango non si conta.",
    aboutTitle:"Cosâ€™Ã¨ Mango",
    aboutText:"Mango Ã¨ unâ€™infrastruttura di fiducia locale non monetaria, non appropriabile, progettata per evitare accumulo, speculazione e cattura istituzionale. Creato da Juan de Dios Annaloro Mercedes in memoria di Larimar.",
    lic:"Licenza",
    stampa:"Stampa QR",
    muroTitle:"Muro Mango",
    muroText:"Sette righe anonime per lingua, scelte a caso a ogni visita. Senza identitÃ , senza date, senza archivio consultabile.",
    email:"Email:",
    birth:"Mango â€” nato il 02 febbraio 2026",
    archiveEmpty:"Archivio vuoto.",
    confirmWipe:"Vuoi davvero svuotare lâ€™archivio locale?"
  },
  en: {
    subtitle: "Local trust infrastructure",
    hDo: "Do Mango now",
    pDo: "Write one real line. No numbers. No measures. No equivalences.",
    qr: "QR", faq:"FAQ",
    ph: "Write one line (Shift+Enter for new line)",
    send:"Send line", clear:"Clear", open:"Open archive", wipe:"Wipe archive",
    count: (n)=>`Lines in archive: ${n}`,
    localNote:"Note: the archive is local on your device (not public).",
    ok:"Line recognized.",
    empty:"Write a real line before sending.",
    warn:"Respect yourself and others: Mango is not something you count.",
    aboutTitle:"What is Mango",
    aboutText:"Mango is a non-monetary, non-appropriable local trust infrastructure designed to prevent accumulation, speculation, and institutional capture. Created by Juan de Dios Annaloro Mercedes in memory of Larimar.",
    lic:"License",
    stampa:"Print QR",
    muroTitle:"Mango Wall",
    muroText:"Seven anonymous lines per language, chosen randomly on each visit. No identities, no dates, no browsable archive.",
    email:"Email:",
    birth:"Mango â€” born on 02 February 2026",
    archiveEmpty:"Archive is empty.",
    confirmWipe:"Do you really want to wipe the local archive?"
  },
  es: {
    subtitle: "Infraestructura de confianza local",
    hDo: "Haz Mango ahora",
    pDo: "Escribe una sola lÃ­nea real. Sin cifras. Sin medidas. Sin equivalencias.",
    qr: "QR", faq:"FAQ",
    ph: "Escribe una lÃ­nea (Shift+Enter para salto de lÃ­nea)",
    send:"Enviar lÃ­nea", clear:"Limpiar", open:"Abrir archivo", wipe:"Vaciar archivo",
    count: (n)=>`LÃ­neas en archivo: ${n}`,
    localNote:"Nota: el archivo es local en tu dispositivo (no es pÃºblico).",
    ok:"LÃ­nea reconocida.",
    empty:"Escribe una lÃ­nea real antes de enviar.",
    warn:"RespÃ©tate a ti mismo y a los demÃ¡s: Mango no se cuenta.",
    aboutTitle:"QuÃ© es Mango",
    aboutText:"Mango es una infraestructura de confianza local no monetaria, no apropiable, diseÃ±ada para evitar acumulaciÃ³n, especulaciÃ³n y captura institucional. Creado por Juan de Dios Annaloro Mercedes en memoria de Larimar.",
    lic:"Licencia",
    stampa:"Imprimir QR",
    muroTitle:"Muro Mango",
    muroText:"Siete lÃ­neas anÃ³nimas por idioma, elegidas al azar en cada visita. Sin identidades, sin fechas, sin archivo consultable.",
    email:"Email:",
    birth:"Mango â€” nacido el 02 de febrero de 2026",
    archiveEmpty:"El archivo estÃ¡ vacÃ­o.",
    confirmWipe:"Â¿Quieres vaciar el archivo local?"
  },
  fr: {
    subtitle: "Infrastructure de confiance locale",
    hDo: "Fais Mango maintenant",
    pDo: "Ã‰cris une seule ligne rÃ©elle. Pas de chiffres. Pas de mesures. Pas dâ€™Ã©quivalences.",
    qr: "QR", faq:"FAQ",
    ph: "Ã‰cris une ligne (Shift+EntrÃ©e pour aller Ã  la ligne)",
    send:"Envoyer la ligne", clear:"Effacer", open:"Ouvrir lâ€™archive", wipe:"Vider lâ€™archive",
    count: (n)=>`Lignes dans lâ€™archive : ${n}`,
    localNote:"Note : lâ€™archive est locale sur ton appareil (pas publique).",
    ok:"Ligne reconnue.",
    empty:"Ã‰cris une ligne rÃ©elle avant dâ€™envoyer.",
    warn:"Respecte-toi et respecte les autres : Mango ne se compte pas.",
    aboutTitle:"Quâ€™est-ce que Mango",
    aboutText:"Mango est une infrastructure de confiance locale non monÃ©taire, non appropriable, conÃ§ue pour Ã©viter lâ€™accumulation, la spÃ©culation et la capture institutionnelle. CrÃ©Ã© par Juan de Dios Annaloro Mercedes en mÃ©moire de Larimar.",
    lic:"Licence",
    stampa:"Imprimer le QR",
    muroTitle:"Mur Mango",
    muroText:"Sept lignes anonymes par langue, choisies au hasard Ã  chaque visite. Sans identitÃ©s, sans dates, sans archive consultable.",
    email:"Email :",
    birth:"Mango â€” nÃ© le 02 fÃ©vrier 2026",
    archiveEmpty:"Archive vide.",
    confirmWipe:"Veux-tu vraiment vider lâ€™archive locale ?"
  },
  de: {
    subtitle: "Lokale Vertrauens-Infrastruktur",
    hDo: "Mach Mango jetzt",
    pDo: "Schreibe eine echte Zeile. Keine Zahlen. Keine MaÃŸe. Keine Ã„quivalenzen.",
    qr: "QR", faq:"FAQ",
    ph: "Schreibe eine Zeile (Shift+Enter fÃ¼r neue Zeile)",
    send:"Zeile senden", clear:"LÃ¶schen", open:"Archiv Ã¶ffnen", wipe:"Archiv leeren",
    count: (n)=>`Zeilen im Archiv: ${n}`,
    localNote:"Hinweis: Das Archiv ist lokal auf deinem GerÃ¤t (nicht Ã¶ffentlich).",
    ok:"Zeile erkannt.",
    empty:"Schreibe zuerst eine echte Zeile.",
    warn:"Respektiere dich und andere: Mango wird nicht gezÃ¤hlt.",
    aboutTitle:"Was ist Mango",
    aboutText:"Mango ist eine nicht-monetÃ¤re, nicht-aneignbare lokale Vertrauens-Infrastruktur, die AnhÃ¤ufung, Spekulation und institutionelle Vereinnahmung verhindern soll. Erschaffen von Juan de Dios Annaloro Mercedes im Gedenken an Larimar.",
    lic:"Lizenz",
    stampa:"QR drucken",
    muroTitle:"Mango-Mauer",
    muroText:"Sieben anonyme Zeilen pro Sprache, bei jedem Besuch zufÃ¤llig gewÃ¤hlt. Ohne IdentitÃ¤ten, ohne Daten, ohne durchsuchbares Archiv.",
    email:"E-Mail:",
    birth:"Mango â€” geboren am 02. Februar 2026",
    archiveEmpty:"Archiv ist leer.",
    confirmWipe:"MÃ¶chtest du das lokale Archiv wirklich leeren?"
  },
  zh: {
    subtitle: "åœ¨åœ°ä¿¡ä»»åŸºç¤Žè¨­æ–½",
    hDo: "ç¾åœ¨åš Mango",
    pDo: "åªå¯«ä¸€è¡ŒçœŸå¯¦å…§å®¹ã€‚ä¸å¯«æ•¸å­—ã€‚ä¸å¯«åº¦é‡ã€‚ä¸åšç­‰åƒ¹æ›ç®—ã€‚",
    qr: "QR", faq:"FAQ",
    ph: "åœ¨æ­¤å¯«ä¸€è¡Œï¼ˆShift+Enter æ›è¡Œï¼‰",
    send:"é€å‡ºä¸€è¡Œ", clear:"æ¸…é™¤", open:"æ‰“é–‹å­˜æª”", wipe:"æ¸…ç©ºå­˜æª”",
    count: (n)=>`å­˜æª”è¡Œæ•¸ï¼š${n}`,
    localNote:"æ³¨æ„ï¼šå­˜æª”åªåœ¨ä½ çš„è£ç½®ä¸Šï¼ˆä¸æ˜¯å…¬é–‹çš„ï¼‰ã€‚",
    ok:"å·²è­˜åˆ¥æ­¤è¡Œã€‚",
    empty:"é€å‡ºå‰è«‹å…ˆå¯«ä¸€è¡ŒçœŸå¯¦å…§å®¹ã€‚",
    warn:"è«‹å°Šé‡è‡ªå·±èˆ‡ä»–äººï¼šMango ä¸èƒ½è¢«è¨ˆæ•¸ã€‚",
    aboutTitle:"ä»€éº¼æ˜¯ Mango",
    aboutText:"Mango æ˜¯ä¸€ç¨®éžè²¨å¹£ã€ä¸å¯ä½”æœ‰çš„åœ¨åœ°ä¿¡ä»»åŸºç¤Žè¨­æ–½ï¼Œç”¨ä¾†é¿å…ç´¯ç©ã€æŠ•æ©Ÿèˆ‡åˆ¶åº¦æ€§æŒ¾æŒã€‚ç”± Juan de Dios Annaloro Mercedes å‰µç«‹ï¼Œä»¥ç´€å¿µ Larimarã€‚",
    lic:"æŽˆæ¬Š",
    stampa:"åˆ—å° QR",
    muroTitle:"Mango ä¹‹ç‰†",
    muroText:"æ¯ç¨®èªžè¨€ä¸ƒè¡ŒåŒ¿åå…§å®¹ï¼Œæ¯æ¬¡é€ è¨ªéš¨æ©Ÿé¡¯ç¤ºã€‚ç„¡èº«ä»½ã€ç„¡æ—¥æœŸã€ä¸å¯ç€è¦½å­˜æª”ã€‚",
    email:"Emailï¼š",
    birth:"Mango â€” èª•ç”Ÿæ–¼ 2026 å¹´ 2 æœˆ 2 æ—¥",
    archiveEmpty:"å­˜æª”æ˜¯ç©ºçš„ã€‚",
    confirmWipe:"ç¢ºå®šè¦æ¸…ç©ºæœ¬æ©Ÿå­˜æª”å—Žï¼Ÿ"
  }
};

/* =========================
   MURO: 7 righe per lingua
========================= */
const MURO = {
  it: [
    "Qualcuno ha portato qualcosa a qualcuno che non poteva uscire.",
    "Qualcuno ha insegnato qualcosa di difficile a qualcuno.",
    "Qualcuno ha aiutato qualcuno a fare ordine.",
    "Qualcuno ha prestato ascolto a qualcuno.",
    "Qualcuno ha fatto compagnia a qualcuno.",
    "Qualcuno ha tradotto un documento per qualcuno.",
    "Qualcuno ha fatto una telefonata importante per qualcuno.",
    "Qualcuno ha accompagnato qualcuno a un appuntamento.",
    "Qualcuno ha cucinato per qualcuno.",
    "Qualcuno ha riparato qualcosa per qualcuno."
  ],
  en: [
    "Someone brought something to someone who couldn't go out.",
    "Someone taught something difficult to someone.",
    "Someone helped someone get organized.",
    "Someone listened to someone.",
    "Someone kept someone company.",
    "Someone translated a document for someone.",
    "Someone made an important phone call for someone.",
    "Someone accompanied someone to an appointment.",
    "Someone cooked for someone.",
    "Someone fixed something for someone."
  ],
  es: [
    "Alguien llevÃ³ algo a alguien que no podÃ­a salir.",
    "Alguien enseÃ±Ã³ algo difÃ­cil a alguien.",
    "Alguien ayudÃ³ a alguien a organizarse.",
    "Alguien escuchÃ³ a alguien.",
    "Alguien acompaÃ±Ã³ a alguien con su presencia.",
    "Alguien tradujo un documento para alguien.",
    "Alguien hizo una llamada importante por alguien.",
    "Alguien acompaÃ±Ã³ a alguien a una cita.",
    "Alguien cocinÃ³ para alguien.",
    "Alguien arreglÃ³ algo para alguien."
  ],
  fr: [
    "Quelquâ€™un a apportÃ© quelque chose Ã  quelquâ€™un qui ne pouvait pas sortir.",
    "Quelquâ€™un a enseignÃ© quelque chose de difficile Ã  quelquâ€™un.",
    "Quelquâ€™un a aidÃ© quelquâ€™un Ã  sâ€™organiser.",
    "Quelquâ€™un a Ã©coutÃ© quelquâ€™un.",
    "Quelquâ€™un a tenu compagnie Ã  quelquâ€™un.",
    "Quelquâ€™un a traduit un document pour quelquâ€™un.",
    "Quelquâ€™un a passÃ© un appel important pour quelquâ€™un.",
    "Quelquâ€™un a accompagnÃ© quelquâ€™un Ã  un rendez-vous.",
    "Quelquâ€™un a cuisinÃ© pour quelquâ€™un.",
    "Quelquâ€™un a rÃ©parÃ© quelque chose pour quelquâ€™un."
  ],
  de: [
    "Jemand hat jemandem etwas gebracht, der nicht raus konnte.",
    "Jemand hat jemandem etwas Schwieriges beigebracht.",
    "Jemand hat jemandem beim AufrÃ¤umen/Ordnen geholfen.",
    "Jemand hat jemandem zugehÃ¶rt.",
    "Jemand hat jemandem Gesellschaft geleistet.",
    "Jemand hat ein Dokument fÃ¼r jemanden Ã¼bersetzt.",
    "Jemand hat fÃ¼r jemanden einen wichtigen Anruf gemacht.",
    "Jemand hat jemanden zu einem Termin begleitet.",
    "Jemand hat fÃ¼r jemanden gekocht.",
    "Jemand hat etwas fÃ¼r jemanden repariert."
  ],
  zh: [
    "æœ‰äººæŠŠæ±è¥¿é€çµ¦ç„¡æ³•å¤–å‡ºçš„æŸäººã€‚",
    "æœ‰äººæ•™æœƒæŸäººä¸€ä»¶å›°é›£çš„äº‹ã€‚",
    "æœ‰äººå¹«æŸäººæ•´ç†å¾—æ›´æœ‰æ¢ç†ã€‚",
    "æœ‰äººå‚¾è½äº†æŸäººã€‚",
    "æœ‰äººé™ªä¼´äº†æŸäººã€‚",
    "æœ‰äººæ›¿æŸäººç¿»è­¯äº†ä¸€ä»½æ–‡ä»¶ã€‚",
    "æœ‰äººæ›¿æŸäººæ‰“äº†ä¸€é€šé‡è¦é›»è©±ã€‚",
    "æœ‰äººé™ªæŸäººåŽ»èµ´ç´„ã€‚",
    "æœ‰äººæ›¿æŸäººåšäº†ä¸€é¤ã€‚",
    "æœ‰äººæ›¿æŸäººä¿®å¥½äº†æ±è¥¿ã€‚"
  ]
};

/* =========================
   LINGUA
========================= */
function getLang(){
  const url = new URL(window.location.href);
  const q = (url.searchParams.get("lang") || "").toLowerCase();
  if (q && STR[q]) return q;
  // fallback: prova html lang
  const hl = (document.documentElement.lang || "it").toLowerCase();
  if (STR[hl]) return hl;
  return "it";
}

function setLang(lang){
  const url = new URL(window.location.href);
  url.searchParams.set("lang", lang);
  history.replaceState({}, "", url.toString());
}

function withLang(url){
  const lang = getLang();
  const u = new URL(url, window.location.href);
  u.searchParams.set("lang", lang);
  return u.pathname + "?" + u.searchParams.toString();
}

function applyLang(lang){
  const s = STR[lang] || STR.it;
  document.documentElement.lang = lang;

  // top
  document.getElementById("subtitle").textContent = s.subtitle;

  // do
  document.getElementById("hDo").textContent = s.hDo;
  document.getElementById("pDo").textContent = s.pDo;
  document.getElementById("riga").placeholder = s.ph;

  document.getElementById("btnInvia").textContent = s.send;
  document.getElementById("btnPulisci").textContent = s.clear;
  document.getElementById("btnApri").textContent = s.open;
  document.getElementById("btnSvuota").textContent = s.wipe;

  document.getElementById("noteLocal").textContent = s.localNote;
  document.getElementById("emailLabel").textContent = s.email;

  // about
  document.getElementById("hAbout").textContent = s.aboutTitle;
  document.getElementById("pAbout").textContent = s.aboutText;
  document.getElementById("btnLicenza").textContent = s.lic;
  document.getElementById("btnStampaQR").textContent = s.stampa;

  // muro
  document.getElementById("hMuro").textContent = s.muroTitle;
  document.getElementById("pMuro").textContent = s.muroText;

  // footer
  document.getElementById("footerBirth").textContent = s.birth;

  // chip active
  document.querySelectorAll("#langChips .chip").forEach(ch=>{
    ch.classList.toggle("active", ch.dataset.lang === lang);
  });

  // links con lingua
  document.getElementById("btnQRTop").setAttribute("href", withLang("stampa-qr.html"));
  document.getElementById("btnFAQTop").setAttribute("href", withLang("faq.html"));
  document.getElementById("btnLicenza").setAttribute("href", withLang("licenza.html"));
  document.getElementById("btnStampaQR").setAttribute("href", withLang("stampa-qr.html"));

  document.getElementById("lnkNeutralita").setAttribute("href", withLang("neutralita.html"));
  document.getElementById("lnkNonApp").setAttribute("href", withLang("non-appropriazione.html"));
  document.getElementById("lnkStatuto").setAttribute("href", withLang("statuto-permanente.html"));
  document.getElementById("lnkPrimo").setAttribute("href", withLang("primo-scambio.html"));

  // logo -> bianco con lingua
  document.getElementById("logoLink").setAttribute("href", withLang("Bianco.html"));

  // evitare che QR/FAQ/Link vengano intercettati da listener di chip: stopPropagation
  ["btnQRTop","btnFAQTop","btnLicenza","btnStampaQR"].forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    el.classList.remove("chip");
    el.addEventListener("click", (e)=>e.stopPropagation(), true);
  });

  // reset status
  showStatus("", "none");
  renderMuro(lang);
}

/* =========================
   REGISTRO LOCALE (UNICO)
========================= */
const STORAGE_KEY = "MANGO_REGISTRO_UNICO_V2";

function safeParse(raw){
  try{ return JSON.parse(raw); } catch(e){ return null; }
}
function normalizeText(t){
  if(!t) return "";
  return String(t).replace(/\s+/g," ").trim();
}
function readArchive(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return [];
  const parsed = safeParse(raw);
  if(!Array.isArray(parsed)) return [];
  // format: [{text,ts}]
  return parsed
    .map(x => (x && typeof x.text === "string") ? ({text: normalizeText(x.text), ts: x.ts||0}) : null)
    .filter(Boolean)
    .filter(x => x.text.length>0);
}
function writeArchive(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}
function dedup(arr){
  const seen = new Set();
  const out = [];
  for(const r of arr){
    const k = (r.text||"").toLowerCase();
    if(!k || seen.has(k)) continue;
    seen.add(k);
    out.push(r);
  }
  return out;
}
function updateCount(lang){
  const s = STR[lang] || STR.it;
  const n = readArchive().length;
  document.getElementById("countPill").textContent = s.count(n);
}

/* =========================
   STATUS / BLOCCO NUMERI
========================= */
function showStatus(msg, type){
  const box = document.getElementById("statusBox");
  box.classList.remove("good","warn");
  if(!msg){
    box.textContent = "";
    box.style.display = "none";
    return;
  }
  box.style.display = "block";
  box.textContent = msg;
  if(type === "good") box.classList.add("good");
  if(type === "warn") box.classList.add("warn");
}

// blocco numeri/misure/equivalenze
function isForbidden(text){
  // 1) cifre
  if (/[0-9]/.test(text)) return true;

  // 2) segni tipici di calcolo/misura/equivalenza (non blocchiamo il trattino normale, ma blocchiamo simboli)
  const badSymbols = /[=+*/%<>â‚¬$Â£Â¥â‚¿]/;
  if (badSymbols.test(text)) return true;

  // 3) parole tipiche di misura/equivalenza (multilingua light)
  const badWords = /\b(kg|km|cm|mm|m2|mÂ²|%|euro|eur|dollari|usd|gb|mb|watt|hz|punti|score|valore|prezzo|costo|quota|rate|ratio|equivalente|equivalenza|convert|conversion)\b/i;
  if (badWords.test(text)) return true;

  return false;
}

/* =========================
   SALVATAGGIO
========================= */
function saveLine(lang){
  const s = STR[lang] || STR.it;
  const ta = document.getElementById("riga");
  if(!ta) return;

  const text = normalizeText(ta.value);

  if(!text){
    showStatus(s.empty, "warn");
    return;
  }

  if(isForbidden(text)){
    showStatus(s.warn, "warn");
    return;
  }

  const arr = readArchive();
  const merged = dedup([{text, ts: Date.now()}, ...arr]);
  writeArchive(merged);

  ta.value = "";
  syncInvia();
  updateCount(lang);
  showStatus(s.ok, "good");
}

function openArchive(lang){
  const s = STR[lang] || STR.it;
  const arr = readArchive();
  if(!arr.length){
    showStatus(s.archiveEmpty, "warn");
    return;
  }
  // Mostra fino a 30 righe (senza date, senza identitÃ )
  const lines = arr.slice(0,30).map(r => "â€¢ " + r.text).join("\n\n");
  alert(lines + (arr.length>30 ? "\n\nâ€¦" : ""));
}

function wipeArchive(lang){
  const s = STR[lang] || STR.it;
  if(!confirm(s.confirmWipe)) return;
  writeArchive([]);
  updateCount(lang);
  showStatus("", "none");
}

/* =========================
   UI: abilita/disabilita invia
========================= */
function syncInvia(){
  const ta = document.getElementById("riga");
  const btn = document.getElementById("btnInvia");
  if(!ta || !btn) return;
  btn.disabled = normalizeText(ta.value).length === 0;
  btn.style.opacity = btn.disabled ? "0.55" : "1";
}

function wireEvents(){
  // lingua
  document.querySelectorAll("#langChips .chip").forEach(ch=>{
    ch.addEventListener("click", ()=>{
      const lang = ch.dataset.lang;
      if(!lang || !STR[lang]) return;
      setLang(lang);
      applyLang(lang);
      updateCount(lang);
    });
  });

  // textarea
  const ta = document.getElementById("riga");
  if(ta){
    ta.addEventListener("input", syncInvia);
    ta.addEventListener("keydown", (e)=>{
      if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        const lang = getLang();
        saveLine(lang);
      }
    });
  }

  // bottoni
  document.getElementById("btnInvia")?.addEventListener("click", ()=>{
    const lang = getLang();
    saveLine(lang);
  });

  document.getElementById("btnPulisci")?.addEventListener("click", ()=>{
    const ta = document.getElementById("riga");
    if(ta) ta.value = "";
    syncInvia();
    showStatus("", "none");
  });

  document.getElementById("btnApri")?.addEventListener("click", ()=>{
    const lang = getLang();
    openArchive(lang);
  });

  document.getElementById("btnSvuota")?.addEventListener("click", ()=>{
    const lang = getLang();
    wipeArchive(lang);
  });

  // stopPropagation extra per i link (evita qualsiasi intercetto)
  ["btnQRTop","btnFAQTop","btnLicenza","btnStampaQR"].forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    el.addEventListener("click", (e)=>e.stopPropagation(), true);
  });
}

/* =========================
   MURO: render 7 righe SOLO lingua attiva
========================= */
function pick7(arr){
  const a = [...arr];
  // shuffle
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a.slice(0,7);
}

function renderMuro(lang){
  const list = document.getElementById("muroList");
  const lbl = document.getElementById("muroLangLabel");
  if(!list || !lbl) return;

  const labelMap = {it:"IT", en:"EN", es:"ES", fr:"FR", de:"DE", zh:"ä¸­æ–‡"};
  lbl.textContent = labelMap[lang] || "IT";

  const pool = MURO[lang] || MURO.it;
  const items = pick7(pool);

  list.innerHTML = "";
  items.forEach(t=>{
    const li = document.createElement("li");
    li.textContent = t;
    list.appendChild(li);
  });
}

/* =========================
   INIT
========================= */
(function init(){
  const lang = getLang();
  applyLang(lang);
  wireEvents();
  updateCount(lang);
  syncInvia();
})();
</script>

</body>
</html>
