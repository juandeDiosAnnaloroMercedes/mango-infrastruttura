<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mango ‚Äì Scrivi una riga</title>

  <style>
    body{ margin:0; font-family:-apple-system,BlinkMacSystemFont,system-ui,Segoe UI,Roboto,Arial; background:#fff; color:#111; }
    .wrap{ max-width:860px; margin:0 auto; padding:0 18px; }
    header{ padding:64px 0 18px; }
    h1{ margin:0; font-size:1.9rem; font-weight:750; }
    p{ margin:12px 0 0; line-height:1.7; font-size:1.05rem; opacity:.9; }
    .card{ border:1px solid rgba(0,0,0,.12); border-radius:18px; padding:16px; margin-top:18px; }
    textarea{
      width:100%; min-height:130px; resize:vertical;
      border-radius:16px; border:1px solid rgba(0,0,0,.14);
      padding:14px; font-size:1.05rem; line-height:1.55;
      outline:none;
    }
    .row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    .btn{
      appearance:none; border:1px solid rgba(0,0,0,.12); background:#fff; color:#111;
      padding:12px 14px; border-radius:14px; font-weight:750; cursor:pointer; text-decoration:none;
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn.primary{ border-color:rgba(0,0,0,.18); }
    .btn:active{ transform: translateY(1px); }

    /* ‚úÖ recognition box */
    .recognition-box{
      background:#e6f9ec;
      border:2px solid #22c55e;
      border-radius:16px;
      padding:14px;
      margin-bottom:16px;
      text-align:center;
      font-weight:800;
      animation:fadeIn 0.3s ease;
      display:none;
    }
    .rec-sub{
      font-weight:600;
      font-size:14px;
      margin-top:4px;
      opacity:.85;
    }
    @keyframes fadeIn{
      from{opacity:0; transform:translateY(-6px);}
      to{opacity:1; transform:translateY(0);}
    }

    .langbar{
      position:fixed; top:14px; right:14px;
      display:flex; gap:8px; flex-wrap:wrap;
      background:rgba(255,255,255,.92);
      border:1px solid rgba(0,0,0,.10);
      border-radius:16px; padding:8px 10px;
      backdrop-filter: blur(10px);
      z-index:20;
    }
    .langbar a{
      font-size:.95rem; text-decoration:none; color:#111; opacity:.75; font-weight:750;
      padding:6px 10px; border-radius:12px; border:1px solid rgba(0,0,0,.10);
      background:#fff;
    }
    .langbar a.active{ opacity:1; border-color:rgba(0,0,0,.25); }
    .hint{ opacity:.65; font-size:.98rem; margin-top:10px; }
  </style>
</head>

<body>
  <div class="langbar" id="langbar"></div>

  <div class="wrap">
    <header>
      <h1 id="h_title">Scrivi una riga</h1>
      <p id="p_intro">Descrivi uno scambio reale. Non usare numeri. Non misurare valore.</p>
    </header>

    <div class="card">
      <div id="recognitionBox" class="recognition-box">
        <strong id="recStrong">‚úÖ RIGA RICONOSCIUTA</strong>
        <div class="rec-sub" id="recSub">√à stata salvata solo su questo dispositivo.</div>
      </div>

      <textarea id="lineInput" placeholder=""></textarea>

      <div class="row">
        <button class="btn primary" id="btnSave">‚úÖ <span id="t_save">Salva riga</span></button>
        <a class="btn" id="btnHome" href="index.html#register">üè† <span id="t_home">Torna alla Home</span></a>
      </div>

      <div class="hint" id="t_hint">
        Dopo il salvataggio verrai portato automaticamente al registro in Home.
      </div>
    </div>
  </div>

<script>
const dict = {
  it: { title:"Scrivi una riga", intro:"Descrivi uno scambio reale. Non usare numeri. Non misurare valore.",
        ph:"Scrivi qui la riga‚Ä¶", save:"Salva riga", home:"Torna alla Home",
        hint:"Dopo il salvataggio verrai portato automaticamente al registro in Home.",
        recognized:"‚úÖ RIGA RICONOSCIUTA", saved_local:"√à stata salvata solo su questo dispositivo.",
        empty_title:"Scrivi una riga", empty_sub:"Scrivi qualcosa prima di salvare." },
  en: { title:"Write a line", intro:"Describe a real exchange. No numbers. Do not measure value.",
        ph:"Write the line here‚Ä¶", save:"Save line", home:"Back to Home",
        hint:"After saving you will be taken to the register on Home.",
        recognized:"‚úÖ LINE RECOGNIZED", saved_local:"Saved only on this device.",
        empty_title:"Write a line", empty_sub:"Write something before saving." },
  es: { title:"Escribe una l√≠nea", intro:"Describe un intercambio real. Sin n√∫meros. No midas valor.",
        ph:"Escribe la l√≠nea aqu√≠‚Ä¶", save:"Guardar l√≠nea", home:"Volver al inicio",
        hint:"Despu√©s de guardar ir√°s autom√°ticamente al registro en Inicio.",
        recognized:"‚úÖ L√çNEA RECONOCIDA", saved_local:"Guardada solo en este dispositivo.",
        empty_title:"Escribe una l√≠nea", empty_sub:"Escribe algo antes de guardar." },
  fr: { title:"√âcris une ligne", intro:"D√©cris un √©change r√©el. Pas de nombres. Ne mesure pas la valeur.",
        ph:"√âcris la ligne ici‚Ä¶", save:"Enregistrer la ligne", home:"Retour √† l‚Äôaccueil",
        hint:"Apr√®s l‚Äôenregistrement, tu seras envoy√© vers le registre sur l‚Äôaccueil.",
        recognized:"‚úÖ LIGNE RECONNUE", saved_local:"Enregistr√©e uniquement sur cet appareil.",
        empty_title:"√âcris une ligne", empty_sub:"√âcris quelque chose avant d‚Äôenregistrer." },
  de: { title:"Schreibe eine Zeile", intro:"Beschreibe einen realen Austausch. Keine Zahlen. Keinen Wert messen.",
        ph:"Schreibe die Zeile hier‚Ä¶", save:"Zeile speichern", home:"Zur Startseite",
        hint:"Nach dem Speichern wirst du automatisch zum Register auf der Startseite gef√ºhrt.",
        recognized:"‚úÖ ZEILE ANERKANNT", saved_local:"Nur auf diesem Ger√§t gespeichert.",
        empty_title:"Schreibe eine Zeile", empty_sub:"Schreibe etwas, bevor du speicherst." },
  zh: { title:"ÂØ´‰∏ã‰∏ÄË°å", intro:"ÊèèËø∞‰∏ÄÊ¨°ÁúüÂØ¶‰∫§Êèõ„ÄÇ‰∏çË¶ÅÁî®Êï∏Â≠ó„ÄÇ‰∏çË¶ÅË°°ÈáèÂÉπÂÄº„ÄÇ",
        ph:"Âú®ÈÄôË£°ÂØ´‰∏ãÈÇ£‰∏ÄË°å‚Ä¶", save:"ÂÑ≤Â≠ò", home:"ÂõûÂà∞È¶ñÈ†Å",
        hint:"ÂÑ≤Â≠òÂæåÊúÉËá™ÂãïÂ∏∂‰Ω†ÂõûÂà∞È¶ñÈ†ÅÁöÑÊú¨Ê©üÁ¥ÄÈåÑ„ÄÇ",
        recognized:"‚úÖ Â∑≤ÊâøË™çÊ≠§Ë°å", saved_local:"ÂÉÖÂÑ≤Â≠òÂú®Ê≠§Ë£ùÁΩÆ‰∏ä„ÄÇ",
        empty_title:"ÂØ´‰∏ã‰∏ÄË°å", empty_sub:"Ë´ãÂÖàÂØ´ÂÖßÂÆπÂÜçÂÑ≤Â≠ò„ÄÇ" }
};

function getLang(){
  const q = new URLSearchParams(location.search);
  const v = (q.get("lang") || "it").toLowerCase();
  return dict[v] ? v : "it";
}
const LANG = getLang();
const t = (k)=> (dict[LANG][k] || dict.it[k] || k);

function buildLangbar(){
  const bar = document.getElementById("langbar");
  const langs = [["it","IT"],["en","EN"],["es","ES"],["fr","FR"],["de","DE"],["zh","ZH"]];
  bar.innerHTML = langs.map(([k,label])=>{
    const a=document.createElement("a");
    a.href = `primo-scambio.html?lang=${k}`;
    a.textContent = label;
    if(k===LANG) a.classList.add("active");
    return a.outerHTML;
  }).join("");
}

function applyI18n(){
  document.documentElement.lang = (LANG === "zh" ? "zh-Hant" : LANG);
  document.getElementById("h_title").textContent = t("title");
  document.getElementById("p_intro").textContent = t("intro");
  document.getElementById("lineInput").placeholder = t("ph");
  document.getElementById("t_save").textContent = t("save");
  document.getElementById("t_home").textContent = t("home");
  document.getElementById("t_hint").textContent = t("hint");
  document.getElementById("btnHome").href = `index.html?lang=${LANG}#register`;
}

const STORE_KEY = "mango_register_lines";

function loadLines(){
  try{
    const raw = localStorage.getItem(STORE_KEY);
    const arr = raw ? JSON.parse(raw) : [];
    return Array.isArray(arr) ? arr.filter(x => typeof x === "string" && x.trim() !== "") : [];
  }catch(_){ return []; }
}
function saveLines(arr){ localStorage.setItem(STORE_KEY, JSON.stringify(arr)); }

function showRecognition(title, sub){
  const box = document.getElementById("recognitionBox");
  document.getElementById("recStrong").textContent = title;
  document.getElementById("recSub").textContent = sub;
  box.style.display = "block";
}

document.getElementById("btnSave").addEventListener("click", ()=>{
  const v = (document.getElementById("lineInput").value || "").trim();

  if(!v){
    showRecognition(t("empty_title"), t("empty_sub"));
    return;
  }

  const lines = loadLines();
  lines.push(v);
  saveLines(lines);

  showRecognition(t("recognized"), t("saved_local"));
  document.getElementById("lineInput").value = "";

  setTimeout(()=>{
    window.location.href = `index.html?lang=${LANG}#register`;
  }, 650);
});

buildLangbar();
applyI18n();
</script>
</body>
</html>
